<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Explorer - Device Prototype</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --sky-top: #4BA3E3;
      --sky-bottom: #87CEEB;
      --card-bg: #F5EDE4;
      --card-shadow: rgba(139, 90, 43, 0.3);
      --wood-primary: #8B5A2B;
      --gold-accent: #FFD700;
      --cream: #FFF8E7;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Fredoka', 'Comic Neue', sans-serif;
      background: #E8E8E8;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* ============ 整体布局容器 ============ */
    .prototype-container {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }

    /* ============ 左侧页面列表 ============ */
    .page-list {
      width: 180px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 16px;
      flex-shrink: 0;
    }

    .page-list-title {
      font-size: 12px;
      color: #888;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .page-list-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      color: #333;
    }

    .page-list-item:hover {
      background: #F5F5F5;
    }

    .page-list-item.active {
      background: #EEF2FF;
      color: #6366F1;
      font-weight: 500;
    }

    .page-list-item .icon {
      font-size: 16px;
    }

    .page-list-section {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }

    .page-list-section-title {
      font-size: 11px;
      color: #AAA;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ============ 中间设备屏幕 ============ */
    .device-frame {
      background: #2A2A2A;
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .device-screen {
      width: 640px;
      height: 480px;
      background: url('icons/bg.png') center center / cover no-repeat;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    /* ============ 右侧按键区 ============ */
    .button-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex-shrink: 0;
    }

    .device-button {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .device-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }

    .device-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .btn-ptt {
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
    }

    .btn-ai {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
    }

    .btn-vol-up, .btn-vol-down {
      background: linear-gradient(180deg, #E5E5E5 0%, #CCCCCC 100%);
      font-size: 20px;
      width: 48px;
      height: 48px;
    }

    .btn-power {
      background: linear-gradient(180deg, #555 0%, #333 100%);
      color: #FF6B6B;
      font-size: 18px;
      width: 48px;
      height: 48px;
    }

    .btn-shutter {
      background: linear-gradient(180deg, #EF4444 0%, #DC2626 100%);
      color: white;
      font-size: 20px;
      width: 48px;
      height: 48px;
    }

    .button-label {
      font-size: 10px;
      color: #666;
      text-align: center;
      margin-top: 3px;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .button-divider {
      width: 40px;
      height: 1px;
      background: #DDD;
      margin: 4px 0;
    }

    /* 音量提示 */
    .volume-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.75);
      border-radius: 16px;
      padding: 20px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .volume-indicator.show {
      opacity: 1;
    }

    .volume-icon {
      font-size: 36px;
    }

    .volume-bar-container {
      width: 160px;
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
      overflow: hidden;
    }

    .volume-bar {
      height: 100%;
      background: white;
      border-radius: 3px;
      transition: width 0.15s ease;
    }

    .volume-text {
      color: white;
      font-size: 14px;
      font-weight: 500;
    }

    /* 息屏效果 */
    .screen-off-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      border-radius: 12px;
    }

    .screen-off-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* ============ 屏幕内部样式 ============ */

    /* 天空背景（使用图片，隐藏CSS云朵） */
    .sky-bg {
      display: none;
    }

    .cloud {
      display: none;
    }
    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: white;
      border-radius: 50%;
    }

    .cloud-1 { width: 70px; height: 26px; top: 50px; left: 40px; animation: float 8s ease-in-out infinite; }
    .cloud-1::before { width: 35px; height: 35px; top: -18px; left: 8px; }
    .cloud-1::after { width: 44px; height: 44px; top: -22px; left: 26px; }

    .cloud-2 { width: 88px; height: 30px; top: 85px; right: 70px; animation: float 10s ease-in-out infinite 2s; }
    .cloud-2::before { width: 44px; height: 44px; top: -22px; left: 13px; }
    .cloud-2::after { width: 52px; height: 48px; top: -26px; left: 35px; }

    .cloud-3 { width: 52px; height: 22px; top: 35px; left: 260px; animation: float 7s ease-in-out infinite 1s; }
    .cloud-3::before { width: 30px; height: 30px; top: -15px; left: 7px; }
    .cloud-3::after { width: 35px; height: 33px; top: -17px; left: 22px; }

    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

    /* 状态栏 */
    .status-bar {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 28px;
      background: transparent;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 14px;
      color: white;
      font-size: 13px;
      font-weight: 600;
      z-index: 100;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    .status-left { display: flex; gap: 8px; align-items: center; }
    .status-right { display: flex; gap: 10px; align-items: center; font-size: 14px; }

    /* 页面容器 */
    .page {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .page.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* 二级三级页面通用模糊背景（除相机和地图外） */
    .page-blur-bg {
      background: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&q=80') center/cover no-repeat;
    }
    .page-blur-bg > *:first-child {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
    }

    /* Home 页面轮播 - 3卡片布局，大卡片风格 */
    .carousel-container {
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .card {
      position: absolute;
      width: 180px;
      height: 180px;
      background: linear-gradient(180deg, #F5EDE4 0%, #E8DFD4 100%);
      border-radius: 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, opacity 0.25s ease-out, background 0.25s ease-out;
      /* 阴影代替描边 */
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.1);
      border: none;
    }

    /* 卡片位置 - 只显示3张，两侧露出一部分 */
    .card.pos-far-left {
      transform: translateX(-420px) scale(0.7);
      opacity: 0.4;
      z-index: 1;
    }
    .card.pos-left {
      transform: translateX(-230px) scale(0.85);
      opacity: 0.9;
      z-index: 2;
    }
    .card.pos-center {
      transform: translateX(0) scale(1);
      opacity: 1;
      z-index: 5;
      width: 220px;
      height: 220px;
      /* 选中卡片变色 - 金黄色调 + 更强阴影 */
      background: linear-gradient(180deg, #FFE4A0 0%, #FFCC50 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.2),
        0 4px 12px rgba(0, 0, 0, 0.15),
        0 0 0 4px rgba(255, 200, 50, 0.3);
    }
    .card.pos-right {
      transform: translateX(230px) scale(0.85);
      opacity: 0.9;
      z-index: 2;
    }
    .card.pos-far-right {
      transform: translateX(420px) scale(0.7);
      opacity: 0.4;
      z-index: 1;
    }

    /* 点击反馈 */
    .card:active {
      transform: scale(0.95) !important;
    }

    /* 图标区域 */
    .card-icon {
      width: 130px;
      height: 130px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* 中心卡片图标更大 */
    .card.pos-center .card-icon {
      width: 170px;
      height: 170px;
    }

    /* 文字标签 - 在卡片外部，木纹风格 */
    .card-label {
      position: absolute;
      bottom: -45px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 20px;
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 50%, #6B4423 100%);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #FFF8E7;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      box-shadow: 
        0 3px 8px rgba(0,0,0,0.25),
        inset 0 1px 0 rgba(255,255,255,0.2);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }

    /* 只有左、中、右三张显示文字 */
    .card.pos-left .card-label,
    .card.pos-center .card-label,
    .card.pos-right .card-label {
      opacity: 1;
    }

    /* 中心卡片文字更大 */
    .card.pos-center .card-label {
      font-size: 18px;
      padding: 8px 28px;
      bottom: -50px;
      background: linear-gradient(180deg, #C49A6C 0%, #A67C52 50%, #8B5A2B 100%);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.25);
    }

    /* ===== 大尺寸拟物化图标 ===== */

    /* 相机图标 - 3D 立体感 */
    .icon-camera-big {
      width: 80px;
      height: 62px;
      background: linear-gradient(180deg, #6D6D6D 0%, #4D4D4D 50%, #3D3D3D 100%);
      border-radius: 12px;
      position: relative;
      box-shadow: 
        0 5px 0 #2D2D2D,
        0 8px 16px rgba(0,0,0,0.3),
        inset 0 2px 6px rgba(255,255,255,0.2);
    }
    .icon-camera-big::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 32px; height: 32px;
      background: linear-gradient(180deg, #87CEEB 0%, #5BA3D9 100%);
      border-radius: 50%;
      border: 5px solid #2D2D2D;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.3);
    }
    .icon-camera-big::after {
      content: '';
      position: absolute;
      top: 8px; right: 10px;
      width: 10px; height: 10px;
      background: #FF4444;
      border-radius: 50%;
      box-shadow: 0 0 6px #FF4444;
    }

    /* 中心卡片相机图标更大 */
    .card[data-index="2"] .icon-camera-big {
      width: 96px;
      height: 74px;
    }
    .card[data-index="2"] .icon-camera-big::before {
      width: 40px; height: 40px;
    }

    /* 地图图标 */
    .icon-map-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 工坊图标 */
    .icon-workshop-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 背包图标 */
    .icon-backpack-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 设置图标 */
    .icon-settings-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
      /* 缓慢旋转，适配低帧率 */
      animation: slowSpin 8s linear infinite;
    }
    @keyframes slowSpin { 
      from { transform: rotate(0deg); } 
      to { transform: rotate(360deg); } 
    }

    /* 返回按钮 */
    .back-btn {
      position: absolute;
      top: 32px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      border: none;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      color: var(--wood-primary);
      cursor: pointer;
      z-index: 50;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .floating-title {
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      padding: 6px 16px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 600;
      color: var(--wood-primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 50;
    }

    /* ============ AI 菜单浮层 ============ */
    .ai-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(30,40,80,0.92) 0%, rgba(20,30,60,0.98) 100%);
      backdrop-filter: blur(20px);
      border-radius: 20px 20px 0 0;
      padding: 12px 16px 14px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .ai-overlay.show {
      transform: translateY(0);
    }

    /* 左侧：标题+badge上下排列 */
    .ai-left-section {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .ai-title-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .ai-title {
      color: white;
      font-size: 14px;
      font-weight: 600;
    }

    .ai-context-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(255,255,255,0.12);
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 11px;
      color: rgba(255,255,255,0.9);
      white-space: nowrap;
      width: fit-content;
    }

    /* 中间：菜单项 */
    .ai-menu-grid {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .ai-menu-item {
      min-width: 72px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.1);
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .ai-menu-item:hover {
      background: rgba(255,255,255,0.18);
    }

    /* 右侧：关闭按钮 */
    .ai-close {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    /* 移除旧的header样式 */
    .ai-header {
      display: contents;
    }

    .ai-menu-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      flex-shrink: 0;
    }

    .ai-menu-icon.purple { background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%); }
    .ai-menu-icon.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .ai-menu-icon.yellow { background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); }
    .ai-menu-icon.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }
    .ai-menu-icon.pink { background: linear-gradient(135deg, #F472B6 0%, #EC4899 100%); }
    .ai-menu-icon.orange { background: linear-gradient(135deg, #FB923C 0%, #F97316 100%); }
    .ai-menu-icon.red { background: linear-gradient(135deg, #F87171 0%, #EF4444 100%); }
    .ai-menu-icon.cyan { background: linear-gradient(135deg, #22D3EE 0%, #06B6D4 100%); }

    .ai-menu-label {
      font-size: 11px;
      color: white;
      font-weight: 500;
      white-space: nowrap;
      text-align: center;
    }

    /* ============ PTT 浮层 ============ */
    .ptt-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: 20px 20px 0 0;
      padding: 14px 16px 16px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      z-index: 200;
    }
    .ptt-overlay.show {
      transform: translateY(0);
    }

    .ptt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .ptt-status {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ptt-status-dot {
      width: 8px;
      height: 8px;
      background: #EF4444;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }

    .ptt-status-dot.thinking { background: #FBBF24; }
    .ptt-status-dot.done { background: #4ADE80; animation: none; }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    .ptt-status-text {
      color: white;
      font-size: 11px;
    }

    .ptt-close {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }

    .ptt-content {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .ptt-character-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .ptt-character {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(255,165,0,0.4);
    }

    .ptt-character-switch {
      display: flex;
      gap: 4px;
    }

    .ptt-char-btn {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border: 2px solid transparent;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
    }

    .ptt-char-btn.active {
      background: rgba(255,255,255,0.25);
      border-color: #FFD700;
    }

    .ptt-voice-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ptt-waveform {
      height: 32px;
      background: rgba(255,255,255,0.08);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
      padding: 0 10px;
    }

    .ptt-wave-bar {
      width: 3px;
      background: linear-gradient(180deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 2px;
      animation: wave 0.5s ease-in-out infinite;
    }

    @keyframes wave {
      0%, 100% { transform: scaleY(0.5); }
      50% { transform: scaleY(1); }
    }

    .ptt-wave-bar:nth-child(1) { height: 10px; animation-delay: 0s; }
    .ptt-wave-bar:nth-child(2) { height: 18px; animation-delay: 0.1s; }
    .ptt-wave-bar:nth-child(3) { height: 24px; animation-delay: 0.2s; }
    .ptt-wave-bar:nth-child(4) { height: 14px; animation-delay: 0.15s; }
    .ptt-wave-bar:nth-child(5) { height: 20px; animation-delay: 0.25s; }
    .ptt-wave-bar:nth-child(6) { height: 28px; animation-delay: 0.1s; }
    .ptt-wave-bar:nth-child(7) { height: 16px; animation-delay: 0.2s; }
    .ptt-wave-bar:nth-child(8) { height: 22px; animation-delay: 0.05s; }

    .ptt-transcript {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 8px 12px;
      color: white;
      font-size: 13px;
      min-height: 32px;
    }

    .ptt-hint {
      text-align: center;
      color: rgba(255,255,255,0.5);
      font-size: 10px;
      margin-top: 6px;
    }

    /* PTT 回复状态 */
    .ptt-response-section {
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    .ptt-user-msg {
      background: rgba(74, 144, 217, 0.2);
      border: 1px solid rgba(74, 144, 217, 0.3);
      border-radius: 10px;
      padding: 8px 12px;
    }

    .ptt-msg-label {
      font-size: 9px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 3px;
    }

    .ptt-msg-text {
      color: white;
      font-size: 13px;
    }

    .ptt-ai-msg {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .ptt-ai-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .ptt-ai-content {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px 12px;
    }

    .ptt-ai-text {
      color: white;
      font-size: 13px;
      line-height: 1.4;
    }

    .ptt-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .ptt-action-btn {
      flex: 1;
      padding: 10px 14px;
      border: none;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .ptt-ask-more {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .ptt-continue-chat {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    /* ============ 二级卡片浮层 ============ */
    .ai-card-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }

    .ai-card-overlay.show {
      display: flex;
    }

    .ai-card {
      width: 280px;
      max-height: 340px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow: hidden;
      animation: cardAppear 0.25s ease-out;
    }

    @keyframes cardAppear {
      from { transform: scale(0.9) translateY(16px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .ai-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      border-bottom: 1px solid #F0F0F0;
    }

    .ai-card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 700;
      color: #333;
    }

    .ai-card-title-icon {
      font-size: 16px;
    }

    .ai-card-close {
      width: 24px;
      height: 24px;
      background: #F3F4F6;
      border: none;
      border-radius: 50%;
      color: #666;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ai-card-body {
      padding: 14px;
      max-height: 220px;
      overflow-y: auto;
    }

    .ai-card-footer {
      padding: 10px 14px 14px;
      border-top: 1px solid #F0F0F0;
      display: flex;
      gap: 8px;
    }

    .ai-card-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
    }

    .ai-card-btn-primary {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    .ai-card-btn-secondary {
      background: #F3F4F6;
      color: #333;
    }

    .ai-card-btn.primary {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    .ai-card-btn.secondary {
      background: #F3F4F6;
      color: #333;
    }

    /* AI卡片内部元素样式 */
    .task-list-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #F9FAFB;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    .task-list-item.completed { opacity: 0.6; }
    .task-list-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .task-list-content { flex: 1; }
    .task-list-title { font-size: 14px; font-weight: 600; color: #333; }
    .task-list-desc { font-size: 12px; color: #888; }
    .task-list-action { background: linear-gradient(135deg, #818CF8, #6366F1); color: white; border: none; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; }
    .task-list-done { color: #22C55E; font-size: 18px; font-weight: 700; }

    .fact-card { text-align: center; padding: 16px; }
    .fact-icon { font-size: 48px; margin-bottom: 8px; }
    .fact-species { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 8px; }
    .fact-text { font-size: 14px; color: #555; line-height: 1.5; margin-bottom: 12px; }
    .fact-analogy { font-size: 13px; color: #888; background: #FEF3C7; padding: 10px; border-radius: 10px; }

    .progress-section { text-align: center; margin-bottom: 16px; }
    .progress-avatar { font-size: 48px; margin-bottom: 8px; }
    .progress-level { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 8px; }
    .progress-bar-container { height: 10px; background: #E5E7EB; border-radius: 5px; overflow: hidden; margin-bottom: 6px; }
    .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #FBBF24, #F59E0B); border-radius: 5px; }
    .progress-text { font-size: 12px; color: #888; }

    .stats-row { display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #f0f0f0; }
    .stat-item { text-align: center; }
    .stat-number { font-size: 24px; font-weight: 700; color: #333; }
    .stat-label { font-size: 12px; color: #888; }

    .help-list-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; cursor: pointer; }
    .help-list-icon { font-size: 24px; }
    .help-list-title { font-size: 14px; font-weight: 600; color: #333; }
    .help-list-desc { font-size: 12px; color: #888; }

    .identify-result { text-align: center; padding: 16px; }
    .identify-thumb { font-size: 64px; margin-bottom: 12px; }
    .identify-name { font-size: 20px; font-weight: 700; color: #333; margin-bottom: 4px; }
    .identify-scientific { font-size: 12px; color: #888; font-style: italic; margin-bottom: 12px; }
    .identify-desc { font-size: 14px; color: #555; line-height: 1.5; }
    .identify-badge { margin-top: 12px; padding: 8px 12px; background: #D1FAE5; color: #059669; border-radius: 8px; font-size: 12px; font-weight: 600; }

    .tip-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px; background: #F9FAFB; border-radius: 10px; margin-bottom: 8px; }
    .tip-status { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
    .tip-status.good { background: #D1FAE5; }
    .tip-status.improve { background: #FEF3C7; }
    .tip-content { flex: 1; }
    .tip-title { font-size: 13px; font-weight: 600; color: #333; }
    .tip-desc { font-size: 12px; color: #888; }

    .effect-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .effect-item { padding: 12px; background: #F9FAFB; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; }
    .effect-item.active { border-color: #6366F1; background: #EEF2FF; }
    .effect-item-icon { font-size: 24px; margin-bottom: 4px; }
    .effect-item-name { font-size: 11px; color: #555; }

    .topic-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; cursor: pointer; }
    .topic-item:hover { background: #F3F4F6; }
    .topic-icon { font-size: 20px; }
    .topic-text { font-size: 14px; color: #333; }

    .story-option { display: flex; align-items: center; gap: 12px; padding: 14px; background: #F9FAFB; border-radius: 14px; margin-bottom: 10px; cursor: pointer; }
    .story-option:hover { background: #F3F4F6; }
    .story-option-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .story-option-icon.adventure { background: linear-gradient(135deg, #FEE2E2, #FECACA); }
    .story-option-icon.bedtime { background: linear-gradient(135deg, #E0E7FF, #C7D2FE); }
    .story-option-icon.funny { background: linear-gradient(135deg, #FEF3C7, #FDE68A); }
    .story-option-title { font-size: 14px; font-weight: 600; color: #333; }
    .story-option-desc { font-size: 12px; color: #888; }

    .quiz-reward { background: linear-gradient(135deg, #FEF3C7, #FDE68A); padding: 10px; border-radius: 10px; text-align: center; font-size: 13px; color: #92400E; margin-bottom: 12px; }
    .quiz-option { padding: 12px; background: #F9FAFB; border-radius: 10px; margin-bottom: 8px; font-size: 14px; color: #333; cursor: pointer; }
    .quiz-option.correct { background: #D1FAE5; color: #059669; }

    .filter-section { margin-bottom: 12px; }
    .filter-label { font-size: 12px; color: #888; margin-bottom: 8px; }
    .filter-chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .filter-chip { padding: 6px 12px; background: #F3F4F6; border-radius: 16px; font-size: 12px; color: #555; cursor: pointer; }
    .filter-chip.active { background: #EEF2FF; color: #6366F1; }

    .nearby-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; }
    .nearby-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .nearby-content { flex: 1; }
    .nearby-title { font-size: 14px; font-weight: 600; color: #333; }
    .nearby-desc { font-size: 12px; color: #888; }

    .guide-speech { display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: #F0FDF4; border-radius: 14px; margin-bottom: 12px; }
    .guide-avatar { font-size: 32px; }
    .guide-text { font-size: 14px; color: #333; line-height: 1.5; font-style: italic; }

    .surprise-combo { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 20px; }
    .surprise-photo { font-size: 48px; }
    .surprise-plus { font-size: 24px; color: #888; }
    .surprise-style { font-size: 14px; font-weight: 600; color: #333; text-align: center; }
    .surprise-hint { text-align: center; font-size: 12px; color: #888; }

    .creations-count { text-align: center; font-size: 14px; color: #555; padding: 20px; }

    .ai-generic-assistant { text-align: center; padding: 20px; }
    .ai-generic-avatar { font-size: 48px; margin-bottom: 12px; }
    .ai-generic-text { font-size: 14px; color: #555; font-style: italic; margin-bottom: 16px; }
    .ai-generic-btn { background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }

    .ai-generic-row { display: flex; align-items: center; gap: 12px; }
    .ai-generic-row .ai-generic-avatar { font-size: 28px; margin: 0; }
    .ai-generic-row .ai-generic-text { font-size: 13px; color: rgba(255,255,255,0.8); font-style: italic; margin: 0; }
    .ai-generic-row .ai-generic-btn { background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%); color: white; border: none; padding: 8px 16px; border-radius: 10px; font-size: 12px; font-weight: 600; cursor: pointer; white-space: nowrap; }

    /* ============ Camera 相机页 ============ */
    #camera-page {
      background: #1a1a2e;
    }

    .camera-container {
      width: 100%;
      height: 100%;
      position: relative;
      /* 整个页面都是取景器 */
      background: url('https://images.unsplash.com/photo-1518882605630-8eb582f64194?w=640&h=480&fit=crop') center/cover;
      overflow: hidden;
    }

    /* 复古取景框四角装饰 - 居中对称 */
    .viewfinder-corner {
      position: absolute;
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 220, 120, 0.8);
      pointer-events: none;
      z-index: 10;
    }
    .viewfinder-corner.top-left { top: 60px; left: 80px; border-right: none; border-bottom: none; border-radius: 4px 0 0 0; }
    .viewfinder-corner.top-right { top: 60px; right: 80px; border-left: none; border-bottom: none; border-radius: 0 4px 0 0; }
    .viewfinder-corner.bottom-left { bottom: 90px; left: 80px; border-right: none; border-top: none; border-radius: 0 0 0 4px; }
    .viewfinder-corner.bottom-right { bottom: 90px; right: 80px; border-left: none; border-top: none; border-radius: 0 0 4px 0; }

    /* 顶部工具栏 - 透明无背景 */
    .camera-top-bar {
      position: absolute;
      top: 10px; left: 14px; right: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 20;
    }

    .camera-back-btn {
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-back-btn:hover { background: rgba(0, 0, 0, 0.65); }

    .camera-hint {
      background: rgba(0, 0, 0, 0.45);
      border: 1px solid rgba(255, 200, 50, 0.5);
      color: #FFE4A0;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(4px);
    }

    .camera-top-right {
      display: flex;
      gap: 10px;
    }

    .camera-tool-btn {
      width: 36px;
      height: 36px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-tool-btn:hover { background: rgba(0, 0, 0, 0.65); }
    .camera-tool-btn.active { background: rgba(255, 180, 0, 0.6); color: #FFF; }
      transition: all 0.2s;
    }
    .camera-tool-btn:hover { background: rgba(255, 255, 255, 0.25); }
    .camera-tool-btn.active { background: rgba(255, 200, 50, 0.4); color: #FFE135; }

    /* 底部控制栏 - 居中放置工具按钮 */
    .camera-bottom-bar {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 24px;
      z-index: 20;
    }

    /* 左下角相册按钮 */
    .camera-gallery-btn {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 48px;
      height: 48px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: all 0.2s;
    }
    .camera-gallery-btn:hover {
      background: rgba(0, 0, 0, 0.65);
      border-color: rgba(255, 255, 255, 0.5);
    }

    /* 右侧快门按钮 */
    .camera-shutter-area {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 20;
    }

    /* 底部工具按钮 */
    .camera-tool-bottom {
      width: 44px;
      height: 44px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-tool-bottom:hover { background: rgba(0, 0, 0, 0.65); }
    .camera-tool-bottom.active { background: rgba(255, 180, 0, 0.6); color: #FFF; }

    /* 快门按钮 - 拟物金属质感 */
    .shutter-btn {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      position: relative;
      transition: transform 0.15s ease;
    }

    .shutter-btn-outer {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(180deg, #E8E8E8 0%, #B8B8B8 50%, #888 100%);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(255,255,255,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .shutter-btn-inner {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 50%, #E6B800 100%);
      box-shadow: 
        0 2px 8px rgba(0,0,0,0.3),
        inset 0 2px 4px rgba(255,255,255,0.6);
    }

    .shutter-btn:active {
      transform: scale(0.92);
    }
    .shutter-btn:active .shutter-btn-inner {
      background: linear-gradient(180deg, #E6B800 0%, #CC9900 50%, #B38600 100%);
    }

    /* 拍照闪光效果 */
    .camera-flash {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 100;
      transition: opacity 0.1s;
    }
    .camera-flash.active {
      opacity: 1;
    }

    /* ============ Photo Preview 照片预览页 ============ */
    #photo-preview-page {
      /* 使用page-blur-bg统一背景 */
    }

    .preview-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* 返回按钮 */
    .preview-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .preview-back-btn:hover { background: rgba(0, 0, 0, 0.7); }

    /* 全屏照片 */
    .preview-photo-fullscreen {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* AI提示 */
    .preview-ai-hint {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 20px;
      color: rgba(255, 255, 255, 0.95);
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(4px);
      animation: hint-pulse 2s ease-in-out infinite;
    }
    @keyframes hint-pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* ============ Chat 照片聊天页 ============ */
    #chat-page {
      /* 使用page-blur-bg统一背景 */
    }

    .chat-container {
      width: 100%;
      height: 100%;
      display: flex;
      position: relative;
    }

    /* 返回按钮 */
    .chat-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .chat-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 左侧照片区域 - 45% */
    .chat-photo-section {
      width: 45%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 50px 16px 16px 20px;
    }

    .chat-photo-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F8F6F0 100%);
      border-radius: 4px;
      padding: 10px 10px 28px 10px;
      box-shadow: 0 10px 32px rgba(0, 0, 0, 0.2);
      transform: rotate(-3deg);
      position: relative;
    }

    .chat-photo-card img {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 2px;
      display: block;
    }

    /* 胶带装饰 */
    .chat-tape {
      position: absolute;
      width: 50px;
      height: 18px;
      background: linear-gradient(180deg, rgba(255, 245, 190, 0.92) 0%, rgba(245, 225, 150, 0.88) 100%);
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .chat-tape.top {
      top: -6px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
    }
    .chat-tape.bottom-right {
      bottom: 12px;
      right: -12px;
      transform: rotate(-35deg);
      width: 44px;
      height: 16px;
    }

    /* 照片标注 */
    .chat-photo-label {
      position: absolute;
      bottom: 6px;
      left: 12px;
      font-size: 11px;
      color: #888;
      font-style: italic;
    }

    /* 右侧对话区域 - 55% */
    .chat-conversation-section {
      width: 55%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 50px 20px 16px 8px;
    }

    /* 消息列表 */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-right: 6px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 4px;
    }
    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.15);
      border-radius: 2px;
    }

    /* 单条消息 */
    .chat-message {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      max-width: 95%;
    }

    .chat-message.ai { align-self: flex-start; }
    .chat-message.user { align-self: flex-end; flex-direction: row-reverse; }

    .chat-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .chat-avatar.ai-avatar {
      background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .chat-avatar.user-avatar {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .chat-bubble {
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 13px;
      line-height: 1.45;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .chat-message.ai .chat-bubble {
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      color: #333;
      border-bottom-left-radius: 4px;
    }

    .chat-message.user .chat-bubble {
      background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    /* 底部输入区 */
    .chat-input-area {
      margin-top: 12px;
    }

    .chat-speak-btn {
      width: 100%;
      padding: 12px 20px;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
      border: none;
      border-radius: 24px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      color: #5D4E3A;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(255, 200, 0, 0.3);
      transition: all 0.2s;
    }
    .chat-speak-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(255, 200, 0, 0.4);
    }
    .chat-speak-btn:active {
      transform: translateY(0);
    }

    /* ============ General Chat 通用聊天页 ============ */
    #general-chat-page {
      /* 使用page-blur-bg统一背景 */
    }

    .general-chat-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 50px 24px 16px;
      position: relative;
    }

    /* 返回按钮 */
    .general-chat-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .general-chat-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 消息列表 */
    .general-chat-messages {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 8px 4px;
    }

    .general-chat-messages::-webkit-scrollbar {
      width: 4px;
    }
    .general-chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .general-chat-messages::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.15);
      border-radius: 2px;
    }

    /* 通用聊天气泡样式复用 chat-message */

    /* 底部输入区 */
    .general-chat-input-area {
      margin-top: 12px;
    }

    .general-chat-speak-btn {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
      border: none;
      border-radius: 28px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      color: #5D4E3A;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 14px rgba(255, 200, 0, 0.35);
      transition: all 0.2s;
    }
    .general-chat-speak-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(255, 200, 0, 0.45);
    }
    .general-chat-speak-btn:active {
      transform: translateY(0);
    }

    /* ============ Map 地图页 ============ */
    #map-page {
      background: #D4C4A8;
    }

    .map-container {
      width: 100%;
      height: 100%;
      /* 藏宝图背景图片 */
      background: url('treasure-map.png') center/cover no-repeat;
      position: relative;
      overflow: hidden;
    }

    /* 地图纹理叠加 - 保留轻微暗角效果 */
    .map-texture {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.15) 100%);
      pointer-events: none;
    }

    /* 返回按钮 */
    .map-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .map-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 任务徽章 */
    .map-task-badge {
      position: absolute;
      top: 12px;
      right: 14px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      padding: 8px 14px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: #5D4E3A;
      box-shadow: 0 3px 12px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .task-dot {
      width: 10px;
      height: 10px;
      background: #E74C3C;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    /* 地图标记点 */
    .map-pin {
      position: absolute;
      cursor: pointer;
      transition: transform 0.3s ease;
      z-index: 15;
    }
    .map-pin:hover { transform: scale(1.12); }

    .pin-marker {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.3);
      animation: float 3s ease-in-out infinite;
    }
    .pin-marker.red { background: linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%); }
    .pin-marker.gold { background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%); }
    .pin-marker.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .pin-marker.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .pin-label {
      position: absolute;
      bottom: 56px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: #5D4E3A;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.2s;
    }
    .map-pin:hover .pin-label { opacity: 1; }

    .pin-status {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: white;
      font-weight: 700;
      border: 2px solid white;
    }
    .pin-status.active { background: #E74C3C; animation: pulse 1.5s infinite; }
    .pin-status.done { background: #22C55E; }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    /* 指南针 */
    .map-compass {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 52px;
      height: 52px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 14px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .compass-arrow {
      font-size: 11px;
      font-weight: 700;
      color: #E74C3C;
    }

    /* 路径装饰 */
    .map-path {
      position: absolute;
      border: 2px dashed rgba(255,255,255,0.25);
      border-radius: 50%;
      pointer-events: none;
    }

    /* 任务弹窗 */
    .task-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .task-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .task-modal {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      padding: 24px;
      width: 320px;
      box-shadow: 0 12px 48px rgba(0,0,0,0.3);
      transform: scale(0.9);
      transition: transform 0.25s;
    }
    .task-modal-overlay.show .task-modal {
      transform: scale(1);
    }

    .task-modal-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .task-modal-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .task-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .task-modal-difficulty {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
    }

    .task-modal-desc {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .task-modal-reward {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: rgba(255, 200, 0, 0.15);
      border-radius: 12px;
      margin-bottom: 18px;
      font-size: 13px;
      color: #92400E;
    }

    .task-modal-actions {
      display: flex;
      gap: 12px;
    }

    .task-btn {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-btn-accept {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
    .task-btn-accept:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
    }

    .task-btn-decline {
      background: #E8E4DC;
      color: #666;
    }
    .task-btn-decline:hover {
      background: #DDD8CE;
    }

    /* ============ Workshop 工坊入口页 ============ */
    #workshop-page {
      /* 使用page-blur-bg统一背景 */
    }

    .workshop-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* 返回按钮 */
    .workshop-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .workshop-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 风格卡片滚动容器 */
    .style-cards-container {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 50px 50px 30px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .style-cards-container::-webkit-scrollbar {
      display: none;
    }

    /* 风格卡片 - 放大版 */
    .style-card {
      flex: 0 0 200px;
      height: 340px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      box-shadow: 0 10px 32px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      scroll-snap-align: center;
    }
    .style-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
    }
    .style-card:active { transform: scale(0.97); }

    .style-preview {
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 90px;
    }
    .style-ghibli { background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFE4B5 100%); }
    .style-pixel { background: linear-gradient(135deg, #A78BFA 0%, #60A5FA 50%, #34D399 100%); }
    .style-watercolor { background: linear-gradient(135deg, #FDA4AF 0%, #93C5FD 50%, #C4B5FD 100%); }
    .style-cartoon { background: linear-gradient(135deg, #F87171 0%, #FBBF24 50%, #2DD4BF 100%); }

    .style-info {
      flex: 1;
      padding: 14px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
    }

    .style-name {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .style-try-btn {
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .style-try-btn:hover {
      background: linear-gradient(180deg, #8B5A2B 0%, #6B4423 100%);
    }

    /* ============ Photo Effect 风格选择页 ============ */
    #photo-effect-page {
      /* 使用page-blur-bg统一背景 */
    }

    .effect-container {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .effect-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 风格卡片滚动容器 */
    .effect-cards-scroll {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 50px 50px 30px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .effect-cards-scroll::-webkit-scrollbar {
      display: none;
    }

    /* 单张风格卡片 */
    .effect-card {
      flex: 0 0 200px;
      height: 340px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 36px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      scroll-snap-align: center;
    }
    .effect-card:hover {
      transform: scale(1.03);
    }
    .effect-card.selected {
      box-shadow: 0 0 0 4px #FFD700, 0 10px 36px rgba(0,0,0,0.3);
    }

    /* 效果预览区 */
    .effect-card-preview {
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 90px;
    }

    /* 底部信息区 */
    .effect-card-info {
      flex: 1;
      padding: 14px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
    }

    .effect-card-name {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .effect-try-btn {
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    /* ============ Workshop Photo 选图页 ============ */
    #workshop-photo-page {
      /* 使用page-blur-bg统一背景 */
    }

    .photo-select-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 50px 20px 16px;
      position: relative;
    }

    .photo-select-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    /* 已选风格横幅 */
    .selected-style-banner {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 14px;
      padding: 10px 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
    }

    .style-badge {
      background: linear-gradient(135deg, #A67C52 0%, #8B5A2B 100%);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .style-badge-hint {
      color: #888;
      font-size: 13px;
    }

    /* 照片选择网格 */
    .photo-select-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .photo-select-item {
      aspect-ratio: 1;
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .photo-select-item:hover {
      transform: scale(1.04);
      box-shadow: 0 5px 16px rgba(0,0,0,0.15);
    }
    .photo-select-item.selected {
      box-shadow: 0 0 0 3px #FFD700, 0 5px 16px rgba(0,0,0,0.15);
    }

    .photo-select-item.take-new {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      flex-direction: column;
      gap: 4px;
    }
    .photo-select-item.take-new .take-new-label {
      font-size: 11px;
      font-weight: 600;
      color: #92400E;
    }

    /* 底部操作栏 */
    .photo-select-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .aigc-agreement {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #666;
    }

    .aigc-agreement input {
      width: 18px;
      height: 18px;
      accent-color: #8B5A2B;
    }

    .create-btn {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      color: #5D4E3A;
      border: none;
      padding: 12px 24px;
      border-radius: 16px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(255, 200, 0, 0.35);
      transition: all 0.2s;
    }
    .create-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(255, 200, 0, 0.45);
    }
    .create-btn:disabled {
      background: #CCC;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* ============ AIGC 生成弹窗 ============ */
    .aigc-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .aigc-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .aigc-modal {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      padding: 24px;
      width: 320px;
      box-shadow: 0 16px 56px rgba(0,0,0,0.3);
      transform: scale(0.9);
      transition: transform 0.25s;
    }
    .aigc-modal-overlay.show .aigc-modal {
      transform: scale(1);
    }

    .aigc-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
      text-align: center;
      margin-bottom: 16px;
    }

    /* 生成中状态 */
    .aigc-generating {
      text-align: center;
      padding: 20px 0;
    }

    .aigc-spinner {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      animation: spin-bounce 1.5s ease-in-out infinite;
    }

    @keyframes spin-bounce {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.05); }
      50% { transform: rotate(180deg) scale(1); }
      75% { transform: rotate(270deg) scale(1.05); }
    }

    .aigc-progress-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }

    .aigc-progress-bar {
      width: 100%;
      height: 8px;
      background: #E8E4DC;
      border-radius: 4px;
      overflow: hidden;
    }

    .aigc-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #FFD700 0%, #F59E0B 100%);
      border-radius: 4px;
      transition: width 0.3s;
    }

    /* 生成完成状态 */
    .aigc-result {
      text-align: center;
    }

    .aigc-result-image {
      width: 180px;
      height: 180px;
      margin: 0 auto 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFE4B5 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .aigc-result-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    .aigc-result-actions {
      display: flex;
      gap: 12px;
    }

    .aigc-result-btn {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .aigc-result-btn.secondary {
      background: #E8E4DC;
      color: #5D4E3A;
    }

    .aigc-result-btn.primary {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      color: white;
    }

    /* ============ Backpack 背包页 ============ */
    #backpack-page {
      /* 使用page-blur-bg统一背景 */
    }

    .backpack-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 20px 16px;
      position: relative;
    }

    .backpack-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* Tab栏 */
    .backpack-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
    }

    .backpack-tab {
      flex: 1;
      background: rgba(0, 0, 0, 0.25);
      border: none;
      border-radius: 14px;
      padding: 12px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    .backpack-tab.active {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      color: #5D4E3A;
      text-shadow: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* 内容区 */
    .backpack-content {
      flex: 1;
      overflow-y: auto;
    }

    /* 相册网格 */
    .album-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .album-item {
      aspect-ratio: 1;
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transition: all 0.2s;
    }
    .album-item:hover { transform: scale(1.04); }

    /* 图鉴分类网格 */
    .guide-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .guide-item {
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 16px;
      padding: 16px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    .guide-item:hover { transform: translateY(-3px); }

    .guide-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 3px 8px rgba(34, 197, 94, 0.3);
    }

    .guide-name {
      font-size: 13px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .guide-count {
      font-size: 11px;
      color: #888;
    }

    /* 徽章网格 */
    .badge-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .badge-item {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      border-radius: 16px;
      padding: 16px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      transition: all 0.2s;
    }
    .badge-item:hover { transform: scale(1.03); }
    .badge-item.locked {
      background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%);
      opacity: 0.6;
      box-shadow: none;
    }

    .badge-icon { font-size: 32px; }
    .badge-name {
      font-size: 11px;
      font-weight: 600;
      color: #5D4E3A;
      text-align: center;
    }
    .badge-item.locked .badge-name { color: #444; }

    /* ============ Species List 图鉴列表页 ============ */
    #species-list-page {
      /* 使用page-blur-bg统一背景 */
    }

    .species-list-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 20px 16px;
      position: relative;
    }

    .species-list-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 列表头部 */
    .species-list-header {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 16px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
    }

    .species-list-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .species-list-title {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .species-list-count {
      font-size: 12px;
      color: #888;
    }

    /* 物种卡片网格 - 3列 */
    .species-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      overflow-y: auto;
    }

    .species-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    }
    .species-card:hover { transform: translateY(-3px); }

    .species-card-img {
      height: 90px;
      background: linear-gradient(135deg, #E0F2FE 0%, #DBEAFE 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
    }

    .species-card-info {
      padding: 10px;
      text-align: center;
    }

    .species-card-name {
      font-size: 13px;
      font-weight: 700;
      color: #5D4E3A;
      margin-bottom: 2px;
    }

    .species-card-date {
      font-size: 10px;
      color: #888;
    }

    /* ============ Species Detail 图鉴详情页 ============ */
    #species-detail-page {
      /* 使用page-blur-bg统一背景 */
    }

    .species-detail-container {
      width: 100%;
      height: 100%;
      display: flex;
      padding: 56px 20px 16px;
      gap: 16px;
      position: relative;
    }

    .species-detail-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 左侧照片 */
    .species-detail-photo {
      width: 45%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .species-photo-frame {
      background: linear-gradient(180deg, #FFFEF8 0%, #F8F6F0 100%);
      padding: 10px 10px 28px 10px;
      border-radius: 4px;
      box-shadow: 0 10px 32px rgba(0,0,0,0.2);
      transform: rotate(-2deg);
      position: relative;
    }

    .species-photo-frame img {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 2px;
      display: block;
    }

    .species-photo-tape {
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
      width: 50px;
      height: 18px;
      background: linear-gradient(180deg, rgba(255, 245, 190, 0.9) 0%, rgba(245, 225, 150, 0.85) 100%);
    }

    /* 右侧信息 */
    .species-detail-info {
      width: 55%;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .species-info-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 20px;
      padding: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    .species-info-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(0,0,0,0.06);
    }

    .species-info-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .species-info-name {
      font-size: 16px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .species-info-latin {
      font-size: 11px;
      color: #888;
      font-style: italic;
    }

    /* 趣味知识 */
    .species-fun-facts {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fun-fact {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 12px;
    }

    .fun-fact-icon {
      font-size: 18px;
      flex-shrink: 0;
    }

    .fun-fact-text {
      font-size: 12px;
      color: #555;
      line-height: 1.45;
    }

    /* ============ Settings 设置页 ============ */
    #settings-page {
      /* 使用page-blur-bg统一背景 */
    }

    .settings-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 20px 16px;
      position: relative;
    }

    .settings-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 设置列表 */
    .settings-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
    }

    .settings-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .settings-group-title {
      color: #5D4E3A;
      font-size: 12px;
      font-weight: 700;
      padding-left: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }

    .settings-group-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .settings-item {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .settings-item:last-child {
      border-bottom: none;
    }
    .settings-item:hover {
      background: rgba(0,0,0,0.02);
    }

    .settings-item-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .settings-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .settings-icon.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .settings-icon.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }
    .settings-icon.orange { background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); }
    .settings-icon.purple { background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%); }
    .settings-icon.gray { background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%); }
    .settings-icon.red { background: linear-gradient(135deg, #F87171 0%, #EF4444 100%); }

    .settings-label {
      font-size: 14px;
      font-weight: 600;
      color: #5D4E3A;
    }

    .settings-value {
      font-size: 12px;
      color: #888;
      margin-top: 1px;
    }

    .settings-chevron {
      color: #CCC;
      font-size: 18px;
      font-weight: 300;
    }

    /* 开关 */
    .toggle-switch {
      width: 46px;
      height: 26px;
      background: #D1D5DB;
      border-radius: 13px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }
    .toggle-switch.active {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
    }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    /* 滑块 */
    .settings-slider {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider-track {
      width: 100px;
      height: 6px;
      background: #E5E7EB;
      border-radius: 3px;
      position: relative;
    }

    .slider-fill {
      height: 100%;
      background: linear-gradient(90deg, #60A5FA 0%, #3B82F6 100%);
      border-radius: 3px;
    }

    .slider-value {
      font-size: 12px;
      font-weight: 600;
      color: #5D4E3A;
      min-width: 32px;
    }
  </style>
</head>
<body>

  <div class="prototype-container">
    <!-- 左侧页面列表 -->
    <div class="page-list">
      <div class="page-list-title">页面列表</div>
      
      <div class="page-list-item active" onclick="navigateTo('home-page')">
        <span class="icon">🏠</span>
        <span>主页</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('camera-page')">
        <span class="icon">📷</span>
        <span>相机</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('photo-preview-page')">
        <span class="icon">🖼️</span>
        <span>照片预览</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('chat-page')">
        <span class="icon">💬</span>
        <span>照片聊天</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('general-chat-page')">
        <span class="icon">🗣️</span>
        <span>通用聊天</span>
      </div>
      
      <div class="page-list-section">
        <div class="page-list-section-title">探索</div>
        <div class="page-list-item" onclick="navigateTo('map-page')">
          <span class="icon">🗺️</span>
          <span>地图</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('workshop-page')">
          <span class="icon">🎨</span>
          <span>工坊</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('photo-effect-page')">
          <span class="icon">✨</span>
          <span>风格选择</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('workshop-photo-page')">
          <span class="icon">📷</span>
          <span>工坊选图</span>
        </div>
      </div>
      
      <div class="page-list-section">
        <div class="page-list-section-title">收藏</div>
        <div class="page-list-item" onclick="navigateTo('backpack-page')">
          <span class="icon">🎒</span>
          <span>背包</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('species-list-page')">
          <span class="icon">📖</span>
          <span>图鉴</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('settings-page')">
          <span class="icon">⚙️</span>
          <span>设置</span>
        </div>
      </div>
    </div>

    <!-- 中间设备屏幕 -->
    <div class="device-frame">
      <div class="device-screen">
        <!-- 天空背景 -->
        <div class="sky-bg">
          <div class="cloud cloud-1"></div>
          <div class="cloud cloud-2"></div>
          <div class="cloud cloud-3"></div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar">
          <div class="status-left"><span>10:30</span></div>
          <div class="status-right">
            <span>📶</span>
            <span>87%</span>
            <span>🔋</span>
          </div>
        </div>

        <!-- ========== Home 页面 ========== -->
        <div id="home-page" class="page active">
          <div class="carousel-container" id="carousel">
            <div class="card" data-page="camera-page" onclick="handleCardClick(0)">
              <div class="card-icon"><img src="icons/Camera.png" alt="Camera"></div>
              <div class="card-label">Camera</div>
            </div>
            <div class="card" data-page="map-page" onclick="handleCardClick(1)">
              <div class="card-icon"><img src="icons/Map.png" alt="Map"></div>
              <div class="card-label">Map</div>
            </div>
            <div class="card" data-page="workshop-page" onclick="handleCardClick(2)">
              <div class="card-icon"><img src="icons/Workshop.png" alt="Workshop"></div>
              <div class="card-label">Workshop</div>
            </div>
            <div class="card" data-page="backpack-page" onclick="handleCardClick(3)">
              <div class="card-icon"><img src="icons/Backpack.png" alt="Backpack"></div>
              <div class="card-label">Backpack</div>
            </div>
            <div class="card" data-page="settings-page" onclick="handleCardClick(4)">
              <div class="card-icon"><img src="icons/Settings.png" alt="Settings"></div>
              <div class="card-label">Settings</div>
            </div>
          </div>
        </div>

        <!-- ========== Camera 相机页 ========== -->
        <div id="camera-page" class="page">
          <div class="camera-container">
            <!-- 复古取景框四角 -->
            <div class="viewfinder-corner top-left"></div>
            <div class="viewfinder-corner top-right"></div>
            <div class="viewfinder-corner bottom-left"></div>
            <div class="viewfinder-corner bottom-right"></div>
            
            <!-- 顶部工具栏 - 只有返回和提示 -->
            <div class="camera-top-bar">
              <button class="camera-back-btn" onclick="navigateTo('home-page')">
                <span>←</span>
                <span>Back</span>
              </button>
              
              <div class="camera-hint">
                <span>🎯</span>
                <span>Point at something!</span>
              </div>
              
              <div style="width: 70px;"></div>
            </div>
            
            <!-- 左下角相册 -->
            <button class="camera-gallery-btn" onclick="openGallery()">🖼️</button>
            
            <!-- 底部居中工具栏 -->
            <div class="camera-bottom-bar">
              <button class="camera-tool-bottom" id="flash-btn" onclick="toggleFlash()">⚡</button>
              <button class="camera-tool-bottom" id="zoom-btn" onclick="toggleZoom()"><span id="zoom-label">1×</span></button>
              <button class="camera-tool-bottom" id="grid-btn" onclick="toggleGrid()">⊞</button>
            </div>
            
            <!-- 右侧快门按钮 -->
            <div class="camera-shutter-area">
              <button class="shutter-btn" onclick="takePhoto()">
                <div class="shutter-btn-outer">
                  <div class="shutter-btn-inner"></div>
                </div>
              </button>
            </div>
            
            <!-- 闪光效果 -->
            <div class="camera-flash" id="camera-flash"></div>
          </div>
        </div>

        <!-- ========== Photo Preview 照片预览页 ========== -->
        <div id="photo-preview-page" class="page page-blur-bg">
          <div class="preview-container">
            <!-- 返回按钮 -->
            <button class="preview-back-btn" onclick="navigateTo('camera-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 全屏照片 -->
            <img class="preview-photo-fullscreen" src="https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=640&h=480&fit=crop" alt="Photo">

            <!-- AI提示 -->
            <div class="preview-ai-hint">✨ Press AI to explore</div>
          </div>
        </div>

        <!-- ========== Chat 照片聊天页 ========== -->
        <div id="chat-page" class="page page-blur-bg">
          <div class="chat-container">
            <!-- 返回按钮 -->
            <button class="chat-back-btn" onclick="navigateTo('photo-preview-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 左侧照片 -->
            <div class="chat-photo-section">
              <div class="chat-photo-card">
                <div class="chat-tape top"></div>
                <div class="chat-tape bottom-right"></div>
                <img src="https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=300&h=225&fit=crop" alt="Photo">
                <div class="chat-photo-label">My discovery ✨</div>
              </div>
            </div>

            <!-- 右侧对话 -->
            <div class="chat-conversation-section">
              <div class="chat-messages">
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Wow, look at this! I can see a beautiful ladybug. Do you know why they have spots? 🐞</div>
                </div>
                <div class="chat-message user">
                  <div class="chat-avatar user-avatar">👦</div>
                  <div class="chat-bubble">They are red and black!</div>
                </div>
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Great observation! The bright colors warn birds: "Don't eat me, I taste yucky!" 🙅‍♂️</div>
                </div>
                <div class="chat-message user">
                  <div class="chat-avatar user-avatar">👦</div>
                  <div class="chat-bubble">That's so cool!</div>
                </div>
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Did you know ladybugs can eat up to 50 tiny bugs called aphids every day? They're like tiny garden superheroes! 🦸</div>
                </div>
              </div>

              <!-- 底部输入 -->
              <div class="chat-input-area">
                <button class="chat-speak-btn">
                  <span>🎤</span>
                  <span>Hold to Speak</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== General Chat 通用聊天页 ========== -->
        <div id="general-chat-page" class="page page-blur-bg">
          <div class="general-chat-container">
            <!-- 返回按钮 -->
            <button class="general-chat-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 消息列表 -->
            <div class="general-chat-messages">
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Hi there, little explorer! 👋 What would you like to discover today?</div>
              </div>
              <div class="chat-message user">
                <div class="chat-avatar user-avatar">👦</div>
                <div class="chat-bubble">Tell me about butterflies!</div>
              </div>
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Butterflies are amazing! 🦋 They start as tiny caterpillars, then wrap themselves in a cozy cocoon, and come out with beautiful wings!</div>
              </div>
              <div class="chat-message user">
                <div class="chat-avatar user-avatar">👦</div>
                <div class="chat-bubble">How do they fly?</div>
              </div>
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Great question! Their wings are covered with tiny scales that catch the air. They flap about 5-12 times per second - much slower than bees! That's why they look so graceful. 🌸</div>
              </div>
            </div>

            <!-- 底部输入 -->
            <div class="general-chat-input-area">
              <button class="general-chat-speak-btn">
                <span>🎤</span>
                <span>Hold to Speak</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ========== Map 地图页 ========== -->
        <div id="map-page" class="page">
          <div class="map-container">
            <div class="map-texture"></div>

            <!-- 返回按钮 -->
            <button class="map-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 任务徽章 -->
            <div class="map-task-badge">
              <div class="task-dot"></div>
              <span>3 Tasks Nearby</span>
            </div>

            <!-- 装饰路径 -->
            <div class="map-path" style="width: 180px; height: 120px; top: 160px; left: 200px;"></div>
            <div class="map-path" style="width: 140px; height: 100px; top: 220px; left: 380px;"></div>

            <!-- 地图标记点 -->
            <div class="map-pin" style="left: 100px; top: 180px;" onclick="showTaskModal('flower')">
              <div class="pin-label">🌸 Find a Flower</div>
              <div class="pin-marker red">🌸</div>
              <div class="pin-status active">!</div>
            </div>

            <div class="map-pin" style="left: 300px; top: 260px;" onclick="showTaskModal('butterfly')">
              <div class="pin-label">🦋 Spot a Butterfly</div>
              <div class="pin-marker gold">🦋</div>
            </div>

            <div class="map-pin" style="left: 500px; top: 150px;" onclick="showTaskModal('rock')">
              <div class="pin-label">🪨 Cool Rock Hunt</div>
              <div class="pin-marker green">✓</div>
              <div class="pin-status done">✓</div>
            </div>

            <div class="map-pin" style="left: 420px; top: 340px;" onclick="showTaskModal('leaf')">
              <div class="pin-label">🍂 Collect Leaves</div>
              <div class="pin-marker blue">🍂</div>
            </div>

            <!-- 指南针 -->
            <div class="map-compass">
              <span class="compass-arrow">N ↑</span>
            </div>

            <!-- 任务弹窗 -->
            <div class="task-modal-overlay" id="task-modal-overlay" onclick="hideTaskModal()">
              <div class="task-modal" onclick="event.stopPropagation()">
                <div class="task-modal-header">
                  <div class="task-modal-icon" id="task-modal-icon" style="background: linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%);">🌸</div>
                  <div>
                    <div class="task-modal-title" id="task-modal-title">Find a Flower</div>
                    <div class="task-modal-difficulty">⭐ Easy • 5 min</div>
                  </div>
                </div>
                <div class="task-modal-desc" id="task-modal-desc">
                  Look around for any beautiful flowers! Take a photo when you find one. Can you spot different colors? 🌈
                </div>
                <div class="task-modal-reward">
                  <span>🏆</span>
                  <span>Reward: +10 XP & Flower Badge</span>
                </div>
                <div class="task-modal-actions">
                  <button class="task-btn task-btn-decline" onclick="hideTaskModal()">Maybe Later</button>
                  <button class="task-btn task-btn-accept" onclick="acceptTask()">Let's Go! 🚀</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Workshop 工坊入口页 ========== -->
        <div id="workshop-page" class="page page-blur-bg">
          <div class="workshop-container">
            <button class="workshop-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 风格卡片 - 可横向滑动，一页3张 -->
            <div class="style-cards-container">
              <div class="style-card" onclick="selectStyle('Ghibli', '🏔️')">
                <div class="style-preview style-ghibli">🏔️</div>
                <div class="style-info">
                  <div class="style-name">Ghibli</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Pixel Art', '👾')">
                <div class="style-preview style-pixel">👾</div>
                <div class="style-info">
                  <div class="style-name">Pixel Art</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Watercolor', '🎨')">
                <div class="style-preview style-watercolor">🎨</div>
                <div class="style-info">
                  <div class="style-name">Watercolor</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Cartoon', '🎬')">
                <div class="style-preview style-cartoon">🎬</div>
                <div class="style-info">
                  <div class="style-name">Cartoon</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Photo Effect 风格选择页 ========== -->
        <div id="photo-effect-page" class="page page-blur-bg">
          <div class="effect-container">
            <button class="effect-back-btn" onclick="navigateTo('photo-preview-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 风格选择 - 可滑动，一页3张 -->
            <div class="effect-cards-scroll">
              <div class="effect-card selected" onclick="selectEffectCard(this, 'Ghibli', '🏔️')">
                <div class="effect-card-preview style-ghibli">🏔️</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Ghibli</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Pixel Art', '👾')">
                <div class="effect-card-preview style-pixel">👾</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Pixel Art</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Watercolor', '🎨')">
                <div class="effect-card-preview style-watercolor">🎨</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Watercolor</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Cartoon', '🎬')">
                <div class="effect-card-preview style-cartoon">🎬</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Cartoon</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Sketch', '✏️')">
                <div class="effect-card-preview" style="background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);">✏️</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Sketch</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
            </div>

            <!-- AIGC弹窗 -->
            <div class="aigc-modal-overlay" id="aigc-modal-overlay">
              <div class="aigc-modal" onclick="event.stopPropagation()">
                <div class="aigc-modal-title">✨ Creating Magic Art</div>
                
                <!-- 生成中 -->
                <div class="aigc-generating" id="aigc-generating">
                  <div class="aigc-spinner">🎨</div>
                  <div class="aigc-progress-text">Transforming your photo...</div>
                  <div class="aigc-progress-bar">
                    <div class="aigc-progress-fill" id="aigc-progress" style="width: 30%;"></div>
                  </div>
                </div>

                <!-- 生成完成 -->
                <div class="aigc-result" id="aigc-result" style="display: none;">
                  <div class="aigc-result-image">🌸</div>
                  <div class="aigc-result-text">Your Ghibli artwork is ready! 🎉</div>
                  <div class="aigc-result-actions">
                    <button class="aigc-result-btn secondary" onclick="hideAigcModal()">Close</button>
                    <button class="aigc-result-btn primary" onclick="saveAigcResult()">💾 Save</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Workshop Photo 选图页 ========== -->
        <div id="workshop-photo-page" class="page page-blur-bg">
          <div class="photo-select-container">
            <button class="photo-select-back-btn" onclick="navigateTo('workshop-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 已选风格 -->
            <div class="selected-style-banner">
              <div class="style-badge" id="workshop-style-badge">
                <span id="workshop-style-icon">🏔️</span>
                <span id="workshop-style-name">Ghibli</span>
              </div>
              <span class="style-badge-hint">Choose a photo to transform</span>
            </div>

            <!-- 照片网格 -->
            <div class="photo-select-grid">
              <div class="photo-select-item take-new" onclick="navigateTo('camera-page')">
                <span>📸</span>
                <span class="take-new-label">Take New</span>
              </div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🌻</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🦎</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🪨</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🍂</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🐛</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🦋</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🌺</div>
            </div>

            <!-- 底部 -->
            <div class="photo-select-footer">
              <label class="aigc-agreement">
                <input type="checkbox" checked id="workshop-agree-checkbox" onchange="updateCreateBtn()">
                <span>I agree to AI creation terms</span>
              </label>
              <button class="create-btn" id="workshop-create-btn" disabled onclick="startWorkshopCreation()">✨ Start Creating</button>
            </div>
          </div>
        </div>

        <!-- ========== Backpack 背包页 ========== -->
        <div id="backpack-page" class="page page-blur-bg">
          <div class="backpack-container">
            <button class="backpack-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- Tab栏 -->
            <div class="backpack-tabs">
              <button class="backpack-tab active" onclick="switchBackpackTab('album', this)">📷 Album</button>
              <button class="backpack-tab" onclick="switchBackpackTab('guide', this)">📖 Guide</button>
              <button class="backpack-tab" onclick="switchBackpackTab('badges', this)">🏅 Badges</button>
            </div>

            <!-- 内容区 -->
            <div class="backpack-content">
              <!-- 相册 -->
              <div class="album-grid" id="album-content">
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🌻</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🦎</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🪨</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🍂</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🐛</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🦋</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🌺</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🐿️</div>
                <div class="album-item" onclick="navigateTo('photo-preview-page')">🍄</div>
              </div>

              <!-- 图鉴分类 -->
              <div class="guide-grid" id="guide-content" style="display: none;">
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🌸</div>
                  <div class="guide-name">Flowers</div>
                  <div class="guide-count">5 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🦋</div>
                  <div class="guide-name">Insects</div>
                  <div class="guide-count">3 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🪨</div>
                  <div class="guide-name">Rocks</div>
                  <div class="guide-count">2 types</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🍂</div>
                  <div class="guide-name">Leaves</div>
                  <div class="guide-count">4 types</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🐿️</div>
                  <div class="guide-name">Animals</div>
                  <div class="guide-count">1 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🍄</div>
                  <div class="guide-name">Mushrooms</div>
                  <div class="guide-count">2 types</div>
                </div>
              </div>

              <!-- 徽章 -->
              <div class="badge-grid" id="badges-content" style="display: none;">
                <div class="badge-item">
                  <div class="badge-icon">⭐</div>
                  <div class="badge-name">First Discovery</div>
                </div>
                <div class="badge-item">
                  <div class="badge-icon">🏆</div>
                  <div class="badge-name">Explorer</div>
                </div>
                <div class="badge-item">
                  <div class="badge-icon">🎯</div>
                  <div class="badge-name">Sharp Eye</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">🔬</div>
                  <div class="badge-name">Scientist</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">🎨</div>
                  <div class="badge-name">Artist</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">📚</div>
                  <div class="badge-name">Collector</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Species List 图鉴列表页 ========== -->
        <div id="species-list-page" class="page page-blur-bg">
          <div class="species-list-container">
            <button class="species-list-back-btn" onclick="navigateTo('backpack-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 头部 -->
            <div class="species-list-header">
              <div class="species-list-icon">🌸</div>
              <div>
                <div class="species-list-title">Flowers</div>
                <div class="species-list-count">5 species discovered</div>
              </div>
            </div>

            <!-- 物种网格 -->
            <div class="species-grid">
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌸</div>
                <div class="species-card-info">
                  <div class="species-card-name">Cherry Blossom</div>
                  <div class="species-card-date">May 15</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌻</div>
                <div class="species-card-info">
                  <div class="species-card-name">Sunflower</div>
                  <div class="species-card-date">May 20</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌺</div>
                <div class="species-card-info">
                  <div class="species-card-name">Hibiscus</div>
                  <div class="species-card-date">May 22</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌷</div>
                <div class="species-card-info">
                  <div class="species-card-name">Tulip</div>
                  <div class="species-card-date">May 25</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌼</div>
                <div class="species-card-info">
                  <div class="species-card-name">Daisy</div>
                  <div class="species-card-date">May 28</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Species Detail 图鉴详情页 ========== -->
        <div id="species-detail-page" class="page page-blur-bg">
          <div class="species-detail-container">
            <button class="species-detail-back-btn" onclick="navigateTo('species-list-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 左侧照片 -->
            <div class="species-detail-photo">
              <div class="species-photo-frame">
                <div class="species-photo-tape"></div>
                <img src="https://images.unsplash.com/photo-1522383225653-ed111181a951?w=300&h=225&fit=crop" alt="Cherry Blossom">
              </div>
            </div>

            <!-- 右侧信息 -->
            <div class="species-detail-info">
              <div class="species-info-card">
                <div class="species-info-header">
                  <div class="species-info-icon">🌸</div>
                  <div>
                    <div class="species-info-name">Cherry Blossom</div>
                    <div class="species-info-latin">Prunus serrulata</div>
                  </div>
                </div>
                <div class="species-fun-facts">
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🌍</div>
                    <div class="fun-fact-text">Cherry blossoms come from Japan, where they're called "Sakura"!</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">⏰</div>
                    <div class="fun-fact-text">Each flower only blooms for about 2 weeks!</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🍃</div>
                    <div class="fun-fact-text">The petals are edible! Japanese people make treats with them.</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🐝</div>
                    <div class="fun-fact-text">Bees love them because they're full of sweet nectar!</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Settings 设置页 ========== -->
        <div id="settings-page" class="page page-blur-bg">
          <div class="settings-container">
            <button class="settings-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <div class="settings-list">
              <!-- 设备组 -->
              <div class="settings-group">
                <div class="settings-group-title">Device</div>
                <div class="settings-group-card">
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">📶</div>
                      <div>
                        <div class="settings-label">WiFi</div>
                        <div class="settings-value">Home_Network</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon green">🔋</div>
                      <div>
                        <div class="settings-label">Battery</div>
                        <div class="settings-value">87% • Healthy</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon orange">💾</div>
                      <div>
                        <div class="settings-label">Storage</div>
                        <div class="settings-value">12.3 GB / 32 GB</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                </div>
              </div>

              <!-- 显示组 -->
              <div class="settings-group">
                <div class="settings-group-title">Display</div>
                <div class="settings-group-card">
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon purple">🔆</div>
                      <div class="settings-label">Brightness</div>
                    </div>
                    <div class="settings-slider">
                      <div class="slider-track">
                        <div class="slider-fill" style="width: 70%;"></div>
                      </div>
                      <span class="slider-value">70%</span>
                    </div>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon gray">🌙</div>
                      <div class="settings-label">Dark Mode</div>
                    </div>
                    <div class="toggle-switch" onclick="this.classList.toggle('active')"></div>
                  </div>
                </div>
              </div>

              <!-- 声音组 -->
              <div class="settings-group">
                <div class="settings-group-title">Sound</div>
                <div class="settings-group-card">
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">🔊</div>
                      <div class="settings-label">Volume</div>
                    </div>
                    <div class="settings-slider">
                      <div class="slider-track">
                        <div class="slider-fill" style="width: 50%;"></div>
                      </div>
                      <span class="slider-value">50%</span>
                    </div>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon orange">🎵</div>
                      <div class="settings-label">Sound Effects</div>
                    </div>
                    <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
                  </div>
                </div>
              </div>

              <!-- 账户组 -->
              <div class="settings-group">
                <div class="settings-group-title">Account</div>
                <div class="settings-group-card">
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon green">👤</div>
                      <div>
                        <div class="settings-label">Profile</div>
                        <div class="settings-value">Little Explorer</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon red">🔗</div>
                      <div class="settings-label">Parent Link</div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== AI 菜单浮层 ========== -->
        <div class="ai-overlay" id="ai-overlay">
          <div class="ai-left-section">
            <div class="ai-title-group">
              <div class="ai-icon">✨</div>
              <span class="ai-title">AI Assistant</span>
            </div>
            <div class="ai-context-badge" id="ai-context-badge">🏠 Home</div>
          </div>
          <div class="ai-menu-grid" id="ai-menu-grid">
            <div class="ai-menu-item" onclick="handleAIAction('dailyQuest')">
              <div class="ai-menu-icon purple">🎯</div>
              <div class="ai-menu-label">Daily Quest</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('learnSomething')">
              <div class="ai-menu-icon blue">📖</div>
              <div class="ai-menu-label">Learn</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('myProgress')">
              <div class="ai-menu-icon yellow">🏆</div>
              <div class="ai-menu-label">Progress</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('help')">
              <div class="ai-menu-icon green">❓</div>
              <div class="ai-menu-label">Help</div>
            </div>
          </div>
          <button class="ai-close" onclick="hideAI()">✕</button>
        </div>

        <!-- ========== PTT 浮层 ========== -->
        <div class="ptt-overlay" id="ptt-overlay">
          <div class="ptt-header">
            <div class="ptt-status">
              <div class="ptt-status-dot" id="ptt-status-dot"></div>
              <span class="ptt-status-text" id="ptt-status-text">Listening...</span>
            </div>
            <button class="ptt-close" onclick="hidePTT()">✕</button>
          </div>
          
          <!-- 录音状态 -->
          <div class="ptt-content" id="ptt-recording-section">
            <div class="ptt-character-section">
              <div class="ptt-character" id="ptt-character">🤖</div>
              <div class="ptt-character-switch">
                <button class="ptt-char-btn active" onclick="switchCharacter('🤖', this)">🤖</button>
                <button class="ptt-char-btn" onclick="switchCharacter('🧙', this)">🧙</button>
                <button class="ptt-char-btn" onclick="switchCharacter('🦊', this)">🦊</button>
              </div>
            </div>
            <div class="ptt-voice-section">
              <div class="ptt-waveform">
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
              </div>
              <div class="ptt-transcript" id="ptt-transcript">What kind of bug is this?</div>
            </div>
          </div>

          <!-- 回复状态 -->
          <div class="ptt-response-section" id="ptt-response-section">
            <div class="ptt-user-msg">
              <div class="ptt-msg-label">You asked:</div>
              <div class="ptt-msg-text" id="ptt-user-text">What kind of bug is this?</div>
            </div>
            <div class="ptt-ai-msg">
              <div class="ptt-ai-avatar" id="ptt-ai-avatar">🤖</div>
              <div class="ptt-ai-content">
                <div class="ptt-ai-text" id="ptt-ai-text">That's a ladybug! They're tiny beetles with spots. They eat aphids and help gardens grow! 🐞</div>
              </div>
            </div>
            <div class="ptt-actions">
              <button class="ptt-action-btn ptt-ask-more" onclick="pttAskMore()">🎤 Ask More</button>
              <button class="ptt-action-btn ptt-continue-chat" onclick="pttContinueChat()">💬 Continue</button>
            </div>
          </div>

          <div class="ptt-hint" id="ptt-hint">Release to send • Hold PTT to continue</div>
        </div>

        <!-- ========== 二级卡片浮层 ========== -->
        <div class="ai-card-overlay" id="ai-card-overlay" onclick="hideAICard()">
          <div class="ai-card" id="ai-card" onclick="event.stopPropagation()">
            <!-- 卡片内容动态填充 -->
          </div>
        </div>

        <!-- ========== 音量指示器 ========== -->
        <div class="volume-indicator" id="volume-indicator">
          <div class="volume-icon" id="volume-icon">🔊</div>
          <div class="volume-bar-container">
            <div class="volume-bar" id="volume-bar" style="width: 70%"></div>
          </div>
          <div class="volume-text" id="volume-text">70%</div>
        </div>

        <!-- ========== 息屏遮罩 ========== -->
        <div class="screen-off-overlay" id="screen-off-overlay"></div>

      </div>
    </div>

    <!-- 右侧按键区 -->
    <div class="button-panel">
      <div class="button-group">
        <button class="device-button btn-shutter" onclick="pressShutter()">📷</button>
        <div class="button-label">Shutter</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-ptt" onclick="togglePTT()">🎤</button>
        <div class="button-label">PTT</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-ai" onclick="toggleAI()">✨</button>
        <div class="button-label">AI</div>
      </div>
      
      <div class="button-divider"></div>
      
      <div class="button-group">
        <button class="device-button btn-vol-up" onclick="adjustVolume(1)">🔊</button>
        <div class="button-label">Vol+</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-vol-down" onclick="adjustVolume(-1)">🔉</button>
        <div class="button-label">Vol-</div>
      </div>
      
      <div class="button-divider"></div>
      
      <div class="button-group">
        <button class="device-button btn-power" onclick="togglePower()">⏻</button>
        <div class="button-label">Power</div>
      </div>
    </div>
  </div>

  <script>
    // ============ 音量控制 ============
    let currentVolume = 70;
    let volumeTimeout = null;
    let isScreenOff = false;

    function adjustVolume(delta) {
      // 如果息屏状态，先唤醒
      if (isScreenOff) {
        togglePower();
        return;
      }

      currentVolume = Math.max(0, Math.min(100, currentVolume + delta * 10));
      
      const indicator = document.getElementById('volume-indicator');
      const bar = document.getElementById('volume-bar');
      const text = document.getElementById('volume-text');
      const icon = document.getElementById('volume-icon');
      
      bar.style.width = currentVolume + '%';
      text.textContent = currentVolume + '%';
      
      // 更新图标
      if (currentVolume === 0) {
        icon.textContent = '🔇';
      } else if (currentVolume < 30) {
        icon.textContent = '🔈';
      } else if (currentVolume < 70) {
        icon.textContent = '🔉';
      } else {
        icon.textContent = '🔊';
      }
      
      // 显示指示器
      indicator.classList.add('show');
      
      // 清除之前的定时器
      if (volumeTimeout) {
        clearTimeout(volumeTimeout);
      }
      
      // 1.5秒后隐藏
      volumeTimeout = setTimeout(() => {
        indicator.classList.remove('show');
      }, 1500);
    }

    // ============ 电源控制 ============
    function togglePower() {
      const overlay = document.getElementById('screen-off-overlay');
      isScreenOff = !isScreenOff;
      
      if (isScreenOff) {
        overlay.classList.add('active');
      } else {
        overlay.classList.remove('active');
      }
    }

    // ============ 相机功能 ============
    let flashOn = false;
    let gridOn = false;
    let zoomLevel = 1;

    function toggleFlash() {
      flashOn = !flashOn;
      const btn = document.getElementById('flash-btn');
      btn.classList.toggle('active', flashOn);
    }

    function toggleGrid() {
      gridOn = !gridOn;
      const btn = document.getElementById('grid-btn');
      btn.classList.toggle('active', gridOn);
    }

    function toggleZoom() {
      zoomLevel = zoomLevel === 1 ? 2 : (zoomLevel === 2 ? 3 : 1);
      document.getElementById('zoom-label').textContent = zoomLevel + '×';
    }

    function takePhoto() {
      // 闪光效果
      const flash = document.getElementById('camera-flash');
      flash.classList.add('active');
      setTimeout(() => {
        flash.classList.remove('active');
        // 跳转到预览页（暂时跳回首页）
        navigateTo('photo-preview-page');
      }, 150);
    }

    function openGallery() {
      navigateTo('backpack-page');
    }

    // ============ 快门硬件按钮 ============
    function pressShutter() {
      // 如果息屏状态，先唤醒
      if (isScreenOff) {
        togglePower();
        return;
      }

      // 如果在相机页面，触发拍照
      if (currentPage === 'camera-page') {
        takePhoto();
      } else {
        // 其他页面跳转到相机
        navigateTo('camera-page');
      }
    }

    function deletePhoto() {
      if (confirm('Delete this photo?')) {
        navigateTo('camera-page');
      }
    }

    function savePhoto() {
      alert('Photo saved to Backpack! 📸');
    }

    // ============ 地图功能 ============
    const taskData = {
      flower: {
        icon: '🌸',
        color: 'linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%)',
        title: 'Find a Flower',
        desc: 'Look around for any beautiful flowers! Take a photo when you find one. Can you spot different colors? 🌈'
      },
      butterfly: {
        icon: '🦋',
        color: 'linear-gradient(135deg, #FFD700 0%, #F59E0B 100%)',
        title: 'Spot a Butterfly',
        desc: 'Butterflies love sunny spots and flowers. Move slowly and quietly to get a good photo! 🌻'
      },
      rock: {
        icon: '🪨',
        color: 'linear-gradient(135deg, #4ADE80 0%, #22C55E 100%)',
        title: 'Cool Rock Hunt',
        desc: 'Find an interesting rock with unique colors or patterns. What makes it special? 🔍'
      },
      leaf: {
        icon: '🍂',
        color: 'linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%)',
        title: 'Collect Leaves',
        desc: 'Find leaves of different shapes and sizes. How many different trees can you identify? 🌳'
      }
    };

    function showTaskModal(taskType) {
      const task = taskData[taskType];
      if (!task) return;
      
      document.getElementById('task-modal-icon').style.background = task.color;
      document.getElementById('task-modal-icon').textContent = task.icon;
      document.getElementById('task-modal-title').textContent = task.title;
      document.getElementById('task-modal-desc').textContent = task.desc;
      document.getElementById('task-modal-overlay').classList.add('show');
    }

    function hideTaskModal() {
      document.getElementById('task-modal-overlay').classList.remove('show');
    }

    function acceptTask() {
      hideTaskModal();
      navigateTo('camera-page');
    }

    // ============ 工坊功能 ============
    let selectedStyle = { name: 'Ghibli', icon: '🏔️' };
    let selectedPhoto = null;

    function selectStyle(name, icon) {
      selectedStyle = { name, icon };
      document.getElementById('workshop-style-icon').textContent = icon;
      document.getElementById('workshop-style-name').textContent = name;
      navigateTo('workshop-photo-page');
    }

    function selectEffectCard(card, name, icon) {
      document.querySelectorAll('.effect-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      selectedStyle = { name, icon };
      // 显示生成弹窗
      showAigcModal();
    }

    function selectPhotoItem(item) {
      document.querySelectorAll('.photo-select-item').forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');
      selectedPhoto = item;
      updateCreateBtn();
    }

    function updateCreateBtn() {
      const checkbox = document.getElementById('workshop-agree-checkbox');
      const btn = document.getElementById('workshop-create-btn');
      btn.disabled = !(selectedPhoto && checkbox.checked);
    }

    function startWorkshopCreation() {
      showAigcModal();
    }

    function showAigcModal() {
      document.getElementById('aigc-modal-overlay').classList.add('show');
      document.getElementById('aigc-generating').style.display = 'block';
      document.getElementById('aigc-result').style.display = 'none';
      
      // 模拟进度
      let progress = 0;
      const progressBar = document.getElementById('aigc-progress');
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('aigc-generating').style.display = 'none';
            document.getElementById('aigc-result').style.display = 'block';
          }, 300);
        }
        progressBar.style.width = progress + '%';
      }, 400);
    }

    function hideAigcModal() {
      document.getElementById('aigc-modal-overlay').classList.remove('show');
    }

    function saveAigcResult() {
      hideAigcModal();
      alert('Artwork saved to Backpack! 🎨');
      navigateTo('backpack-page');
    }

    // ============ 背包Tab切换 ============
    function switchBackpackTab(tab, btn) {
      // 更新Tab按钮状态
      document.querySelectorAll('.backpack-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      
      // 切换内容
      document.getElementById('album-content').style.display = tab === 'album' ? 'grid' : 'none';
      document.getElementById('guide-content').style.display = tab === 'guide' ? 'grid' : 'none';
      document.getElementById('badges-content').style.display = tab === 'badges' ? 'grid' : 'none';
    }

    // ============ 旋转木马状态 ============
    let currentIndex = 2; // 默认中间是 Workshop (index 2)
    const totalCards = 5;
    const positions = ['pos-far-left', 'pos-left', 'pos-center', 'pos-right', 'pos-far-right'];
    
    // 初始化旋转木马
    function initCarousel() {
      updateCarouselPositions();
    }
    
    // 更新卡片位置
    function updateCarouselPositions() {
      const cards = document.querySelectorAll('#carousel .card');
      cards.forEach((card, index) => {
        // 移除所有位置类
        positions.forEach(pos => card.classList.remove(pos));
        
        // 计算相对位置 (-2, -1, 0, 1, 2)
        let relativePos = index - currentIndex;
        
        // 处理循环
        if (relativePos > 2) relativePos -= totalCards;
        if (relativePos < -2) relativePos += totalCards;
        
        // 添加对应位置类
        const posIndex = relativePos + 2; // 转换为 0-4
        if (posIndex >= 0 && posIndex < positions.length) {
          card.classList.add(positions[posIndex]);
        }
      });
    }
    
    // 旋转木马
    function rotateCarousel(direction) {
      currentIndex = (currentIndex + direction + totalCards) % totalCards;
      updateCarouselPositions();
    }
    
    // 卡片点击
    function handleCardClick(cardIndex) {
      // 计算相对位置
      let relativePos = cardIndex - currentIndex;
      if (relativePos > 2) relativePos -= totalCards;
      if (relativePos < -2) relativePos += totalCards;
      
      if (relativePos === 0) {
        // 中心卡片 - 进入页面
        const cards = document.querySelectorAll('#carousel .card');
        const pageId = cards[cardIndex].dataset.page;
        navigateTo(pageId);
      } else {
        // 非中心卡片 - 旋转
        rotateCarousel(relativePos);
      }
    }
    
    // 键盘控制
    document.addEventListener('keydown', (e) => {
      if (currentPage !== 'home-page') return;
      if (e.key === 'ArrowLeft') {
        rotateCarousel(-1);
      } else if (e.key === 'ArrowRight') {
        rotateCarousel(1);
      } else if (e.key === 'Enter') {
        const cards = document.querySelectorAll('#carousel .card');
        const pageId = cards[currentIndex].dataset.page;
        navigateTo(pageId);
      }
    });

    // ============ 页面状态 ============
    let currentPage = 'home-page';
    let currentAICharacter = '🤖';

    // 页面导航
    function navigateTo(pageId) {
      // 更新页面列表高亮
      document.querySelectorAll('.page-list-item').forEach(item => {
        item.classList.remove('active');
        if (item.onclick && item.onclick.toString().includes(pageId)) {
          item.classList.add('active');
        }
      });

      // 切换页面（目前只有首页，其他页面待添加）
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
      } else {
        // 如果页面不存在，显示首页并提示
        document.getElementById('home-page').classList.add('active');
        console.log('Page not yet implemented:', pageId);
      }
      
      currentPage = pageId;
      hideAI();
      hidePTT();
      
      // 控制状态栏显示：只有首页显示状态栏
      const statusBar = document.querySelector('.status-bar');
      if (statusBar) {
        statusBar.style.display = (pageId === 'home-page') ? 'flex' : 'none';
      }
    }

    // AI 菜单
    function toggleAI() {
      const overlay = document.getElementById('ai-overlay');
      if (overlay.classList.contains('show')) {
        hideAI();
      } else {
        hidePTT();
        overlay.classList.add('show');
        updateAIMenu();
      }
    }

    function hideAI() {
      document.getElementById('ai-overlay').classList.remove('show');
    }

    // AI菜单配置 - 按v5版本
    const pageConfigs = {
      'home-page': {
        context: null,
        menu: [
          { icon: '🎯', label: 'Daily Quest', color: 'purple', action: 'dailyQuest' },
          { icon: '📖', label: 'Learn Something', color: 'blue', action: 'learnSomething' },
          { icon: '🏆', label: 'My Progress', color: 'yellow', action: 'myProgress' },
          { icon: '❓', label: 'Help', color: 'green', action: 'help' }
        ]
      },
      'camera-page': {
        context: { icon: '📷', label: 'Camera Mode' },
        menu: [
          { icon: '🔍', label: 'Identify This', color: 'purple', action: 'identifyThis' },
          { icon: '💡', label: 'Photo Tips', color: 'blue', action: 'photoTips' },
          { icon: '🎨', label: 'Add Effect', color: 'pink', action: 'addEffect' }
        ]
      },
      'photo-preview-page': {
        context: { icon: '🖼️', label: 'Photo Preview' },
        menu: [
          { icon: '🔍', label: 'What is This?', color: 'purple', action: 'whatIsThis' },
          { icon: '💬', label: 'Talk About It', color: 'blue', action: 'talkAboutIt' },
          { icon: '✨', label: 'Magic Art', color: 'pink', action: 'magicArt' },
          { icon: '📚', label: 'Learn More', color: 'green', action: 'learnMore' }
        ]
      },
      'chat-page': {
        context: { icon: '💬', label: 'Photo Chat' },
        menu: [
          { icon: '🔄', label: 'New Topic', color: 'purple', action: 'newTopic' },
          { icon: '📖', label: 'Tell Story', color: 'blue', action: 'tellStory' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'general-chat-page': {
        context: { icon: '💬', label: 'Chat' },
        menu: [
          { icon: '🔄', label: 'New Topic', color: 'purple', action: 'newTopic' },
          { icon: '📖', label: 'Tell Story', color: 'blue', action: 'tellStory' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'map-page': {
        context: { icon: '🗺️', label: 'Explorer Map' },
        menu: [
          { icon: '🎯', label: 'Find Tasks', color: 'red', action: 'findTasks' },
          { icon: '📍', label: 'Nearby', color: 'blue', action: 'nearby' },
          { icon: '🏅', label: 'Rewards', color: 'yellow', action: 'rewards' },
          { icon: '🧭', label: 'Guide Me', color: 'cyan', action: 'guideMe' }
        ]
      },
      'workshop-page': {
        context: { icon: '🎨', label: 'Workshop' },
        menu: [
          { icon: '✨', label: 'Surprise Me', color: 'purple', action: 'surpriseMe' },
          { icon: '🖼️', label: 'My Creations', color: 'pink', action: 'myCreations' },
          { icon: '💡', label: 'Get Ideas', color: 'yellow', action: 'getIdeas' }
        ]
      },
      'backpack-page': {
        context: { icon: '🎒', label: 'Backpack' },
        menu: [
          { icon: '⭐', label: 'Highlights', color: 'purple', action: 'highlights' },
          { icon: '📊', label: 'Stats', color: 'blue', action: 'stats' },
          { icon: '📤', label: 'Share', color: 'green', action: 'share' }
        ]
      },
      'species-list-page': {
        context: { icon: '📖', label: 'Field Guide' },
        menu: [
          { icon: '🔍', label: "What's Missing?", color: 'purple', action: 'whatsMissing' },
          { icon: '💡', label: 'Fun Fact', color: 'blue', action: 'funFact' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'species-detail-page': {
        context: { icon: '🦋', label: 'Species Detail' },
        menu: [
          { icon: '💡', label: 'More Facts', color: 'purple', action: 'moreFacts' },
          { icon: '🔀', label: 'Compare', color: 'blue', action: 'compare' },
          { icon: '🎯', label: 'Quiz Me', color: 'orange', action: 'quizMe' }
        ]
      },
      'photo-effect-page': {
        context: { icon: '✨', label: 'Choose Style' },
        menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
        isGeneric: true
      },
      'workshop-photo-page': {
        context: { icon: '📷', label: 'Select Photo' },
        menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
        isGeneric: true
      }
    };

    // 默认配置
    const defaultConfig = {
      context: { icon: '✨', label: 'AI Assistant' },
      menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
      isGeneric: true
    };

    function updateAIMenu() {
      const config = pageConfigs[currentPage] || defaultConfig;
      const contextBadge = document.getElementById('ai-context-badge');
      const menuGrid = document.getElementById('ai-menu-grid');
      
      // 更新上下文徽章
      if (config.context) {
        contextBadge.innerHTML = `<span>${config.context.icon}</span><span>${config.context.label}</span>`;
        contextBadge.style.display = 'inline-flex';
      } else {
        contextBadge.style.display = 'none';
      }
      
      // 通用助手显示不同UI
      if (config.isGeneric) {
        menuGrid.innerHTML = `
          <div class="ai-generic-row">
            <div class="ai-generic-avatar">🤖</div>
            <div class="ai-generic-text">"Need help?"</div>
            <button class="ai-generic-btn" onclick="handleAIAction('askAI')">
              🎤 Voice Chat
            </button>
          </div>
        `;
      } else {
        // 更新菜单项
        menuGrid.innerHTML = config.menu.map(item => `
          <div class="ai-menu-item" onclick="handleAIAction('${item.action}')">
            <div class="ai-menu-icon ${item.color}">${item.icon}</div>
            <div class="ai-menu-label">${item.label}</div>
          </div>
        `).join('');
      }
    }

    function handleAIAction(action) {
      // 跳转类action
      switch(action) {
        case 'talkAboutIt':
          hideAI();
          navigateTo('chat-page');
          return;
        case 'magicArt':
          hideAI();
          navigateTo('photo-effect-page');
          return;
        case 'askAI':
          hideAI();
          togglePTT();
          return;
      }
      // 其他action显示卡片
      showAICard(action);
    }
    
    function hideAICard() {
      document.getElementById('ai-card-overlay').classList.remove('show');
    }
    
    function showAICard(action) {
      const cardContent = getCardContent(action);
      if (!cardContent) {
        alert('AI Action: ' + action);
        return;
      }
      document.getElementById('ai-card').innerHTML = cardContent;
      document.getElementById('ai-card-overlay').classList.add('show');
    }
    
    function getCardContent(action) {
      const cards = {
        'dailyQuest': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Today's Quests</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="task-list-item">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #FEE2E2, #FECACA);">🌸</div>
              <div class="task-list-content">
                <div class="task-list-title">Find a Flower</div>
                <div class="task-list-desc">Look for colorful blooms</div>
              </div>
              <button class="task-list-action" onclick="hideAICard(); hideAI(); navigateTo('map-page');">Go →</button>
            </div>
            <div class="task-list-item">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">🦋</div>
              <div class="task-list-content">
                <div class="task-list-title">Spot a Butterfly</div>
                <div class="task-list-desc">They love sunny spots</div>
              </div>
              <button class="task-list-action" onclick="hideAICard(); hideAI(); navigateTo('map-page');">Go →</button>
            </div>
            <div class="task-list-item completed">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0);">🪨</div>
              <div class="task-list-content">
                <div class="task-list-title">Cool Rock Hunt</div>
                <div class="task-list-desc">Completed!</div>
              </div>
              <span class="task-list-done">✓</span>
            </div>
          </div>
          <div class="ai-card-footer">
            <span style="flex:1; font-size:13px; color:#888;">🎉 2/3 completed</span>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('map-page');">See Map →</button>
          </div>
        `,
        
        'learnSomething': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📖</span>Did You Know?</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="fact-card">
              <div class="fact-icon">🐞</div>
              <div class="fact-species">Ladybug</div>
              <div class="fact-text">Ladybugs can eat 5,000 bugs in their lifetime!</div>
              <div class="fact-analogy">🍕 That's like you eating 50 pizzas every day for a year!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard()">🔄 Another</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Tell More</button>
          </div>
        `,
        
        'myProgress': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🏆</span>My Explorer Journey</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="progress-section">
              <div class="progress-avatar">🧒</div>
              <div class="progress-level">Junior Explorer</div>
              <div class="progress-bar-container"><div class="progress-bar-fill" style="width: 60%;"></div></div>
              <div class="progress-text">3/5 to Intermediate Explorer</div>
            </div>
            <div class="stats-row">
              <div class="stat-item"><div class="stat-number">42</div><div class="stat-label">📷 photos</div></div>
              <div class="stat-item"><div class="stat-number">12</div><div class="stat-label">🦋 species</div></div>
              <div class="stat-item"><div class="stat-number">8</div><div class="stat-label">🎯 quests</div></div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('backpack-page');">View All Badges →</button>
          </div>
        `,
        
        'help': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">❓</span>Help Center</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="help-list-item"><div class="help-list-icon">🎬</div><div class="help-list-content"><div class="help-list-title">Quick Tour</div><div class="help-list-desc">Learn the basics (30s)</div></div></div>
            <div class="help-list-item"><div class="help-list-icon">🎤</div><div class="help-list-content"><div class="help-list-title">Voice Commands</div><div class="help-list-desc">Talk to your Explorer</div></div></div>
            <div class="help-list-item"><div class="help-list-icon">📷</div><div class="help-list-content"><div class="help-list-title">Photo Tips</div><div class="help-list-desc">Take amazing shots</div></div></div>
            <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0;">
              <div style="font-size: 13px; color: #888; margin-bottom: 10px;">💬 Or ask me anything!</div>
              <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); togglePTT();">🎤 Start Voice Chat</button>
            </div>
          </div>
        `,
        
        'identifyThis': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔍</span>I Found Something!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="identify-result">
              <div class="identify-thumb">🐞</div>
              <div class="identify-name">Ladybug</div>
              <div class="identify-scientific">Coccinellidae</div>
              <div class="identify-desc">A tiny beetle with spots! They eat pesky garden bugs and are super helpful. 🌱</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard(); hideAI(); takePhoto();">📷 Save Photo</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Learn More</button>
          </div>
        `,
        
        'photoTips': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Photo Tips</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status good">☀️</div><div class="tip-content"><div class="tip-title">Light Check</div><div class="tip-desc">Good lighting! Nice job!</div></div></div>
            <div class="tip-item"><div class="tip-status improve">🎯</div><div class="tip-content"><div class="tip-title">Get Closer</div><div class="tip-desc">Move in to fill the frame</div></div></div>
            <div class="tip-item"><div class="tip-status good">📐</div><div class="tip-content"><div class="tip-title">Hold Steady</div><div class="tip-desc">Nice and steady!</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard()">Got It! 👍</button>
          </div>
        `,
        
        'addEffect': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎨</span>Effects</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="effect-grid">
              <div class="effect-item active"><div class="effect-item-icon">⚪</div><div class="effect-item-name">None</div></div>
              <div class="effect-item"><div class="effect-item-icon">✨</div><div class="effect-item-name">Dreamy</div></div>
              <div class="effect-item"><div class="effect-item-icon">🌅</div><div class="effect-item-name">Warm</div></div>
              <div class="effect-item"><div class="effect-item-icon">❄️</div><div class="effect-item-name">Cool</div></div>
              <div class="effect-item"><div class="effect-item-icon">📷</div><div class="effect-item-name">Vintage</div></div>
              <div class="effect-item"><div class="effect-item-icon">🎨</div><div class="effect-item-name">Pop!</div></div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard()">Apply</button>
          </div>
        `,
        
        'whatIsThis': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔍</span>I Found It!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="identify-result">
              <div class="identify-name">🐞 Ladybug</div>
              <div class="identify-scientific">Coccinellidae</div>
              <div class="identify-desc">A helpful garden beetle with spots! 🌱</div>
              <div class="identify-badge">📖 Added to your Field Guide!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Ask More</button>
            <button class="ai-card-btn primary" onclick="hideAICard()">Got It! 👍</button>
          </div>
        `,
        
        'learnMore': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📚</span>Fun Facts</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status" style="background: #E0E7FF;">🔢</div><div class="tip-content"><div class="tip-title">Spots aren't their age!</div><div class="tip-desc">Different species have different numbers.</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #FEE2E2;">🛡️</div><div class="tip-content"><div class="tip-title">Spots warn predators!</div><div class="tip-desc">"Stay away, I taste bad!"</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #D1FAE5;">❄️</div><div class="tip-content"><div class="tip-title">They hibernate together!</div><div class="tip-desc">Thousands cuddle up in winter.</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 More Facts</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Discuss</button>
          </div>
        `,
        
        'newTopic': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔄</span>New Topic</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; color: #555; margin-bottom: 12px;">What should we talk about?</div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🔍</div><div class="topic-text">Something else in the photo</div></div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🌍</div><div class="topic-text">Where this creature lives</div></div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🎲</div><div class="topic-text">Surprise me!</div></div>
          </div>
        `,
        
        'tellStory': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📖</span>Story Time</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="story-option" onclick="hideAICard(); hideAI();"><div class="story-option-icon adventure">🦸</div><div class="story-option-content"><div class="story-option-title">Adventure Story</div><div class="story-option-desc">An exciting journey!</div></div></div>
            <div class="story-option" onclick="hideAICard(); hideAI();"><div class="story-option-icon bedtime">😴</div><div class="story-option-content"><div class="story-option-title">Bedtime Story</div><div class="story-option-desc">Calm and cozy</div></div></div>
            <div class="story-option" onclick="hideAICard(); hideAI();"><div class="story-option-icon funny">😂</div><div class="story-option-content"><div class="story-option-title">Funny Story</div><div class="story-option-desc">Silly and giggly!</div></div></div>
          </div>
        `,
        
        'quizChallenge': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Quiz Challenge</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="quiz-reward">🏆 Reward: +2 XP per correct answer</div>
            <div class="story-option" onclick="hideAICard(); hideAI();"><div class="story-option-icon" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">⚡</div><div class="story-option-content"><div class="story-option-title">Quick</div><div class="story-option-desc">3 questions</div></div></div>
            <div class="story-option" onclick="hideAICard(); hideAI();"><div class="story-option-icon" style="background: linear-gradient(135deg, #FEE2E2, #FECACA);">💪</div><div class="story-option-content"><div class="story-option-title">Challenge</div><div class="story-option-desc">5 questions</div></div></div>
          </div>
        `,
        
        'findTasks': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Find Tasks</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="filter-section"><div class="filter-label">Category:</div>
              <div class="filter-chips">
                <div class="filter-chip active">🌿 Plants</div>
                <div class="filter-chip">🦋 Animal</div>
                <div class="filter-chip">✨ Creative</div>
              </div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard()">Apply 🔍</button>
          </div>
        `,
        
        'nearby': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📍</span>Nearby Discoveries</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="nearby-item"><div class="nearby-icon" style="background: linear-gradient(135deg, #FEE2E2, #FECACA);">🌸</div><div class="nearby-content"><div class="nearby-title">Spring Flowers</div><div class="nearby-desc">Cherry blossoms are blooming!</div></div></div>
            <div class="nearby-item"><div class="nearby-icon" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">🐦</div><div class="nearby-content"><div class="nearby-title">Bird Watching</div><div class="nearby-desc">Robins often visit this area</div></div></div>
          </div>
        `,
        
        'rewards': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🏅</span>Quest Rewards</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">⭐</div><div class="tip-content"><div class="tip-title">Experience Points</div><div class="tip-desc">+10 XP per quest</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: linear-gradient(135deg, #E0E7FF, #C7D2FE);">🎖️</div><div class="tip-content"><div class="tip-title">Special Badges</div><div class="tip-desc">Unlock unique badges</div></div></div>
          </div>
        `,
        
        'guideMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🧭</span>Explorer Guide</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="guide-speech"><div class="guide-avatar">🦊</div><div class="guide-text">"Perfect weather for flower hunting! 🌸"</div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard(); hideAI(); togglePTT();">🎤 Different idea</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI();">Let's Go! 🚀</button>
          </div>
        `,
        
        'surpriseMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">✨</span>Surprise Combo!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="surprise-combo"><div class="surprise-photo">🌻</div><div class="surprise-plus">+</div><div class="surprise-style">🏔️ Ghibli</div></div>
            <div class="surprise-hint">🎲 Random picks just for you!</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Shuffle</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); showAigcModal();">✨ Create!</button>
          </div>
        `,
        
        'myCreations': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🖼️</span>My Creations</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="creations-count">12 creations total 🎨</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('backpack-page');">View All →</button>
          </div>
        `,
        
        'getIdeas': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Creation Ideas</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="guide-speech"><div class="guide-avatar">🎨</div><div class="guide-text">"Try turning your bug photos into pixel art! 👾"</div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Another Idea</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('photo-effect-page');">Try This! ✨</button>
          </div>
        `,
        
        'highlights': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">⭐</span>Your Highlights</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 13px; color: #888; margin-bottom: 8px;">This week you discovered:</div>
            <div style="display: flex; justify-content: center; gap: 12px;">
              <div style="text-align: center;"><div style="font-size: 32px;">🐞</div><div style="font-size: 11px; color: #888;">Ladybug</div></div>
              <div style="text-align: center;"><div style="font-size: 32px;">🌻</div><div style="font-size: 11px; color: #888;">Sunflower</div></div>
              <div style="text-align: center;"><div style="font-size: 32px;">🦋</div><div style="font-size: 11px; color: #888;">Butterfly</div></div>
            </div>
          </div>
        `,
        
        'stats': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📊</span>My Stats</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="stats-row">
              <div class="stat-item"><div class="stat-number">42</div><div class="stat-label">📷 photos</div></div>
              <div class="stat-item"><div class="stat-number">18</div><div class="stat-label">🦋 species</div></div>
              <div class="stat-item"><div class="stat-number">15</div><div class="stat-label">🎯 quests</div></div>
            </div>
          </div>
        `,
        
        'share': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📤</span>Share</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">🌟</div>
            <div style="font-size: 14px; color: #555;">Explorer Card ready to share!</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary">💾 Save to Photos</button>
          </div>
        `,
        
        'whatsMissing': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔍</span>What's Missing?</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; color: #555; margin-bottom: 12px;">You haven't found:</div>
            <div style="display: flex; gap: 8px; justify-content: center;">
              <div style="text-align: center;"><div style="font-size: 24px;">❓</div><div style="font-size: 11px; color: #888;">Daisy</div></div>
              <div style="text-align: center;"><div style="font-size: 24px;">❓</div><div style="font-size: 11px; color: #888;">Violet</div></div>
              <div style="text-align: center;"><div style="font-size: 24px;">❓</div><div style="font-size: 11px; color: #888;">Rose</div></div>
            </div>
            <div style="font-size: 12px; color: #888; margin-top: 12px;">💡 Tip: Daisies love sunny meadows!</div>
          </div>
        `,
        
        'funFact': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Fun Fact</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="fact-card">
              <div class="fact-icon">🌻</div>
              <div class="fact-text">Sunflowers always face the sun! ☀️</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Another</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Ask More</button>
          </div>
        `,
        
        'moreFacts': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>More Facts</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status" style="background: #FEE2E2;">🎨</div><div class="tip-content"><div class="tip-title">Many colors!</div><div class="tip-desc">Not just red - yellow, orange too!</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #D1FAE5;">🍽️</div><div class="tip-content"><div class="tip-title">50 aphids a day</div><div class="tip-desc">That's like 50 hamburgers!</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Discuss</button>
          </div>
        `,
        
        'compare': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔀</span>Compare</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 16px;">
              <div><div style="font-size: 36px;">🐞</div><div style="font-size: 13px; font-weight: 600;">Ladybug</div></div>
              <div style="font-size: 18px; color: #888;">VS</div>
              <div><div style="font-size: 36px;">🪲</div><div style="font-size: 13px; font-weight: 600;">Beetle</div></div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Learn differences</button>
          </div>
        `,
        
        'quizMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Quiz Time!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px;">How many legs does a ladybug have?</div>
            <div class="quiz-option">A) 4 legs</div>
            <div class="quiz-option correct">B) 6 legs ✓</div>
            <div class="quiz-option">C) 8 legs</div>
          </div>
        `
      };
      
      return cards[action] || null;
    }

    // PTT 浮层
    function togglePTT() {
      const overlay = document.getElementById('ptt-overlay');
      if (overlay.classList.contains('show')) {
        hidePTT();
      } else {
        hideAI();
        overlay.classList.add('show');
        resetPTTToRecording();
        simulateVoiceRecognition();
      }
    }

    function hidePTT() {
      document.getElementById('ptt-overlay').classList.remove('show');
      resetPTTToRecording();
    }

    function resetPTTToRecording() {
      document.getElementById('ptt-recording-section').style.display = 'flex';
      document.getElementById('ptt-response-section').style.display = 'none';
      document.getElementById('ptt-hint').style.display = 'block';
      document.getElementById('ptt-status-dot').className = 'ptt-status-dot';
      document.getElementById('ptt-status-text').textContent = 'Listening...';
    }

    function switchCharacter(emoji, btn) {
      document.querySelectorAll('.ptt-char-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('ptt-character').textContent = emoji;
      currentAICharacter = emoji;
    }

    function simulateVoiceRecognition() {
      const phrases = [
        "What kind of bug is this?",
        "Tell me about this flower",
        "Is this rock special?",
        "Why is the sky blue?"
      ];
      const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
      const transcript = document.getElementById('ptt-transcript');
      transcript.textContent = '';
      
      let i = 0;
      const interval = setInterval(() => {
        if (i < randomPhrase.length) {
          transcript.textContent += randomPhrase[i];
          i++;
        } else {
          clearInterval(interval);
          setTimeout(() => showPTTResponse(randomPhrase), 500);
        }
      }, 50);
    }

    function showPTTResponse(userQuestion) {
      document.getElementById('ptt-status-dot').className = 'ptt-status-dot thinking';
      document.getElementById('ptt-status-text').textContent = 'Thinking...';
      
      setTimeout(() => {
        document.getElementById('ptt-status-dot').className = 'ptt-status-dot done';
        document.getElementById('ptt-status-text').textContent = 'AI Answered';
        document.getElementById('ptt-user-text').textContent = userQuestion;
        
        const responses = {
          "What kind of bug is this?": "That's a ladybug! They're tiny beetles with spots. They eat aphids and help gardens grow! 🐞",
          "Tell me about this flower": "This looks like a sunflower! They can grow really tall and always face the sun. Bees love them! 🌻",
          "Is this rock special?": "Wow, great find! This could be granite - see those sparkly bits? That's mica! 🪨✨",
          "Why is the sky blue?": "The sky looks blue because sunlight bounces off tiny bits of air! It's called scattering. Cool, right? ☀️💙"
        };
        
        document.getElementById('ptt-ai-text').textContent = responses[userQuestion] || "That's interesting! Tell me more.";
        document.getElementById('ptt-ai-avatar').textContent = currentAICharacter;
        
        document.getElementById('ptt-recording-section').style.display = 'none';
        document.getElementById('ptt-response-section').style.display = 'flex';
        document.getElementById('ptt-hint').style.display = 'none';
      }, 800);
    }

    function pttAskMore() {
      resetPTTToRecording();
      simulateVoiceRecognition();
    }

    function pttContinueChat() {
      hidePTT();
      navigateTo('general-chat-page');
    }


    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initCarousel);
  </script>

</body>
</html>
