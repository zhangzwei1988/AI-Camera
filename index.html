<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Explorer - Device Prototype</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --sky-top: #4BA3E3;
      --sky-bottom: #87CEEB;
      --card-bg: #F5EDE4;
      --card-shadow: rgba(139, 90, 43, 0.3);
      --wood-primary: #8B5A2B;
      --gold-accent: #FFD700;
      --cream: #FFF8E7;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Fredoka', 'Comic Neue', sans-serif;
      background: #E8E8E8;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* ============ 整体布局容器 ============ */
    .prototype-container {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }

    /* ============ 左侧页面列表 ============ */
    .page-list {
      width: 180px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 16px;
      flex-shrink: 0;
    }
    
    /* 隐藏滚动条但保留滚动功能 */
    .page-list::-webkit-scrollbar {
      width: 4px;
    }
    .page-list::-webkit-scrollbar-track {
      background: transparent;
    }
    .page-list::-webkit-scrollbar-thumb {
      background: #ddd;
      border-radius: 4px;
    }
    .page-list::-webkit-scrollbar-thumb:hover {
      background: #ccc;
    }
    
    /* ============ 右侧设备+按钮固定区域 ============ */
    .device-area {
      position: sticky;
      top: 20px;
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }

    .page-list-title {
      font-size: 12px;
      color: #888;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .page-list-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      color: #333;
    }

    .page-list-item:hover {
      background: #F5F5F5;
    }

    .page-list-item.active {
      background: #EEF2FF;
      color: #6366F1;
      font-weight: 500;
    }

    .page-list-item .icon {
      font-size: 16px;
    }

    .page-list-section {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }

    .page-list-section-title {
      font-size: 11px;
      color: #AAA;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ============ 中间设备屏幕 ============ */
    .device-frame {
      background: #2A2A2A;
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .device-screen {
      width: 800px;
      height: 480px;
      background: url('icons/bg.png') center center / cover no-repeat;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    /* ============ 右侧按键区 ============ */
    .button-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex-shrink: 0;
    }

    .device-button {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .device-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }

    .device-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .btn-ptt {
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
    }

    .btn-ai {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
    }

    .btn-vol-up, .btn-vol-down {
      background: linear-gradient(180deg, #E5E5E5 0%, #CCCCCC 100%);
      font-size: 20px;
      width: 48px;
      height: 48px;
    }

    .btn-power {
      background: linear-gradient(180deg, #555 0%, #333 100%);
      color: #FF6B6B;
      font-size: 18px;
      width: 48px;
      height: 48px;
    }

    .btn-shutter {
      background: linear-gradient(180deg, #EF4444 0%, #DC2626 100%);
      color: white;
      font-size: 20px;
      width: 48px;
      height: 48px;
    }

    .button-label {
      font-size: 10px;
      color: #666;
      text-align: center;
      margin-top: 3px;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .button-divider {
      width: 40px;
      height: 1px;
      background: #DDD;
      margin: 4px 0;
    }

    /* 音量提示 */
    .volume-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.75);
      border-radius: 16px;
      padding: 20px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .volume-indicator.show {
      opacity: 1;
    }

    .volume-icon {
      font-size: 36px;
    }

    .volume-bar-container {
      width: 160px;
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
      overflow: hidden;
    }

    .volume-bar {
      height: 100%;
      background: white;
      border-radius: 3px;
      transition: width 0.15s ease;
    }

    .volume-text {
      color: white;
      font-size: 14px;
      font-weight: 500;
    }

    /* 息屏效果 */
    .screen-off-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      border-radius: 12px;
    }

    .screen-off-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* ============ 屏幕内部样式 ============ */

    /* 天空背景(使用图片,隐藏CSS云朵) */
    .sky-bg {
      display: none;
    }

    .cloud {
      display: none;
    }
    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: white;
      border-radius: 50%;
    }

    .cloud-1 { width: 70px; height: 26px; top: 50px; left: 40px; animation: float 8s ease-in-out infinite; }
    .cloud-1::before { width: 35px; height: 35px; top: -18px; left: 8px; }
    .cloud-1::after { width: 44px; height: 44px; top: -22px; left: 26px; }

    .cloud-2 { width: 88px; height: 30px; top: 85px; right: 70px; animation: float 10s ease-in-out infinite 2s; }
    .cloud-2::before { width: 44px; height: 44px; top: -22px; left: 13px; }
    .cloud-2::after { width: 52px; height: 48px; top: -26px; left: 35px; }

    .cloud-3 { width: 52px; height: 22px; top: 35px; left: 260px; animation: float 7s ease-in-out infinite 1s; }
    .cloud-3::before { width: 30px; height: 30px; top: -15px; left: 7px; }
    .cloud-3::after { width: 35px; height: 33px; top: -17px; left: 22px; }

    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

    /* 状态栏 */
    .status-bar {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 28px;
      background: transparent;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 14px;
      color: white;
      font-size: 13px;
      font-weight: 600;
      z-index: 100;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    .status-left { display: flex; gap: 8px; align-items: center; }
    .status-right { display: flex; gap: 10px; align-items: center; font-size: 14px; }

    /* 页面容器 */
    .page {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .page.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* 二级三级页面通用模糊背景(除相机和地图外) */
    .page-blur-bg {
      background: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=800&q=80') center/cover no-repeat;
    }
    .page-blur-bg > *:first-child {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
    }

    /* Home 页面轮播 - 3卡片布局,大卡片风格 */
    .carousel-container {
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .card {
      position: absolute;
      width: 200px;
      height: 200px;
      background: linear-gradient(180deg, #F5EDE4 0%, #E8DFD4 100%);
      border-radius: 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, opacity 0.25s ease-out, background 0.25s ease-out;
      /* 阴影代替描边 */
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.1);
      border: none;
    }

    /* 卡片位置 - 只显示3张,两侧露出一部分 */
    .card.pos-far-left {
      transform: translateX(-480px) scale(0.7);
      opacity: 0.4;
      z-index: 1;
    }
    .card.pos-left {
      transform: translateX(-260px) scale(0.85);
      opacity: 0.9;
      z-index: 2;
    }
    .card.pos-center {
      transform: translateX(0) scale(1);
      opacity: 1;
      z-index: 5;
      width: 240px;
      height: 240px;
      /* 选中卡片变色 - 金黄色调 + 更强阴影 */
      background: linear-gradient(180deg, #FFE4A0 0%, #FFCC50 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.2),
        0 4px 12px rgba(0, 0, 0, 0.15),
        0 0 0 4px rgba(255, 200, 50, 0.3);
    }
    .card.pos-right {
      transform: translateX(260px) scale(0.85);
      opacity: 0.9;
      z-index: 2;
    }
    .card.pos-far-right {
      transform: translateX(480px) scale(0.7);
      opacity: 0.4;
      z-index: 1;
    }

    /* 没有位置的卡片隐藏 */
    .card.pos-hidden {
      transform: translateX(0) scale(0.5);
      opacity: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* 点击反馈 */
    .card:active {
      transform: scale(0.95) !important;
    }

    /* 图标区域 */
    .card-icon {
      width: 130px;
      height: 130px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* 中心卡片图标更大 */
    .card.pos-center .card-icon {
      width: 170px;
      height: 170px;
    }

    /* 文字标签 - 在卡片外部,木纹风格 */
    .card-label {
      position: absolute;
      bottom: -45px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 20px;
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 50%, #6B4423 100%);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #FFF8E7;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      box-shadow: 
        0 3px 8px rgba(0,0,0,0.25),
        inset 0 1px 0 rgba(255,255,255,0.2);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }

    /* 只有左、中、右三张显示文字 */
    .card.pos-left .card-label,
    .card.pos-center .card-label,
    .card.pos-right .card-label {
      opacity: 1;
    }

    /* 中心卡片文字更大 */
    .card.pos-center .card-label {
      font-size: 18px;
      padding: 8px 28px;
      bottom: -50px;
      background: linear-gradient(180deg, #C49A6C 0%, #A67C52 50%, #8B5A2B 100%);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.25);
    }

    /* ===== 大尺寸拟物化图标 ===== */

    /* 相机图标 - 3D 立体感 */
    .icon-camera-big {
      width: 80px;
      height: 62px;
      background: linear-gradient(180deg, #6D6D6D 0%, #4D4D4D 50%, #3D3D3D 100%);
      border-radius: 12px;
      position: relative;
      box-shadow: 
        0 5px 0 #2D2D2D,
        0 8px 16px rgba(0,0,0,0.3),
        inset 0 2px 6px rgba(255,255,255,0.2);
    }
    .icon-camera-big::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 32px; height: 32px;
      background: linear-gradient(180deg, #87CEEB 0%, #5BA3D9 100%);
      border-radius: 50%;
      border: 5px solid #2D2D2D;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.3);
    }
    .icon-camera-big::after {
      content: '';
      position: absolute;
      top: 8px; right: 10px;
      width: 10px; height: 10px;
      background: #FF4444;
      border-radius: 50%;
      box-shadow: 0 0 6px #FF4444;
    }

    /* 中心卡片相机图标更大 */
    .card[data-index="2"] .icon-camera-big {
      width: 96px;
      height: 74px;
    }
    .card[data-index="2"] .icon-camera-big::before {
      width: 40px; height: 40px;
    }

    /* 地图图标 */
    .icon-map-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 工坊图标 */
    .icon-workshop-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 背包图标 */
    .icon-backpack-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    /* 设置图标 */
    .icon-settings-big {
      font-size: inherit;
      text-shadow: 0 4px 8px rgba(0,0,0,0.25);
      /* 缓慢旋转,适配低帧率 */
      animation: slowSpin 8s linear infinite;
    }
    @keyframes slowSpin { 
      from { transform: rotate(0deg); } 
      to { transform: rotate(360deg); } 
    }

    /* 返回按钮 */
    .back-btn {
      position: absolute;
      top: 32px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      border: none;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      color: var(--wood-primary);
      cursor: pointer;
      z-index: 50;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .floating-title {
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      padding: 6px 16px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 600;
      color: var(--wood-primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 50;
    }

    /* ============ AI 菜单浮层 ============ */
    .ai-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(30,40,80,0.92) 0%, rgba(20,30,60,0.98) 100%);
      backdrop-filter: blur(20px);
      border-radius: 20px 20px 0 0;
      padding: 12px 16px 14px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .ai-overlay.show {
      transform: translateY(0);
    }

    /* 左侧:标题+badge上下排列 */
    .ai-left-section {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .ai-title-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .ai-title {
      color: white;
      font-size: 14px;
      font-weight: 600;
    }

    .ai-context-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(255,255,255,0.12);
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 11px;
      color: rgba(255,255,255,0.9);
      white-space: nowrap;
      width: fit-content;
    }

    /* 中间:菜单项 */
    .ai-menu-grid {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .ai-menu-item {
      min-width: 72px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.1);
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .ai-menu-item:hover {
      background: rgba(255,255,255,0.18);
    }

    /* 右侧:关闭按钮 */
    .ai-close {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    /* 移除旧的header样式 */
    .ai-header {
      display: contents;
    }

    .ai-menu-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      flex-shrink: 0;
    }

    .ai-menu-icon.purple { background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%); }
    .ai-menu-icon.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .ai-menu-icon.yellow { background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); }
    .ai-menu-icon.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }
    .ai-menu-icon.pink { background: linear-gradient(135deg, #F472B6 0%, #EC4899 100%); }
    .ai-menu-icon.orange { background: linear-gradient(135deg, #FB923C 0%, #F97316 100%); }
    .ai-menu-icon.red { background: linear-gradient(135deg, #F87171 0%, #EF4444 100%); }
    .ai-menu-icon.cyan { background: linear-gradient(135deg, #22D3EE 0%, #06B6D4 100%); }

    .ai-menu-label {
      font-size: 11px;
      color: white;
      font-weight: 500;
      white-space: nowrap;
      text-align: center;
    }

    /* ============ PTT 浮层 ============ */
    .ptt-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: 20px 20px 0 0;
      padding: 14px 16px 16px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      z-index: 200;
    }
    .ptt-overlay.show {
      transform: translateY(0);
    }

    .ptt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .ptt-status {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ptt-status-dot {
      width: 8px;
      height: 8px;
      background: #EF4444;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }

    .ptt-status-dot.thinking { background: #FBBF24; }
    .ptt-status-dot.done { background: #4ADE80; animation: none; }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    .ptt-status-text {
      color: white;
      font-size: 11px;
    }

    .ptt-close {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }

    .ptt-content {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .ptt-character-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .ptt-character {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(255,165,0,0.4);
    }

    .ptt-character-switch {
      display: flex;
      gap: 4px;
    }

    .ptt-char-btn {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border: 2px solid transparent;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
    }

    .ptt-char-btn.active {
      background: rgba(255,255,255,0.25);
      border-color: #FFD700;
    }

    .ptt-voice-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ptt-waveform {
      height: 32px;
      background: rgba(255,255,255,0.08);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
      padding: 0 10px;
    }

    .ptt-wave-bar {
      width: 3px;
      background: linear-gradient(180deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 2px;
      animation: wave 0.5s ease-in-out infinite;
    }

    @keyframes wave {
      0%, 100% { transform: scaleY(0.5); }
      50% { transform: scaleY(1); }
    }

    .ptt-wave-bar:nth-child(1) { height: 10px; animation-delay: 0s; }
    .ptt-wave-bar:nth-child(2) { height: 18px; animation-delay: 0.1s; }
    .ptt-wave-bar:nth-child(3) { height: 24px; animation-delay: 0.2s; }
    .ptt-wave-bar:nth-child(4) { height: 14px; animation-delay: 0.15s; }
    .ptt-wave-bar:nth-child(5) { height: 20px; animation-delay: 0.25s; }
    .ptt-wave-bar:nth-child(6) { height: 28px; animation-delay: 0.1s; }
    .ptt-wave-bar:nth-child(7) { height: 16px; animation-delay: 0.2s; }
    .ptt-wave-bar:nth-child(8) { height: 22px; animation-delay: 0.05s; }

    .ptt-transcript {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 8px 12px;
      color: white;
      font-size: 13px;
      min-height: 32px;
    }

    .ptt-hint {
      text-align: center;
      color: rgba(255,255,255,0.5);
      font-size: 10px;
      margin-top: 6px;
    }

    /* PTT 回复状态 */
    .ptt-response-section {
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    .ptt-user-msg {
      background: rgba(74, 144, 217, 0.2);
      border: 1px solid rgba(74, 144, 217, 0.3);
      border-radius: 10px;
      padding: 8px 12px;
    }

    .ptt-msg-label {
      font-size: 9px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 3px;
    }

    .ptt-msg-text {
      color: white;
      font-size: 13px;
    }

    .ptt-ai-msg {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .ptt-ai-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .ptt-ai-content {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px 12px;
    }

    .ptt-ai-text {
      color: white;
      font-size: 13px;
      line-height: 1.4;
    }

    .ptt-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .ptt-action-btn {
      flex: 1;
      padding: 10px 14px;
      border: none;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .ptt-ask-more {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .ptt-continue-chat {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    /* ============ 二级卡片浮层 ============ */
    .ai-card-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }

    .ai-card-overlay.show {
      display: flex;
    }

    .ai-card {
      width: 280px;
      max-height: 480px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow: hidden;
      animation: cardAppear 0.25s ease-out;
    }

    @keyframes cardAppear {
      from { transform: scale(0.9) translateY(16px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .ai-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      border-bottom: 1px solid #F0F0F0;
    }

    .ai-card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 700;
      color: #333;
    }

    .ai-card-title-icon {
      font-size: 16px;
    }

    .ai-card-close {
      width: 24px;
      height: 24px;
      background: #F3F4F6;
      border: none;
      border-radius: 50%;
      color: #666;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ai-card-body {
      padding: 14px;
      max-height: 360px;
      overflow-y: auto;
    }

    .ai-card-footer {
      padding: 10px 14px 14px;
      border-top: 1px solid #F0F0F0;
      display: flex;
      gap: 8px;
    }

    .ai-card-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
    }

    .ai-card-btn-primary {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    .ai-card-btn-secondary {
      background: #F3F4F6;
      color: #333;
    }

    .ai-card-btn.primary {
      background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
      color: white;
    }

    .ai-card-btn.secondary {
      background: #F3F4F6;
      color: #333;
    }

    /* AI卡片内部元素样式 */
    .task-list-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #F9FAFB;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    .task-list-item.completed { opacity: 0.6; }
    .task-list-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .task-list-content { flex: 1; }
    .task-list-title { font-size: 14px; font-weight: 600; color: #333; }
    .task-list-desc { font-size: 12px; color: #888; }
    .task-list-action { background: linear-gradient(135deg, #818CF8, #6366F1); color: white; border: none; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; }
    .task-list-done { color: #22C55E; font-size: 18px; font-weight: 700; }

    .fact-card { text-align: center; padding: 16px; }
    .fact-icon { font-size: 48px; margin-bottom: 8px; }
    .fact-species { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 8px; }
    .fact-text { font-size: 14px; color: #555; line-height: 1.5; margin-bottom: 12px; }
    .fact-analogy { font-size: 13px; color: #888; background: #FEF3C7; padding: 10px; border-radius: 10px; }

    .progress-section { text-align: center; margin-bottom: 16px; }
    .progress-avatar { font-size: 48px; margin-bottom: 8px; }
    .progress-level { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 8px; }
    .progress-bar-container { height: 10px; background: #E5E7EB; border-radius: 5px; overflow: hidden; margin-bottom: 6px; }
    .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #FBBF24, #F59E0B); border-radius: 5px; }
    .progress-text { font-size: 12px; color: #888; }

    .stats-row { display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #f0f0f0; }
    .stat-item { text-align: center; }
    .stat-number { font-size: 24px; font-weight: 700; color: #333; }
    .stat-label { font-size: 12px; color: #888; }

    .help-list-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; cursor: pointer; }
    .help-list-icon { font-size: 24px; }
    .help-list-title { font-size: 14px; font-weight: 600; color: #333; }
    .help-list-desc { font-size: 12px; color: #888; }

    .identify-result { text-align: center; padding: 16px; }
    .identify-thumb { font-size: 64px; margin-bottom: 12px; }
    .identify-name { font-size: 20px; font-weight: 700; color: #333; margin-bottom: 4px; }
    .identify-scientific { font-size: 12px; color: #888; font-style: italic; margin-bottom: 12px; }
    .identify-desc { font-size: 14px; color: #555; line-height: 1.5; }
    .identify-badge { margin-top: 12px; padding: 8px 12px; background: #D1FAE5; color: #059669; border-radius: 8px; font-size: 12px; font-weight: 600; }

    .tip-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px; background: #F9FAFB; border-radius: 10px; margin-bottom: 8px; }
    .tip-status { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
    .tip-status.good { background: #D1FAE5; }
    .tip-status.improve { background: #FEF3C7; }
    .tip-content { flex: 1; }
    .tip-title { font-size: 13px; font-weight: 600; color: #333; }
    .tip-desc { font-size: 12px; color: #888; }

    .effect-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .effect-item { padding: 12px; background: #F9FAFB; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; }
    .effect-item.active { border-color: #6366F1; background: #EEF2FF; }
    .effect-item-icon { font-size: 24px; margin-bottom: 4px; }
    .effect-item-name { font-size: 11px; color: #555; }

    .topic-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; cursor: pointer; }
    .topic-item:hover { background: #F3F4F6; }
    .topic-icon { font-size: 20px; }
    .topic-text { font-size: 14px; color: #333; }

    .story-option { display: flex; align-items: center; gap: 12px; padding: 14px; background: #F9FAFB; border-radius: 14px; margin-bottom: 10px; cursor: pointer; }
    .story-option:hover { background: #F3F4F6; }
    .story-option-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .story-option-icon.adventure { background: linear-gradient(135deg, #FEE2E2, #FECACA); }
    .story-option-icon.bedtime { background: linear-gradient(135deg, #E0E7FF, #C7D2FE); }
    .story-option-icon.funny { background: linear-gradient(135deg, #FEF3C7, #FDE68A); }
    .story-option-title { font-size: 14px; font-weight: 600; color: #333; }
    .story-option-desc { font-size: 12px; color: #888; }

    .quiz-reward { background: linear-gradient(135deg, #FEF3C7, #FDE68A); padding: 10px; border-radius: 10px; text-align: center; font-size: 13px; color: #92400E; margin-bottom: 12px; }
    .quiz-option { padding: 12px; background: #F9FAFB; border-radius: 10px; margin-bottom: 8px; font-size: 14px; color: #333; cursor: pointer; transition: all 0.2s; }
    .quiz-option:hover { background: #f0f0f0; }
    .quiz-option.selected { background: #E0E7FF; border: 2px solid #6366F1; }
    .quiz-option.correct { background: #D1FAE5; color: #059669; border: 2px solid #10B981; }
    .quiz-option.wrong { background: #FEE2E2; color: #DC2626; border: 2px solid #EF4444; }
    .quiz-option.disabled { pointer-events: none; opacity: 0.7; }

    .filter-section { margin-bottom: 12px; }
    .filter-label { font-size: 12px; color: #888; margin-bottom: 8px; }
    .filter-chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .filter-chip { padding: 6px 12px; background: #F3F4F6; border-radius: 16px; font-size: 12px; color: #555; cursor: pointer; }
    .filter-chip.active { background: #EEF2FF; color: #6366F1; }

    .nearby-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; }
    .nearby-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .nearby-content { flex: 1; }
    .nearby-title { font-size: 14px; font-weight: 600; color: #333; }
    .nearby-desc { font-size: 12px; color: #888; }

    .guide-speech { display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: #F0FDF4; border-radius: 14px; margin-bottom: 12px; }
    .guide-avatar { font-size: 32px; }
    .guide-text { font-size: 14px; color: #333; line-height: 1.5; font-style: italic; }

    .surprise-combo { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 20px; }
    .surprise-photo { font-size: 48px; }
    .surprise-plus { font-size: 24px; color: #888; }
    .surprise-style { font-size: 14px; font-weight: 600; color: #333; text-align: center; }
    .surprise-hint { text-align: center; font-size: 12px; color: #888; }

    .creations-count { text-align: center; font-size: 14px; color: #555; padding: 20px; }

    .ai-generic-assistant { text-align: center; padding: 20px; }
    .ai-generic-avatar { font-size: 48px; margin-bottom: 12px; }
    .ai-generic-text { font-size: 14px; color: #555; font-style: italic; margin-bottom: 16px; }
    .ai-generic-btn { background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }

    .ai-generic-row { display: flex; align-items: center; gap: 12px; }
    .ai-generic-row .ai-generic-avatar { font-size: 28px; margin: 0; }
    .ai-generic-row .ai-generic-text { font-size: 13px; color: rgba(255,255,255,0.8); font-style: italic; margin: 0; }
    .ai-generic-row .ai-generic-btn { background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%); color: white; border: none; padding: 8px 16px; border-radius: 10px; font-size: 12px; font-weight: 600; cursor: pointer; white-space: nowrap; }

    /* ============ Camera 相机页 ============ */
    #camera-page {
      background: #1a1a2e;
    }

    .camera-container {
      width: 100%;
      height: 100%;
      position: relative;
      /* 整个页面都是取景器 */
      background: url('https://images.unsplash.com/photo-1518882605630-8eb582f64194?w=800&h=480&fit=crop') center/cover;
      overflow: hidden;
    }

    /* 复古取景框四角装饰 - 居中对称 */
    .viewfinder-corner {
      position: absolute;
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 220, 120, 0.8);
      pointer-events: none;
      z-index: 10;
    }
    .viewfinder-corner.top-left { top: 60px; left: 160px; border-right: none; border-bottom: none; border-radius: 4px 0 0 0; }
    .viewfinder-corner.top-right { top: 60px; right: 160px; border-left: none; border-bottom: none; border-radius: 0 4px 0 0; }
    .viewfinder-corner.bottom-left { bottom: 90px; left: 160px; border-right: none; border-top: none; border-radius: 0 0 0 4px; }
    .viewfinder-corner.bottom-right { bottom: 90px; right: 160px; border-left: none; border-top: none; border-radius: 0 0 4px 0; }

    /* 顶部工具栏 - 透明无背景 */
    .camera-top-bar {
      position: absolute;
      top: 10px; left: 14px; right: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 20;
    }

    .camera-back-btn {
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-back-btn:hover { background: rgba(0, 0, 0, 0.65); }

    .camera-hint {
      background: rgba(0, 0, 0, 0.45);
      border: 1px solid rgba(255, 200, 50, 0.5);
      color: #FFE4A0;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(4px);
    }

    .camera-top-right {
      display: flex;
      gap: 10px;
    }

    .camera-tool-btn {
      width: 36px;
      height: 36px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-tool-btn:hover { background: rgba(0, 0, 0, 0.65); }
    .camera-tool-btn.active { background: rgba(255, 180, 0, 0.6); color: #FFF; }
      transition: all 0.2s;
    }
    .camera-tool-btn:hover { background: rgba(255, 255, 255, 0.25); }
    .camera-tool-btn.active { background: rgba(255, 200, 50, 0.4); color: #FFE135; }

    /* 底部控制栏 - 居中放置工具按钮 */
    .camera-bottom-bar {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 24px;
      z-index: 20;
    }

    /* 左下角相册按钮 */
    .camera-gallery-btn {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 48px;
      height: 48px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: all 0.2s;
    }
    .camera-gallery-btn:hover {
      background: rgba(0, 0, 0, 0.65);
      border-color: rgba(255, 255, 255, 0.5);
    }

    /* 右侧快门按钮 */
    .camera-shutter-area {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 20;
    }

    /* 底部工具按钮 */
    .camera-tool-bottom {
      width: 44px;
      height: 44px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }
    .camera-tool-bottom:hover { background: rgba(0, 0, 0, 0.65); }
    .camera-tool-bottom.active { background: rgba(255, 180, 0, 0.6); color: #FFF; }

    /* 快门按钮 - 拟物金属质感 */
    .shutter-btn {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      position: relative;
      transition: transform 0.15s ease;
    }

    .shutter-btn-outer {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(180deg, #E8E8E8 0%, #B8B8B8 50%, #888 100%);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(255,255,255,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .shutter-btn-inner {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 50%, #E6B800 100%);
      box-shadow: 
        0 2px 8px rgba(0,0,0,0.3),
        inset 0 2px 4px rgba(255,255,255,0.6);
    }

    .shutter-btn:active {
      transform: scale(0.92);
    }
    .shutter-btn:active .shutter-btn-inner {
      background: linear-gradient(180deg, #E6B800 0%, #CC9900 50%, #B38600 100%);
    }

    /* 拍照闪光效果 */
    .camera-flash {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 100;
      transition: opacity 0.1s;
    }
    .camera-flash.active {
      opacity: 1;
    }

    /* ============ Photo Preview 照片预览页 ============ */
    #photo-preview-page {
      /* 使用page-blur-bg统一背景 */
    }

    .preview-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* 返回按钮 */
    .preview-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .preview-back-btn:hover { background: rgba(0, 0, 0, 0.7); }

    /* 全屏照片 */
    .preview-photo-fullscreen {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* AI提示 */
    .preview-ai-hint {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 20px;
      color: rgba(255, 255, 255, 0.95);
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(4px);
      animation: hint-pulse 2s ease-in-out infinite;
    }
    @keyframes hint-pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* ============ Chat 照片聊天页 ============ */
    #chat-page {
      /* 使用page-blur-bg统一背景 */
    }

    .chat-container {
      width: 100%;
      height: 100%;
      display: flex;
      position: relative;
    }

    /* 返回按钮 */
    .chat-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .chat-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 左侧照片区域 - 45% */
    .chat-photo-section {
      width: 45%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 50px 16px 16px 20px;
    }

    .chat-photo-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F8F6F0 100%);
      border-radius: 4px;
      padding: 10px 10px 28px 10px;
      box-shadow: 0 10px 32px rgba(0, 0, 0, 0.2);
      transform: rotate(-3deg);
      position: relative;
    }

    .chat-photo-card img {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 2px;
      display: block;
    }

    /* 胶带装饰 */
    .chat-tape {
      position: absolute;
      width: 50px;
      height: 18px;
      background: linear-gradient(180deg, rgba(255, 245, 190, 0.92) 0%, rgba(245, 225, 150, 0.88) 100%);
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .chat-tape.top {
      top: -6px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
    }
    .chat-tape.bottom-right {
      bottom: 12px;
      right: -12px;
      transform: rotate(-35deg);
      width: 44px;
      height: 16px;
    }

    /* 照片标注 */
    .chat-photo-label {
      position: absolute;
      bottom: 6px;
      left: 12px;
      font-size: 11px;
      color: #888;
      font-style: italic;
    }

    /* 右侧对话区域 - 55% */
    .chat-conversation-section {
      width: 55%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 50px 20px 16px 8px;
    }

    /* 消息列表 */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-right: 6px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 4px;
    }
    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.15);
      border-radius: 2px;
    }

    /* 单条消息 */
    .chat-message {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      max-width: 95%;
    }

    .chat-message.ai { align-self: flex-start; }
    .chat-message.user { align-self: flex-end; flex-direction: row-reverse; }

    .chat-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .chat-avatar.ai-avatar {
      background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .chat-avatar.user-avatar {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .chat-bubble {
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 13px;
      line-height: 1.45;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .chat-message.ai .chat-bubble {
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      color: #333;
      border-bottom-left-radius: 4px;
    }

    .chat-message.user .chat-bubble {
      background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    /* 底部输入区 */
    .chat-input-area {
      margin-top: 12px;
    }

    .chat-speak-btn {
      width: 100%;
      padding: 12px 20px;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
      border: none;
      border-radius: 24px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      color: #5D4E3A;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(255, 200, 0, 0.3);
      transition: all 0.2s;
    }
    .chat-speak-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(255, 200, 0, 0.4);
    }
    .chat-speak-btn:active, .chat-speak-btn.recording {
      transform: translateY(0);
      background: linear-gradient(180deg, #EF4444 0%, #DC2626 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }
    .chat-speak-btn.recording .chat-speak-icon {
      animation: pulse-mic 0.8s ease-in-out infinite;
    }
    @keyframes pulse-mic {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* ============ General Chat 通用聊天页 ============ */
    #general-chat-page {
      /* 使用page-blur-bg统一背景 */
    }

    .general-chat-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 50px 24px 16px;
      position: relative;
    }

    /* 返回按钮 */
    .general-chat-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .general-chat-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 消息列表 */
    .general-chat-messages {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 8px 4px;
    }

    .general-chat-messages::-webkit-scrollbar {
      width: 4px;
    }
    .general-chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .general-chat-messages::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.15);
      border-radius: 2px;
    }

    /* 通用聊天气泡样式复用 chat-message */

    /* 底部输入区 */
    .general-chat-input-area {
      margin-top: 12px;
    }

    .general-chat-speak-btn {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(180deg, #FFE135 0%, #FFD700 100%);
      border: none;
      border-radius: 28px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      color: #5D4E3A;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 14px rgba(255, 200, 0, 0.35);
      transition: all 0.2s;
    }
    .general-chat-speak-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(255, 200, 0, 0.45);
    }
    .general-chat-speak-btn:active, .general-chat-speak-btn.recording {
      transform: translateY(0);
      background: linear-gradient(180deg, #EF4444 0%, #DC2626 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }
    .general-chat-speak-btn.recording .chat-speak-icon {
      animation: pulse-mic 0.8s ease-in-out infinite;
    }

    /* ============ Map 地图页 ============ */
    #map-page {
      background: #D4C4A8;
    }

    .map-container {
      width: 100%;
      height: 100%;
      /* 藏宝图背景图片 */
      background: url('icons/treasure-map.png') center/cover no-repeat;
      position: relative;
      overflow: hidden;
    }

    /* 地图纹理叠加 - 保留轻微暗角效果 */
    .map-texture {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.15) 100%);
      pointer-events: none;
    }

    /* 返回按钮 */
    .map-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .map-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 任务徽章 */
    .map-task-badge {
      position: absolute;
      top: 12px;
      right: 14px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      padding: 8px 14px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: #5D4E3A;
      box-shadow: 0 3px 12px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .task-dot {
      width: 10px;
      height: 10px;
      background: #E74C3C;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    /* 地图标记点 */
    .map-pin {
      position: absolute;
      cursor: pointer;
      transition: transform 0.3s ease;
      z-index: 15;
    }
    .map-pin:hover { transform: scale(1.12); }

    .pin-marker {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.3);
      animation: float 3s ease-in-out infinite;
    }
    .pin-marker.red { background: linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%); }
    .pin-marker.gold { background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%); }
    .pin-marker.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .pin-marker.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .pin-label {
      position: absolute;
      bottom: 56px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: #5D4E3A;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.2s;
    }
    .map-pin:hover .pin-label { opacity: 1; }

    .pin-status {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: white;
      font-weight: 700;
      border: 2px solid white;
    }
    .pin-status.active { background: #E74C3C; animation: pulse 1.5s infinite; }
    .pin-status.done { background: #22C55E; }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    /* 指南针 */
    .map-compass {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 52px;
      height: 52px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 14px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .compass-arrow {
      font-size: 11px;
      font-weight: 700;
      color: #E74C3C;
    }

    /* 路径装饰 */
    .map-path {
      position: absolute;
      border: 2px dashed rgba(255,255,255,0.25);
      border-radius: 50%;
      pointer-events: none;
    }

    /* 任务弹窗 */
    .task-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .task-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .task-modal {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      padding: 24px;
      width: 320px;
      box-shadow: 0 12px 48px rgba(0,0,0,0.3);
      transform: scale(0.9);
      transition: transform 0.25s;
    }
    .task-modal-overlay.show .task-modal {
      transform: scale(1);
    }

    .task-modal-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .task-modal-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .task-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .task-modal-difficulty {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
    }

    .task-modal-desc {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .task-modal-reward {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: rgba(255, 200, 0, 0.15);
      border-radius: 12px;
      margin-bottom: 18px;
      font-size: 13px;
      color: #92400E;
    }

    .task-modal-actions {
      display: flex;
      gap: 12px;
    }

    .task-btn {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-btn-accept {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
    .task-btn-accept:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
    }

    .task-btn-decline {
      background: #E8E4DC;
      color: #666;
    }
    .task-btn-decline:hover {
      background: #DDD8CE;
    }

    /* ============ Workshop 工坊入口页 ============ */
    #workshop-page {
      /* 使用page-blur-bg统一背景 */
    }

    .workshop-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* 返回按钮 */
    .workshop-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
      transition: background 0.2s;
    }
    .workshop-back-btn:hover { background: rgba(0, 0, 0, 0.55); }

    /* 风格卡片滚动容器 */
    .style-cards-container {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 50px 50px 30px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .style-cards-container::-webkit-scrollbar {
      display: none;
    }

    /* 风格卡片 - 放大版 */
    .style-card {
      flex: 0 0 200px;
      height: 340px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      box-shadow: 0 10px 32px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      scroll-snap-align: center;
    }
    .style-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
    }
    .style-card:active { transform: scale(0.97); }

    .style-preview {
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 90px;
    }
    .style-ghibli { background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFE4B5 100%); }
    .style-pixel { background: linear-gradient(135deg, #A78BFA 0%, #60A5FA 50%, #34D399 100%); }
    .style-watercolor { background: linear-gradient(135deg, #FDA4AF 0%, #93C5FD 50%, #C4B5FD 100%); }
    .style-cartoon { background: linear-gradient(135deg, #F87171 0%, #FBBF24 50%, #2DD4BF 100%); }

    .style-info {
      flex: 1;
      padding: 14px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
    }

    .style-name {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .style-try-btn {
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .style-try-btn:hover {
      background: linear-gradient(180deg, #8B5A2B 0%, #6B4423 100%);
    }

    /* ============ Photo Effect 风格选择页 ============ */
    #photo-effect-page {
      /* 使用page-blur-bg统一背景 */
    }

    .effect-container {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .effect-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 已选照片缩略图 */
    .effect-selected-photo {
      position: absolute;
      top: 12px;
      right: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 0, 0, 0.4);
      padding: 6px 12px 6px 6px;
      border-radius: 20px;
      z-index: 20;
    }
    .effect-photo-thumb {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.5);
    }
    .effect-photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .effect-photo-label {
      font-size: 12px;
      color: white;
      font-weight: 500;
    }

    /* 风格卡片滚动容器 */
    .effect-cards-scroll {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 50px 50px 30px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .effect-cards-scroll::-webkit-scrollbar {
      display: none;
    }

    /* 风格选择页底部 */
    .effect-footer {
      position: absolute;
      bottom: 16px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      z-index: 10;
    }

    /* 单张风格卡片 */
    .effect-card {
      flex: 0 0 200px;
      height: 340px;
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 36px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      scroll-snap-align: center;
    }
    .effect-card:hover {
      transform: scale(1.03);
    }
    .effect-card.selected {
      box-shadow: 0 0 0 4px #FFD700, 0 10px 36px rgba(0,0,0,0.3);
    }

    /* 效果预览区 */
    .effect-card-preview {
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 90px;
    }

    /* 底部信息区 */
    .effect-card-info {
      flex: 1;
      padding: 14px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
    }

    .effect-card-name {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .effect-try-btn {
      background: linear-gradient(180deg, #A67C52 0%, #8B5A2B 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    /* ============ Workshop Photo 选图页 ============ */
    #workshop-photo-page {
      /* 使用page-blur-bg统一背景 */
    }

    .photo-select-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 20px 16px;
      position: relative;
    }

    .photo-select-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    /* 已选风格横幅 */
    .selected-style-banner {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 14px;
      padding: 10px 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
    }

    .style-badge {
      background: linear-gradient(135deg, #A67C52 0%, #8B5A2B 100%);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .style-badge-hint {
      color: #888;
      font-size: 13px;
    }

    /* 照片选择网格 */
    .photo-select-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .photo-select-item {
      aspect-ratio: 1;
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .photo-select-item:hover {
      transform: scale(1.04);
      box-shadow: 0 5px 16px rgba(0,0,0,0.15);
    }
    .photo-select-item.selected {
      box-shadow: 0 0 0 3px #FFD700, 0 5px 16px rgba(0,0,0,0.15);
    }

    .photo-select-item.take-new {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      flex-direction: column;
      gap: 4px;
    }
    .photo-select-item.take-new .take-new-label {
      font-size: 11px;
      font-weight: 600;
      color: #92400E;
    }

    /* 底部操作栏 */
    .photo-select-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .aigc-agreement {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #666;
    }

    .aigc-agreement input {
      width: 18px;
      height: 18px;
      accent-color: #8B5A2B;
    }

    .create-btn {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      color: #5D4E3A;
      border: none;
      padding: 12px 24px;
      border-radius: 16px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(255, 200, 0, 0.35);
      transition: all 0.2s;
    }
    .create-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(255, 200, 0, 0.45);
    }
    .create-btn:disabled {
      background: #CCC;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* ============ AIGC Result 生成结果页 ============ */
    #aigc-result-page {
      background: #000;
    }
    .aigc-result-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .aigc-result-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }
    .aigc-result-image-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .aigc-result-fullimg, .aigc-original-fullimg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.2s ease;
    }
    .aigc-result-fullimg {
      z-index: 2;
      opacity: 1;
    }
    .aigc-original-fullimg {
      z-index: 1;
      opacity: 0;
    }
    .aigc-result-style-tag {
      position: absolute;
      top: 12px;
      right: 14px;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 14px;
      border-radius: 18px;
      font-size: 13px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    .aigc-result-actions-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px 20px;
      background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.8) 100%);
      display: flex;
      gap: 12px;
      z-index: 10;
    }
    .aigc-action-btn {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 16px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .aigc-action-btn.compare {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(4px);
    }
    .aigc-action-btn.compare:active {
      background: rgba(255, 255, 255, 0.35);
    }
    .aigc-action-btn.save {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      color: #5D4E3A;
      box-shadow: 0 4px 12px rgba(255, 200, 0, 0.3);
    }
    .aigc-action-btn.save:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(255, 200, 0, 0.4);
    }

    .aigc-action-btn.share {
      background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    /* 照片预览页分享按钮 */
    .preview-share-btn {
      position: absolute;
      top: 12px;
      right: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    /* ============ 分享弹窗 ============ */
    .share-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .share-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .share-modal {
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      border-radius: 24px 24px 0 0;
      padding: 20px;
      width: 100%;
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
    }
    .share-modal-overlay.show .share-modal {
      transform: translateY(0);
    }

    .share-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .share-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }

    .share-modal-close {
      background: rgba(0,0,0,0.1);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      color: #666;
    }

    .share-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .share-option {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      background: white;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.2s;
    }
    .share-option:active {
      transform: scale(0.98);
      background: #F9FAFB;
    }

    .share-option-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .share-option-icon.family {
      background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
    }
    .share-option-icon.qr {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
    }

    .share-option-info {
      flex: 1;
    }

    .share-option-name {
      font-size: 15px;
      font-weight: 600;
      color: #333;
    }

    .share-option-desc {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
    }

    .share-option-arrow {
      font-size: 18px;
      color: #CCC;
    }

    .share-privacy-note {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 16px;
      padding: 10px;
      background: rgba(34, 197, 94, 0.1);
      border-radius: 10px;
      font-size: 11px;
      color: #22C55E;
    }

    /* ============ QR分享卡片弹窗 ============ */
    .qr-share-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 350;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .qr-share-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .qr-share-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #FDF5E6 100%);
      border-radius: 20px;
      padding: 16px;
      width: 300px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
      transform: scale(0.9);
      transition: transform 0.3s;
    }
    .qr-share-overlay.show .qr-share-card {
      transform: scale(1);
    }

    .qr-share-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      color: white;
      z-index: 10;
      backdrop-filter: blur(4px);
    }

    .qr-share-preview {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .qr-card-image {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
    }
    .qr-card-image img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }
    .qr-card-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 10px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 8px;
      backdrop-filter: blur(4px);
    }

    .qr-card-info {
      text-align: center;
    }

    .qr-card-title {
      font-size: 16px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .qr-card-explorer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 6px;
    }

    .qr-explorer-avatar {
      font-size: 18px;
    }

    .qr-explorer-name {
      font-size: 13px;
      font-weight: 600;
      color: #666;
    }

    .qr-explorer-level {
      font-size: 11px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      padding: 2px 6px;
      border-radius: 6px;
    }

    .qr-card-date {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
    }

    .qr-code-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 0;
      border-top: 1px dashed #E5E7EB;
      border-bottom: 1px dashed #E5E7EB;
    }

    .qr-code-placeholder {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 8px;
      padding: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .qr-code-grid {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(7, 1fr);
      gap: 2px;
    }
    .qr-code-grid div {
      background: #333;
      border-radius: 1px;
    }
    .qr-code-grid div:nth-child(odd) {
      background: #333;
    }
    .qr-code-grid div:nth-child(even) {
      background: transparent;
    }
    .qr-code-grid div:nth-child(3n) {
      background: #333;
    }

    .qr-code-hint {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }

    .qr-code-expire {
      font-size: 10px;
      color: #F59E0B;
      margin-top: 4px;
    }

    .qr-card-footer {
      text-align: center;
      padding-top: 8px;
    }

    .qr-card-brand {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .qr-card-tagline {
      font-size: 10px;
      color: #999;
      margin-top: 2px;
    }

    /* 探险家卡片分享样式 */
    .qr-share-card.explorer-card {
      background: linear-gradient(180deg, #FFF8E7 0%, #FFE4B5 100%);
      padding: 16px;
      position: relative;
      max-height: 90%;
      overflow: visible;
    }

    .explorer-card-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(139, 90, 43, 0.9);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .explorer-share-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .explorer-card-header {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 700;
      color: #8B5A2B;
    }

    .explorer-card-avatar {
      position: relative;
    }

    .card-avatar-frame {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: 0 0 0 3px #FFD700, 0 4px 10px rgba(255,165,0,0.4);
    }

    .card-streak-badge {
      position: absolute;
      bottom: -2px;
      right: -6px;
      background: linear-gradient(135deg, #FF6B6B 0%, #EE5A24 100%);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 10px;
    }

    .explorer-card-identity {
      text-align: center;
    }

    .card-title-badge {
      display: inline-block;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      font-size: 9px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 8px;
      text-transform: uppercase;
    }

    .card-name {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
      margin-top: 4px;
    }

    .card-level {
      font-size: 13px;
      color: #F59E0B;
      font-weight: 600;
      margin-top: 2px;
    }

    .explorer-card-stats {
      display: flex;
      gap: 16px;
      padding: 6px 0;
    }

    .card-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .card-stat-label {
      font-size: 9px;
      color: #888;
      text-transform: uppercase;
    }

    .explorer-card-badges {
      display: flex;
      gap: 6px;
      font-size: 20px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.5);
      border-radius: 10px;
    }

    .qr-share-card.explorer-card .qr-code-section {
      padding: 8px 0;
    }

    .qr-share-card.explorer-card .qr-card-footer {
      padding-top: 8px;
    }

    /* ============ XP飘字动画 ============ */
    .xp-float {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: 700;
      color: #FFD700;
      text-shadow: 0 2px 8px rgba(255, 215, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);
      z-index: 500;
      pointer-events: none;
      opacity: 0;
    }
    .xp-float.show {
      animation: xpFloatUp 1.5s ease-out forwards;
    }
    @keyframes xpFloatUp {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2);
      }
      40% {
        transform: translate(-50%, -70%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -120%) scale(0.8);
      }
    }

    /* ============ 升级弹窗 ============ */
    .levelup-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .levelup-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .levelup-modal {
      background: linear-gradient(180deg, #FFF8E7 0%, #FFE4B5 100%);
      border-radius: 24px;
      padding: 28px 24px;
      text-align: center;
      width: 280px;
      transform: scale(0.8);
      transition: transform 0.3s;
    }
    .levelup-modal-overlay.show .levelup-modal {
      transform: scale(1);
    }

    .levelup-stars {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .levelup-title {
      font-size: 24px;
      font-weight: 700;
      color: #F59E0B;
      margin-bottom: 4px;
    }

    .levelup-levels {
      font-size: 16px;
      color: #8B5A2B;
      margin-bottom: 16px;
    }

    .levelup-unlocks {
      background: rgba(255,255,255,0.6);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 20px;
    }

    .levelup-unlocks-title {
      font-size: 11px;
      font-weight: 700;
      color: #999;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .levelup-unlock-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      color: #5D4E3A;
      padding: 4px 0;
    }

    .levelup-btn {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      border: none;
      border-radius: 20px;
      padding: 12px 40px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 700;
      color: #5D4E3A;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(255, 200, 0, 0.4);
    }

    /* ============ 徽章解锁弹窗 ============ */
    .badge-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 510;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .badge-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .badge-modal {
      background: linear-gradient(180deg, #FFFEF8 0%, #FDF5E6 100%);
      border-radius: 24px;
      padding: 28px 24px;
      text-align: center;
      width: 280px;
      transform: scale(0.8);
      transition: transform 0.3s;
      position: relative;
      overflow: hidden;
    }
    .badge-modal-overlay.show .badge-modal {
      transform: scale(1);
    }

    .badge-confetti {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      font-size: 20px;
      line-height: 1;
      opacity: 0.6;
      overflow: hidden;
    }

    .badge-icon-large {
      width: 100px;
      height: 100px;
      margin: 0 auto 12px;
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      box-shadow: 0 0 0 4px #FFD700, 0 8px 24px rgba(255,200,0,0.3);
      animation: badgePop 0.5s ease-out;
    }
    @keyframes badgePop {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .badge-unlock-title {
      font-size: 14px;
      font-weight: 700;
      color: #F59E0B;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .badge-name-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .badge-name {
      font-size: 22px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .badge-description {
      font-size: 13px;
      color: #888;
      margin-bottom: 20px;
    }

    .badge-rarity {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .badge-rarity.common { background: #E5E7EB; color: #6B7280; }
    .badge-rarity.rare { background: linear-gradient(135deg, #DBEAFE 0%, #93C5FD 100%); color: #1D4ED8; }
    .badge-rarity.epic { background: linear-gradient(135deg, #E9D5FF 0%, #C084FC 100%); color: #7C3AED; }
    .badge-rarity.legendary { background: linear-gradient(135deg, #FEF3C7 0%, #FCD34D 100%); color: #B45309; }

    .badge-btn {
      border: none;
      border-radius: 20px;
      padding: 12px 40px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
    }
    .badge-btn.continue {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      color: #5D4E3A;
      box-shadow: 0 4px 12px rgba(255, 200, 0, 0.4);
    }

    /* 分享成功提示 */
    .share-success-toast {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 16px 24px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 600;
      z-index: 400;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
    }
    .share-success-toast.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    /* ============ AIGC 生成弹窗 ============ */
    .aigc-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .aigc-modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .aigc-modal {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 24px;
      padding: 24px;
      width: 320px;
      box-shadow: 0 16px 56px rgba(0,0,0,0.3);
      transform: scale(0.9);
      transition: transform 0.25s;
    }
    .aigc-modal-overlay.show .aigc-modal {
      transform: scale(1);
    }

    .aigc-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
      text-align: center;
      margin-bottom: 16px;
    }

    /* 生成中状态 */
    .aigc-generating {
      text-align: center;
      padding: 20px 0;
    }

    .aigc-spinner {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      animation: spin-bounce 1.5s ease-in-out infinite;
    }

    @keyframes spin-bounce {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.05); }
      50% { transform: rotate(180deg) scale(1); }
      75% { transform: rotate(270deg) scale(1.05); }
    }

    .aigc-progress-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }

    .aigc-progress-bar {
      width: 100%;
      height: 8px;
      background: #E8E4DC;
      border-radius: 4px;
      overflow: hidden;
    }

    .aigc-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #FFD700 0%, #F59E0B 100%);
      border-radius: 4px;
      transition: width 0.3s;
    }

    /* 生成完成状态 */
    .aigc-result {
      text-align: center;
    }

    .aigc-result-image {
      width: 180px;
      height: 180px;
      margin: 0 auto 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFE4B5 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .aigc-result-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    .aigc-result-actions {
      display: flex;
      gap: 12px;
    }

    .aigc-result-btn {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .aigc-result-btn.secondary {
      background: #E8E4DC;
      color: #5D4E3A;
    }

    .aigc-result-btn.primary {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      color: white;
    }

    /* ============ Backpack 背包页 ============ */
    #backpack-page {
      /* 使用page-blur-bg统一背景 */
    }

    .backpack-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
    }

    .backpack-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* Tab栏 */
    .backpack-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .backpack-tab {
      flex: 1;
      background: rgba(0, 0, 0, 0.25);
      border: none;
      border-radius: 14px;
      padding: 12px 8px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    .backpack-tab.active {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      color: #5D4E3A;
      text-shadow: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* 内容区 */
    .backpack-content {
      flex: 1;
      overflow-y: auto;
    }

    /* 相册网格 - 3列 */
    .album-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .album-item {
      aspect-ratio: 1;
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transition: all 0.2s;
    }
    .album-item:hover { transform: scale(1.04); }
    .album-item.hidden { display: none; }

    /* Album 筛选器 */
    .album-filter {
      background: rgba(0, 0, 0, 0.2);
      border: none;
      border-radius: 20px;
      padding: 6px 14px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    .album-filter.active {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
    }

    /* 故事网格 */
    .stories-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .story-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 14px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transition: all 0.2s;
    }
    .story-card:hover { transform: scale(1.02); }
    .story-card-cover {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
    }
    .story-card-info {
      padding: 8px 10px;
    }
    .story-card-title {
      font-size: 12px;
      font-weight: 600;
      color: #333;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .story-card-meta {
      font-size: 9px;
      color: #888;
    }

    /* 图鉴分类网格 */
    .guide-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .guide-item {
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 16px;
      padding: 16px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    .guide-item:hover { transform: translateY(-3px); }

    .guide-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 3px 8px rgba(34, 197, 94, 0.3);
    }

    .guide-name {
      font-size: 13px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .guide-count {
      font-size: 11px;
      color: #888;
    }

    /* 徽章网格 */
    .badge-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }

    .badge-grid .badge-item {
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      border-radius: 16px;
      padding: 18px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      transition: all 0.2s;
    }
    .badge-grid .badge-item:hover { transform: scale(1.03); }
    .badge-grid .badge-item.locked {
      background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%);
      opacity: 0.6;
      box-shadow: none;
    }

    .badge-grid .badge-icon { font-size: 44px; }
    .badge-grid .badge-name {
      font-size: 12px;
      font-weight: 600;
      color: #5D4E3A;
      text-align: center;
    }
    .badge-grid .badge-item.locked .badge-name { color: #444; }

    /* ============ Species List 图鉴列表页 ============ */
    #species-list-page {
      /* 使用page-blur-bg统一背景 */
    }

    .species-list-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
    }

    .species-list-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 列表头部 */
    .species-list-header {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 16px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
    }

    .species-list-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .species-list-title {
      font-size: 17px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .species-list-count {
      font-size: 12px;
      color: #888;
    }

    /* 物种卡片网格 - 3列 */
    .species-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      overflow-y: auto;
    }

    .species-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F0EBE3 100%);
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    }
    .species-card:hover { transform: translateY(-3px); }

    .species-card-img {
      height: 90px;
      background: linear-gradient(135deg, #E0F2FE 0%, #DBEAFE 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
    }

    .species-card-info {
      padding: 10px;
      text-align: center;
    }

    .species-card-name {
      font-size: 13px;
      font-weight: 700;
      color: #5D4E3A;
      margin-bottom: 2px;
    }

    .species-card-date {
      font-size: 10px;
      color: #888;
    }

    /* ============ Species Detail 图鉴详情页 ============ */
    #species-detail-page {
      /* 使用page-blur-bg统一背景 */
    }

    .species-detail-container {
      width: 100%;
      height: 100%;
      display: flex;
      padding: 56px 20px 16px;
      gap: 16px;
      position: relative;
    }

    .species-detail-back-btn {
      position: absolute;
      top: 12px;
      left: 14px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 左侧照片 */
    .species-detail-photo {
      width: 45%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .species-photo-frame {
      background: linear-gradient(180deg, #FFFEF8 0%, #F8F6F0 100%);
      padding: 10px 10px 28px 10px;
      border-radius: 4px;
      box-shadow: 0 10px 32px rgba(0,0,0,0.2);
      transform: rotate(-2deg);
      position: relative;
    }

    .species-photo-frame img {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 2px;
      display: block;
    }

    .species-photo-tape {
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
      width: 50px;
      height: 18px;
      background: linear-gradient(180deg, rgba(255, 245, 190, 0.9) 0%, rgba(245, 225, 150, 0.85) 100%);
    }

    /* 右侧信息 */
    .species-detail-info {
      width: 55%;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .species-info-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 20px;
      padding: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    .species-info-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(0,0,0,0.06);
    }

    .species-info-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .species-info-name {
      font-size: 16px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .species-info-latin {
      font-size: 11px;
      color: #888;
      font-style: italic;
    }

    /* 趣味知识 */
    .species-fun-facts {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fun-fact {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 12px;
    }

    .fun-fact-icon {
      font-size: 18px;
      flex-shrink: 0;
    }

    .fun-fact-text {
      font-size: 12px;
      color: #555;
      line-height: 1.45;
    }

    /* ============ Explorer 探险家中心页 ============ */
    #explorer-page {
      /* 使用page-blur-bg统一背景 */
    }

    .explorer-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      gap: 10px;
      overflow-y: auto;
      position: relative;
    }

    .explorer-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    /* Explorer页分享卡片按钮 */
    .explorer-share-card-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      margin-top: 8px;
      padding: 12px;
      background: linear-gradient(135deg, #5D9E5A 0%, #4A8A47 100%);
      border: none;
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(74, 138, 71, 0.3);
      transition: all 0.2s;
    }
    .explorer-share-card-btn:active {
      transform: scale(0.98);
    }

    /* 身份卡 */
    .explorer-identity-card {
      background: linear-gradient(135deg, #FFF8E7 0%, #FDF5E6 100%);
      border-radius: 16px;
      padding: 18px 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      position: relative;
    }

    .explorer-profile {
      display: flex;
      gap: 18px;
    }

    .explorer-avatar-large {
      position: relative;
    }

    .avatar-frame {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }
    .avatar-frame.gold {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      box-shadow: 0 0 0 3px #FFD700, 0 4px 12px rgba(255,165,0,0.4);
    }

    .avatar-streak {
      position: absolute;
      bottom: -4px;
      right: -8px;
      background: linear-gradient(135deg, #FF6B6B 0%, #EE5A24 100%);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 3px 7px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .explorer-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
    }

    .explorer-title {
      font-size: 11px;
      font-weight: 600;
      color: #8B5A2B;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .explorer-name {
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .explorer-level-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .level-text {
      font-size: 13px;
      font-weight: 700;
      color: #4CAF50;
    }

    .level-xp {
      font-size: 11px;
      color: #888;
    }

    .xp-progress-bar {
      height: 8px;
      background: rgba(0,0,0,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 6px;
    }

    .xp-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .today-xp {
      position: absolute;
      top: 14px;
      right: 16px;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .today-xp-label {
      font-size: 9px;
      opacity: 0.9;
    }

    .today-xp-value {
      font-size: 14px;
      font-weight: 700;
    }

    /* 统计数据 */
    .explorer-stats {
      display: flex;
      gap: 10px;
    }

    .stat-item {
      flex: 1;
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      border-radius: 12px;
      padding: 10px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

    .stat-icon {
      font-size: 18px;
    }

    .stat-value {
      font-size: 16px;
      font-weight: 700;
      color: #333;
    }

    .stat-label {
      font-size: 9px;
      color: #888;
      text-transform: uppercase;
    }

    /* 徽章展示 */
    .explorer-badges-section {
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: #5D4E3A;
    }

    .see-all-btn {
      background: none;
      border: none;
      font-size: 11px;
      color: #8B5A2B;
      font-weight: 600;
      cursor: pointer;
    }

    .badges-showcase {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .badges-showcase::-webkit-scrollbar {
      display: none;
    }

    .badge-item {
      flex: 0 0 90px;
      background: linear-gradient(180deg, #F5F5F5 0%, #E8E8E8 100%);
      border-radius: 12px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      position: relative;
    }

    .badge-item.earned {
      background: linear-gradient(180deg, #FFF8E7 0%, #FFE4B5 100%);
    }

    .badge-item.new::after {
      content: 'NEW';
      position: absolute;
      top: -5px;
      right: -5px;
      background: #EF4444;
      color: white;
      font-size: 7px;
      font-weight: 700;
      padding: 2px 4px;
      border-radius: 5px;
    }

    .badge-item.locked {
      opacity: 0.6;
    }

    .badge-icon {
      font-size: 28px;
    }

    .badge-item .badge-name {
      font-size: 9px;
      font-weight: 600;
      color: #555;
      text-align: center;
      line-height: 1.2;
    }

    .badge-rarity {
      font-size: 8px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 6px;
      text-transform: uppercase;
    }

    .badge-rarity.common {
      background: #C0C0C0;
      color: white;
    }

    .badge-rarity.rare {
      background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
      color: white;
    }

    .badge-rarity.epic {
      background: linear-gradient(135deg, #A855F7 0%, #7C3AED 100%);
      color: white;
    }

    .badge-progress {
      font-size: 9px;
      font-weight: 600;
      color: #888;
    }

    /* 下一个目标 */
    .next-goal-section {
      margin-top: auto;
      padding-top: 8px;
    }

    .next-goal-card {
      background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
      border-radius: 14px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
    }

    .goal-icon {
      font-size: 28px;
    }

    .goal-info {
      flex: 1;
    }

    .goal-title {
      font-size: 13px;
      font-weight: 700;
      color: white;
    }

    .goal-desc {
      font-size: 11px;
      color: rgba(255,255,255,0.85);
      margin-top: 2px;
    }

    .goal-arrow {
      font-size: 16px;
      color: rgba(255,255,255,0.7);
    }

    /* ============ Level Guide 升级指南页 ============ */
    #level-guide-page {
      /* 使用page-blur-bg统一背景 */
    }

    .level-guide-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 20px 16px;
      gap: 12px;
      overflow-y: auto;
    }

    .level-guide-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    .level-guide-title {
      font-size: 18px;
      font-weight: 700;
      color: white;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* 等级进度线 */
    .level-timeline {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 20px 12px 24px;
      position: relative;
    }

    .timeline-track {
      height: 6px;
      background: #E5E7EB;
      border-radius: 3px;
      position: absolute;
      left: 24px;
      right: 24px;
      top: 29px;
    }

    .timeline-progress {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
      border-radius: 3px;
    }

    .timeline-nodes {
      display: flex;
      justify-content: space-between;
      position: relative;
      z-index: 1;
    }

    .timeline-node {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #E5E7EB;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .timeline-node.completed {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    }

    .timeline-node.current {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.4);
    }

    .timeline-node.legendary-node {
      background: linear-gradient(135deg, #A855F7 0%, #7C3AED 100%);
    }

    .node-level {
      font-size: 10px;
      font-weight: 700;
      color: white;
    }

    .timeline-node:not(.completed):not(.current):not(.legendary-node) .node-level {
      color: #9CA3AF;
    }

    .node-you {
      position: absolute;
      bottom: -14px;
      font-size: 8px;
      font-weight: 700;
      color: #F59E0B;
      white-space: nowrap;
    }

    /* 等级列表 */
    .level-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .level-card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 12px;
      border-left: 4px solid #E5E7EB;
    }

    .level-card.completed {
      border-left-color: #4CAF50;
      opacity: 0.7;
    }

    .level-card.current {
      border-left-color: #FFD700;
      background: linear-gradient(135deg, #FFFEF0 0%, #FFF8DC 100%);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }

    .level-card.next {
      border-left-color: #667EEA;
      background: linear-gradient(135deg, #F0F4FF 0%, #E8EDFF 100%);
    }

    .level-card.locked {
      opacity: 0.5;
    }

    .level-card.legendary {
      border-left-color: #A855F7;
      background: linear-gradient(135deg, #FAF5FF 0%, #F3E8FF 100%);
    }

    .level-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .level-num {
      font-size: 12px;
      font-weight: 700;
      color: #666;
    }

    .level-name {
      flex: 1;
      font-size: 13px;
      font-weight: 600;
      color: #333;
    }

    .level-status {
      font-size: 12px;
    }

    .level-status.current-badge {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: white;
      font-size: 9px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 8px;
    }

    .level-status.next-badge {
      background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
      color: white;
      font-size: 9px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 8px;
    }

    .level-unlocks {
      margin-top: 8px;
    }

    .unlock-category {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .unlock-tag {
      font-size: 10px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      gap: 2px;
    }

    /* AI角色 - 紫色 */
    .unlock-tag.ai {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
      color: #7C3AED;
    }

    /* 画风 - 橙色 */
    .unlock-tag.style {
      background: linear-gradient(135deg, #FED7AA 0%, #FDBA74 100%);
      color: #C2410C;
    }

    /* 头像框 - 金色 */
    .unlock-tag.frame {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
      color: #B45309;
    }

    /* 称号 - 绿色 */
    .unlock-tag.title {
      background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
      color: #047857;
    }

    /* 功能 - 蓝色 */
    .unlock-tag.feature {
      background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
      color: #1D4ED8;
    }

    /* 贴纸 - 粉色 */
    .unlock-tag.sticker {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      color: #BE185D;
    }

    /* 高亮(下一级重点) */
    .unlock-tag.highlight {
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.4);
      animation: tag-pulse 2s infinite;
    }

    @keyframes tag-pulse {
      0%, 100% { box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.4); }
      50% { box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2); }
    }

    /* 传说级 - 彩虹渐变 */
    .unlock-tag.legendary {
      background: linear-gradient(135deg, #FFD700 0%, #FF6B6B 25%, #A855F7 50%, #3B82F6 75%, #10B981 100%);
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .level-progress-info {
      margin-top: 8px;
      font-size: 11px;
      color: #888;
    }

    .mini-progress {
      height: 4px;
      background: rgba(0,0,0,0.1);
      border-radius: 2px;
      margin-top: 4px;
    }

    .mini-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
      border-radius: 2px;
    }

    .level-xp-need {
      margin-top: 6px;
      font-size: 11px;
      color: #667EEA;
      font-weight: 600;
    }

    /* XP获取指南 */
    .xp-guide-section {
      background: rgba(255,255,255,0.95);
      border-radius: 14px;
      padding: 14px;
      margin-top: 4px;
    }

    .xp-guide-title {
      font-size: 14px;
      font-weight: 700;
      color: #5D4E3A;
      margin-bottom: 10px;
    }

    .xp-guide-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .xp-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .xp-item:last-child {
      border-bottom: none;
    }

    .xp-action {
      font-size: 12px;
      color: #555;
    }

    .xp-value {
      font-size: 12px;
      font-weight: 700;
      color: #4CAF50;
    }

    /* ============ 首页通知铃铛 ============ */
    .home-notification-bell {
      position: absolute;
      top: 50px;
      right: 20px;
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      cursor: pointer;
      z-index: 20;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.2s;
    }
    .home-notification-bell:active {
      transform: scale(0.95);
    }
    .home-notification-bell .notification-dot {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 10px;
      height: 10px;
      background: #EF4444;
      border-radius: 50%;
      border: 2px solid white;
    }

    /* Explorer页通知按钮 */
    .explorer-notification-btn {
      position: absolute;
      top: 14px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      z-index: 20;
      backdrop-filter: blur(4px);
    }
    .explorer-notification-btn .notification-dot {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 8px;
      height: 8px;
      background: #EF4444;
      border-radius: 50%;
      border: 2px solid white;
    }

    /* ============ Notifications 通知列表页 ============ */
    #notifications-page {
      overflow: hidden;
    }

    .notifications-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 56px 20px 20px;
      overflow-y: auto;
    }

    .notifications-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.4);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    .notifications-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 700;
      color: #5D4E3A;
      margin-bottom: 16px;
    }

    .notifications-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .notifications-date-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .notifications-date {
      font-size: 12px;
      font-weight: 700;
      color: #5D4E3A;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding-left: 4px;
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }

    .notification-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      background: white;
      border-radius: 14px;
      padding: 12px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.2s;
    }
    .notification-item:active {
      transform: scale(0.98);
      background: #F9FAFB;
    }
    .notification-item.unread {
      background: linear-gradient(135deg, #FFF8E7 0%, #FFFDF5 100%);
      box-shadow: 0 2px 8px rgba(255, 200, 50, 0.2);
    }
    .notification-item.expanded .notification-preview {
      display: none;
    }
    .notification-item.expanded .notification-full {
      display: block;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    .notification-icon.parent {
      background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
    }
    .notification-icon.quest {
      background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
    }
    .notification-icon.badge {
      background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
    }
    .notification-icon.level {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
    }
    .notification-icon.system {
      background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
    }

    .notification-content {
      flex: 1;
      min-width: 0;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }

    .notification-sender {
      font-size: 13px;
      font-weight: 600;
      color: #333;
    }

    .notification-time {
      font-size: 11px;
      color: #999;
    }

    .notification-preview {
      font-size: 12px;
      color: #666;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notification-full {
      display: none;
      font-size: 12px;
      color: #666;
      line-height: 1.5;
    }

    .notification-arrow {
      font-size: 18px;
      color: #CCC;
      align-self: center;
    }

    /* ============ Settings 设置页 ============ */
    #settings-page {
      /* 使用page-blur-bg统一背景 */
    }

    .settings-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
    }

    .settings-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    /* 设置列表 */
    .settings-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
    }

    .settings-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .settings-group-title {
      color: #5D4E3A;
      font-size: 12px;
      font-weight: 700;
      padding-left: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }

    .settings-group-card {
      background: linear-gradient(180deg, #FFFEF8 0%, #F5F0E6 100%);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .settings-item {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .settings-item:last-child {
      border-bottom: none;
    }
    .settings-item:hover {
      background: rgba(0,0,0,0.02);
    }

    .settings-item-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .settings-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .settings-icon.blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
    .settings-icon.green { background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%); }
    .settings-icon.orange { background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); }
    .settings-icon.purple { background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%); }
    .settings-icon.gray { background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%); }
    .settings-icon.red { background: linear-gradient(135deg, #F87171 0%, #EF4444 100%); }

    .settings-label {
      font-size: 14px;
      font-weight: 600;
      color: #5D4E3A;
    }

    .settings-value {
      font-size: 12px;
      color: #888;
      margin-top: 1px;
    }

    .settings-chevron {
      color: #CCC;
      font-size: 18px;
      font-weight: 300;
    }

    /* 开关 */
    .toggle-switch {
      width: 46px;
      height: 26px;
      background: #D1D5DB;
      border-radius: 13px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }
    .toggle-switch.active {
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
    }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    /* 滑块 */
    .settings-slider {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider-track {
      width: 100px;
      height: 6px;
      background: #E5E7EB;
      border-radius: 3px;
      position: relative;
    }

    .slider-fill {
      height: 100%;
      background: linear-gradient(90deg, #60A5FA 0%, #3B82F6 100%);
      border-radius: 3px;
    }

    .slider-value {
      font-size: 12px;
      font-weight: 600;
      color: #5D4E3A;
      min-width: 32px;
    }

    /* 设置项展开 */
    .settings-item.expandable {
      cursor: pointer;
    }
    .settings-item.expandable.expanded .settings-chevron {
      transform: rotate(90deg);
    }

    .settings-expand-content {
      display: none;
      padding: 12px 16px;
      background: #F9FAFB;
      border-top: 1px solid #F0F0F0;
    }
    .settings-expand-content.show {
      display: block;
    }

    /* Storage详情 */
    .storage-detail {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .storage-bar {
      height: 8px;
      background: #E5E7EB;
      border-radius: 4px;
      display: flex;
      overflow: hidden;
    }
    .storage-segment {
      height: 100%;
    }
    .storage-segment.photos { background: #3B82F6; }
    .storage-segment.aigc { background: #8B5CF6; }
    .storage-segment.system { background: #F59E0B; }

    .storage-legend {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #666;
    }
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 2px;
    }
    .legend-dot.photos { background: #3B82F6; }
    .legend-dot.aigc { background: #8B5CF6; }
    .legend-dot.system { background: #F59E0B; }
    .legend-dot.free { background: #E5E7EB; }

    /* Battery详情 */
    .battery-detail {
      text-align: center;
    }
    .battery-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    .battery-icon { font-size: 24px; }
    .battery-percent { font-size: 20px; font-weight: 700; color: #22C55E; }
    .battery-health { font-size: 13px; color: #22C55E; }
    .battery-info { font-size: 12px; color: #888; }

    /* Device Info详情 */
    .device-info-detail {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }
    .info-row span:first-child { color: #888; }
    .info-row span:last-child { color: #5D4E3A; font-weight: 500; }

    /* About详情 */
    .about-detail {
      text-align: center;
      padding: 10px 0;
    }
    .about-logo { font-size: 40px; margin-bottom: 8px; }
    .about-name { font-size: 18px; font-weight: 700; color: #5D4E3A; }
    .about-version { font-size: 12px; color: #888; margin-top: 2px; }
    .about-tagline { font-size: 11px; color: #999; margin-top: 8px; }
    .about-copyright { font-size: 10px; color: #BBB; margin-top: 4px; }

    /* 亮度滑块完整版 */
    .brightness-slider-full {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .slider-track-full {
      flex: 1;
      height: 8px;
      background: #E5E7EB;
      border-radius: 4px;
      position: relative;
    }
    .slider-track-full .slider-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, #60A5FA 0%, #3B82F6 100%);
      border-radius: 4px;
    }
    .slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    /* ============ Settings底部弹窗 ============ */
    .settings-sheet-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .settings-sheet-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .settings-sheet {
      background: white;
      border-radius: 20px 20px 0 0;
      width: 100%;
      max-height: 70%;
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .settings-sheet-overlay.show .settings-sheet {
      transform: translateY(0);
    }

    .settings-sheet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: white;
      border-radius: 20px 20px 0 0;
      border-bottom: 1px solid #F0F0F0;
      flex-shrink: 0;
    }

    .settings-sheet-content {
      padding: 16px 20px 20px;
      overflow-y: auto;
      flex: 1;
    }

    .settings-sheet-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }

    .settings-sheet-close {
      background: rgba(0,0,0,0.1);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      color: #666;
    }

    .settings-sheet-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* ============ Today XP Detail Sheet ============ */
    .xp-detail-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 350;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .xp-detail-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .xp-detail-sheet {
      background: white;
      border-radius: 20px 20px 0 0;
      width: 100%;
      max-height: 55%;
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .xp-detail-overlay.show .xp-detail-sheet {
      transform: translateY(0);
    }

    .xp-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px 10px;
      border-bottom: 1px solid #F0F0F0;
      flex-shrink: 0;
    }
    .xp-detail-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 16px;
      font-weight: 700;
      color: #333;
    }
    .xp-detail-close {
      background: rgba(0,0,0,0.08);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      color: #666;
    }

    .xp-detail-content {
      padding: 12px 16px 16px;
      overflow-y: auto;
      flex: 1;
    }

    .xp-detail-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .xp-detail-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      background: #F9FAFB;
      border-radius: 10px;
    }
    .xp-detail-item-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    .xp-detail-item-icon.photo { background: linear-gradient(135deg, #DBEAFE, #BFDBFE); }
    .xp-detail-item-icon.species { background: linear-gradient(135deg, #D1FAE5, #A7F3D0); }
    .xp-detail-item-icon.task { background: linear-gradient(135deg, #FEF3C7, #FDE68A); }
    .xp-detail-item-icon.streak { background: linear-gradient(135deg, #FEE2E2, #FECACA); }
    .xp-detail-item-icon.art { background: linear-gradient(135deg, #E9D5FF, #D8B4FE); }

    .xp-detail-item-info {
      flex: 1;
      min-width: 0;
    }
    .xp-detail-item-action {
      font-size: 13px;
      font-weight: 600;
      color: #333;
    }
    .xp-detail-item-desc {
      font-size: 11px;
      color: #888;
      margin-top: 1px;
    }
    .xp-detail-item-value {
      font-size: 14px;
      font-weight: 700;
      color: #22C55E;
      flex-shrink: 0;
    }

    .xp-detail-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      padding: 10px 14px;
      background: linear-gradient(135deg, #22C55E, #16A34A);
      border-radius: 12px;
      color: white;
    }
    .xp-detail-total-label {
      font-size: 14px;
      font-weight: 600;
    }
    .xp-detail-total-value {
      font-size: 18px;
      font-weight: 800;
    }

    .xp-detail-tip {
      margin-top: 10px;
      padding: 10px 12px;
      background: #F0F9FF;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .xp-detail-tip-icon {
      font-size: 16px;
    }
    .xp-detail-tip-text {
      font-size: 12px;
      color: #0369A1;
      line-height: 1.3;
    }

    .today-xp {
      cursor: pointer;
      transition: transform 0.15s;
    }
    .today-xp:active {
      transform: scale(0.95);
    }

    .sheet-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: #F9FAFB;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .sheet-option:active {
      transform: scale(0.98);
    }
    .sheet-option.selected {
      background: linear-gradient(135deg, #FFF8E7 0%, #FEF3C7 100%);
      box-shadow: 0 0 0 2px #F59E0B;
    }
    .sheet-option.locked {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .option-icon {
      font-size: 28px;
    }

    .option-info {
      flex: 1;
    }

    .option-name {
      font-size: 15px;
      font-weight: 600;
      color: #333;
    }

    .option-desc {
      font-size: 12px;
      color: #888;
      margin-top: 1px;
    }

    .option-check {
      font-size: 16px;
      color: #F59E0B;
      font-weight: 700;
      opacity: 0;
    }
    .sheet-option.selected .option-check {
      opacity: 1;
    }

    .option-lock {
      font-size: 11px;
      color: #999;
      background: #E5E7EB;
      padding: 4px 8px;
      border-radius: 8px;
    }

    /* ============ Wi-Fi设置页 ============ */
    .wifi-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
      overflow-y: auto;
    }

    .wifi-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    .wifi-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 700;
      color: white;
      margin-bottom: 16px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .wifi-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .wifi-toggle-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .wifi-toggle-label {
      font-size: 15px;
      font-weight: 600;
      color: #333;
    }

    .wifi-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .wifi-section-title {
      font-size: 12px;
      font-weight: 600;
      color: rgba(255,255,255,0.8);
      padding-left: 4px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .wifi-network-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    .wifi-network-card:active {
      transform: scale(0.98);
    }
    .wifi-network-card.connected {
      background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
    }

    .wifi-network-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .wifi-network-name {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .wifi-network-status {
      font-size: 11px;
      color: #059669;
      font-weight: 500;
    }

    .wifi-network-icons {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .wifi-lock {
      font-size: 12px;
      opacity: 0.6;
    }

    .wifi-signal {
      font-size: 16px;
    }
    .wifi-signal.full { opacity: 1; }
    .wifi-signal.medium { opacity: 0.7; }
    .wifi-signal.weak { opacity: 0.4; }

    .wifi-network-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Wi-Fi密码弹窗 */
    .wifi-password-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 350;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .wifi-password-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .wifi-password-modal {
      background: white;
      border-radius: 20px;
      width: 85%;
      max-width: 320px;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.25s;
    }
    .wifi-password-overlay.show .wifi-password-modal {
      transform: scale(1);
    }

    .wifi-password-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #F0F0F0;
    }

    .wifi-password-title {
      font-size: 16px;
      font-weight: 700;
      color: #333;
    }

    .wifi-password-close {
      background: rgba(0,0,0,0.08);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      color: #666;
    }

    .wifi-password-content {
      padding: 20px;
    }

    .wifi-password-input-group {
      margin-bottom: 16px;
    }

    .wifi-password-input-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      margin-bottom: 8px;
    }

    .wifi-password-input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #E5E7EB;
      border-radius: 10px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    .wifi-password-input:focus {
      outline: none;
      border-color: #3B82F6;
    }

    .wifi-connect-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    .wifi-connect-btn:active {
      transform: scale(0.98);
    }

    /* ============ About Device页 ============ */
    .about-device-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
    }

    .about-device-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    .about-device-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 700;
      color: white;
      margin-bottom: 16px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .about-device-content {
      flex: 1;
    }

    .about-device-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 4px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .about-device-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 18px;
      border-bottom: 1px solid #F0F0F0;
    }
    .about-device-row:last-child {
      border-bottom: none;
    }

    .about-device-label {
      font-size: 14px;
      color: #666;
    }

    .about-device-value {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      text-align: right;
      max-width: 60%;
      word-break: break-all;
    }

    /* ============ System Update页 ============ */
    .system-update-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 56px 24px 16px;
      position: relative;
    }

    .system-update-back-btn {
      position: absolute;
      top: 14px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 20;
    }

    .system-update-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 700;
      color: white;
      margin-bottom: 24px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .system-update-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .update-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .system-update-icon {
      font-size: 64px;
      margin-bottom: 8px;
    }

    .system-update-status {
      font-size: 18px;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .system-update-version {
      font-size: 13px;
      color: rgba(255,255,255,0.8);
    }

    /* 检查动画 */
    .update-spinner {
      position: relative;
      width: 80px;
      height: 80px;
      margin-bottom: 8px;
    }

    .spinner-ring {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 4px solid rgba(255,255,255,0.2);
      border-top-color: #3B82F6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .spinner-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.7; transform: translate(-50%, -50%) scale(0.9); }
    }

    /* 有更新可用 */
    .update-available-icon {
      font-size: 64px;
      margin-bottom: 8px;
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .update-changelog {
      margin-top: 12px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      backdrop-filter: blur(8px);
    }

    .changelog-title {
      font-size: 12px;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      margin-bottom: 8px;
    }

    .changelog-item {
      font-size: 11px;
      color: rgba(255,255,255,0.8);
      line-height: 1.6;
    }

    .system-update-btn {
      margin-top: 24px;
      padding: 14px 32px;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: all 0.2s;
    }
    .system-update-btn:active {
      transform: scale(0.98);
    }
    .system-update-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .system-update-btn.update-now {
      background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
      color: white;
    }
  </style>
</head>
<body>

  <div class="prototype-container">
    <!-- 左侧页面列表 -->
    <div class="page-list">
      <div class="page-list-title">页面列表</div>
      
      <div class="page-list-item active" onclick="navigateTo('home-page')">
        <span class="icon">🏠</span>
        <span>主页</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('camera-page')">
        <span class="icon">📷</span>
        <span>相机</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('photo-preview-page')">
        <span class="icon">🖼️</span>
        <span>照片预览</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('chat-page')">
        <span class="icon">💬</span>
        <span>照片聊天</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('general-chat-page')">
        <span class="icon">🗣️</span>
        <span>通用聊天</span>
      </div>
      <div class="page-list-item" onclick="navigateTo('story-page')">
        <span class="icon">📖</span>
        <span>故事页</span>
      </div>
      
      <div class="page-list-section">
        <div class="page-list-section-title">探索</div>
        <div class="page-list-item" onclick="navigateTo('map-page')">
          <span class="icon">🗺️</span>
          <span>地图</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('workshop-page')">
          <span class="icon">🎨</span>
          <span>工坊</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('photo-effect-page')">
          <span class="icon">✨</span>
          <span>风格选择</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('workshop-photo-page')">
          <span class="icon">📷</span>
          <span>工坊选图</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('aigc-result-page')">
          <span class="icon">🖼️</span>
          <span>生成结果</span>
        </div>
      </div>
      
      <div class="page-list-section">
        <div class="page-list-section-title">收藏</div>
        <div class="page-list-item" onclick="navigateTo('explorer-page')">
          <span class="icon">🧭</span>
          <span>探险家</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('level-guide-page')">
          <span class="icon">📈</span>
          <span>升级指南</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('backpack-page')">
          <span class="icon">🎒</span>
          <span>背包</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('species-list-page')">
          <span class="icon">📖</span>
          <span>图鉴</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('settings-page')">
          <span class="icon">⚙️</span>
          <span>设置</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('wifi-page')" style="padding-left: 28px;">
          <span class="icon">📶</span>
          <span>Wi-Fi</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('about-device-page')" style="padding-left: 28px;">
          <span class="icon">ℹ️</span>
          <span>关于本机</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('system-update-page')" style="padding-left: 28px;">
          <span class="icon">🔄</span>
          <span>系统更新</span>
        </div>
        <div class="page-list-item" onclick="navigateTo('notifications-page')">
          <span class="icon">🔔</span>
          <span>通知</span>
        </div>
      </div>

      <div class="page-list-section">
        <div class="page-list-section-title">🎉 激励反馈演示</div>
        <div class="page-list-item demo-item" onclick="demoXP()">
          <span class="icon">✨</span>
          <span>经验值 +15 XP</span>
        </div>
        <div class="page-list-item demo-item" onclick="demoLevelUp()">
          <span class="icon">⭐</span>
          <span>升级弹窗</span>
        </div>
        <div class="page-list-item demo-item" onclick="demoBadge()">
          <span class="icon">🏆</span>
          <span>徽章解锁</span>
        </div>
        <div class="page-list-item demo-item" onclick="demoSequence()">
          <span class="icon">🎬</span>
          <span>完整流程演示</span>
        </div>
      </div>

      <div class="page-list-section">
        <div class="page-list-section-title">📭 空状态预览</div>
        <div class="page-list-item" style="padding: 8px 12px;">
          <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; width: 100%;">
            <input type="checkbox" id="empty-state-toggle" onchange="toggleEmptyState()" style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 13px;">启用空状态</span>
          </label>
        </div>
        <div style="font-size: 11px; color: #888; padding: 4px 12px; line-height: 1.4;">
          开启后，AI菜单卡片将显示空状态版本
        </div>
      </div>
    </div>

    <!-- 设备+按钮固定区域 -->
    <div class="device-area">
    <!-- 中间设备屏幕 -->
    <div class="device-frame">
      <div class="device-screen">
        <!-- 天空背景 -->
        <div class="sky-bg">
          <div class="cloud cloud-1"></div>
          <div class="cloud cloud-2"></div>
          <div class="cloud cloud-3"></div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar">
          <div class="status-left"><span>10:30</span></div>
          <div class="status-right">
            <span>📶</span>
            <span>87%</span>
            <span>🔋</span>
          </div>
        </div>

        <!-- ========== Home 页面 ========== -->
        <div id="home-page" class="page active">
          <!-- 通知铃铛 - 有未读消息时显示 -->
          <div class="home-notification-bell" id="home-notification-bell" onclick="navigateTo('notifications-page')">
            <span>🔔</span>
            <div class="notification-dot"></div>
          </div>

          <div class="carousel-container" id="carousel">
            <div class="card" data-page="settings-page" onclick="handleCardClick(0)">
              <div class="card-icon"><img src="icons/Settings.png" alt="Settings"></div>
              <div class="card-label">Settings</div>
            </div>
            <div class="card" data-page="camera-page" onclick="handleCardClick(1)">
              <div class="card-icon"><img src="icons/Camera.png" alt="Camera"></div>
              <div class="card-label">Camera</div>
            </div>
            <div class="card" data-page="map-page" onclick="handleCardClick(2)">
              <div class="card-icon"><img src="icons/Map.png" alt="Map"></div>
              <div class="card-label">Map</div>
            </div>
            <div class="card" data-page="workshop-page" onclick="handleCardClick(3)">
              <div class="card-icon"><img src="icons/Workshop.png" alt="Workshop"></div>
              <div class="card-label">Workshop</div>
            </div>
            <div class="card" data-page="backpack-page" onclick="handleCardClick(4)">
              <div class="card-icon"><img src="icons/Backpack.png" alt="Backpack"></div>
              <div class="card-label">Backpack</div>
            </div>
            <div class="card" data-page="explorer-page" onclick="handleCardClick(5)">
              <div class="card-icon"><img src="icons/Explorer.png" alt="Explorer"></div>
              <div class="card-label">Explorer</div>
            </div>
          </div>
        </div>

        <!-- ========== Camera 相机页 ========== -->
        <div id="camera-page" class="page">
          <div class="camera-container">
            <!-- 复古取景框四角 -->
            <div class="viewfinder-corner top-left"></div>
            <div class="viewfinder-corner top-right"></div>
            <div class="viewfinder-corner bottom-left"></div>
            <div class="viewfinder-corner bottom-right"></div>
            
            <!-- 顶部工具栏 - 只有返回和提示 -->
            <div class="camera-top-bar">
              <button class="camera-back-btn" onclick="navigateTo('home-page')">
                <span>←</span>
                <span>Back</span>
              </button>
              
              <div class="camera-hint">
                <span>🎯</span>
                <span>Point at something!</span>
              </div>
              
              <div style="width: 70px;"></div>
            </div>
            
            <!-- 左下角相册 -->
            <button class="camera-gallery-btn" onclick="openGallery()">🖼️</button>
            
            <!-- 底部居中工具栏 -->
            <div class="camera-bottom-bar">
              <button class="camera-tool-bottom" id="flash-btn" onclick="toggleFlash()">âš¡</button>
              <button class="camera-tool-bottom" id="zoom-btn" onclick="toggleZoom()"><span id="zoom-label">1×</span></button>
              <button class="camera-tool-bottom" id="grid-btn" onclick="toggleGrid()">⊞</button>
            </div>
            
            <!-- 右侧快门按钮 -->
            <div class="camera-shutter-area">
              <button class="shutter-btn" onclick="takePhoto()">
                <div class="shutter-btn-outer">
                  <div class="shutter-btn-inner"></div>
                </div>
              </button>
            </div>
            
            <!-- 闪光效果 -->
            <div class="camera-flash" id="camera-flash"></div>
          </div>
        </div>

        <!-- ========== Photo Preview 照片预览页 ========== -->
        <div id="photo-preview-page" class="page page-blur-bg">
          <div class="preview-container">
            <!-- 返回按钮 -->
            <button class="preview-back-btn" onclick="navigateTo('camera-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 分享按钮 -->
            <button class="preview-share-btn" onclick="showShareModal()">
              <span>📤</span>
              <span>Share</span>
            </button>

            <!-- 全屏照片 -->
            <img class="preview-photo-fullscreen" src="https://picsum.photos/800/480?random=10" alt="Photo">

            <!-- AI提示 -->
            <div class="preview-ai-hint">✨ Press AI to explore</div>
          </div>
        </div>

        <!-- ========== Chat 照片聊天页 ========== -->
        <div id="chat-page" class="page page-blur-bg">
          <div class="chat-container">
            <!-- 返回按钮 -->
            <button class="chat-back-btn" onclick="navigateTo('photo-preview-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 左侧照片 -->
            <div class="chat-photo-section">
              <div class="chat-photo-card">
                <div class="chat-tape top"></div>
                <div class="chat-tape bottom-right"></div>
                <img src="https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=300&h=225&fit=crop" alt="Photo">
                <div class="chat-photo-label">My discovery ✨</div>
              </div>
            </div>

            <!-- 右侧对话 -->
            <div class="chat-conversation-section">
              <div class="chat-messages">
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Wow, look at this! I can see a beautiful ladybug. Do you know why they have spots? 🐞</div>
                </div>
                <div class="chat-message user">
                  <div class="chat-avatar user-avatar">👦</div>
                  <div class="chat-bubble">They are red and black!</div>
                </div>
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Great observation! The bright colors warn birds: "Don't eat me, I taste yucky!" 🙅‍♂️</div>
                </div>
                <div class="chat-message user">
                  <div class="chat-avatar user-avatar">👦</div>
                  <div class="chat-bubble">That's so cool!</div>
                </div>
                <div class="chat-message ai">
                  <div class="chat-avatar ai-avatar">🤖</div>
                  <div class="chat-bubble">Did you know ladybugs can eat up to 50 tiny bugs called aphids every day? They're like tiny garden superheroes! 🦸</div>
                </div>
              </div>

              <!-- 底部输入 -->
              <div class="chat-input-area">
                <button class="chat-speak-btn" id="chat-speak-btn" onmousedown="startChatRecording('chat')" onmouseup="stopChatRecording('chat')" ontouchstart="startChatRecording('chat')" ontouchend="stopChatRecording('chat')">
                  <span class="chat-speak-icon">🎤</span>
                  <span class="chat-speak-text">Hold to Speak</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== General Chat 通用聊天页 ========== -->
        <div id="general-chat-page" class="page page-blur-bg">
          <div class="general-chat-container">
            <!-- 返回按钮 -->
            <button class="general-chat-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 消息列表 -->
            <div class="general-chat-messages">
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Hi there, little explorer! 👋 What would you like to discover today?</div>
              </div>
              <div class="chat-message user">
                <div class="chat-avatar user-avatar">👦</div>
                <div class="chat-bubble">Tell me about butterflies!</div>
              </div>
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Butterflies are amazing! 🦋 They start as tiny caterpillars, then wrap themselves in a cozy cocoon, and come out with beautiful wings!</div>
              </div>
              <div class="chat-message user">
                <div class="chat-avatar user-avatar">👦</div>
                <div class="chat-bubble">How do they fly?</div>
              </div>
              <div class="chat-message ai">
                <div class="chat-avatar ai-avatar">🤖</div>
                <div class="chat-bubble">Great question! Their wings are covered with tiny scales that catch the air. They flap about 5-12 times per second - much slower than bees! That's why they look so graceful. 🌸</div>
              </div>
            </div>

            <!-- 底部输入 -->
            <div class="general-chat-input-area">
              <button class="general-chat-speak-btn" id="general-chat-speak-btn" onmousedown="startChatRecording('general')" onmouseup="stopChatRecording('general')" ontouchstart="startChatRecording('general')" ontouchend="stopChatRecording('general')">
                <span class="chat-speak-icon">🎤</span>
                <span class="chat-speak-text">Hold to Speak</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ========== Map 地图页 ========== -->
        <div id="map-page" class="page">
          <div class="map-container">
            <div class="map-texture"></div>

            <!-- 返回按钮 -->
            <button class="map-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 任务徽章 -->
            <div class="map-task-badge">
              <div class="task-dot"></div>
              <span>3 Tasks Nearby</span>
            </div>

            <!-- 装饰路径 -->
            <div class="map-path" style="width: 180px; height: 120px; top: 160px; left: 200px;"></div>
            <div class="map-path" style="width: 140px; height: 100px; top: 220px; left: 380px;"></div>

            <!-- 地图标记点 -->
            <div class="map-pin" style="left: 100px; top: 180px;" onclick="showTaskModal('flower')">
              <div class="pin-label">🌸 Find a Flower</div>
              <div class="pin-marker red">🌸</div>
              <div class="pin-status active">!</div>
            </div>

            <div class="map-pin" style="left: 300px; top: 260px;" onclick="showTaskModal('butterfly')">
              <div class="pin-label">🦋 Spot a Butterfly</div>
              <div class="pin-marker gold">🦋</div>
            </div>

            <div class="map-pin" style="left: 500px; top: 150px;" onclick="showTaskModal('rock')">
              <div class="pin-label">🪨 Cool Rock Hunt</div>
              <div class="pin-marker green">✓</div>
              <div class="pin-status done">✓</div>
            </div>

            <div class="map-pin" style="left: 420px; top: 340px;" onclick="showTaskModal('leaf')">
              <div class="pin-label">🍂 Collect Leaves</div>
              <div class="pin-marker blue">🍂</div>
            </div>

            <!-- 指南针 -->
            <div class="map-compass">
              <span class="compass-arrow">N ↑</span>
            </div>

            <!-- 任务弹窗 -->
            <div class="task-modal-overlay" id="task-modal-overlay" onclick="hideTaskModal()">
              <div class="task-modal" onclick="event.stopPropagation()">
                <div class="task-modal-header">
                  <div class="task-modal-icon" id="task-modal-icon" style="background: linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%);">🌸</div>
                  <div>
                    <div class="task-modal-title" id="task-modal-title">Find a Flower</div>
                    <div class="task-modal-difficulty">⭐ Easy • 5 min</div>
                  </div>
                </div>
                <div class="task-modal-desc" id="task-modal-desc">
                  Look around for any beautiful flowers! Take a photo when you find one. Can you spot different colors? 🌈
                </div>
                <div class="task-modal-reward">
                  <span>🏆</span>
                  <span>Reward: +10 XP & Flower Badge</span>
                </div>
                <div class="task-modal-actions">
                  <button class="task-btn task-btn-decline" onclick="hideTaskModal()">Maybe Later</button>
                  <button class="task-btn task-btn-accept" onclick="acceptTask()">Let's Go! 🚀</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Story Page 故事页 ========== -->
        <div id="story-page" class="page page-blur-bg">
          <div class="story-page-container" style="height: 100%; display: flex; flex-direction: column; padding: 16px;">
            <!-- 头部 -->
            <div style="position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 12px; height: 44px;">
              <button class="workshop-back-btn" style="position: absolute; left: 0;" onclick="navigateTo('chat-page')">
                <span>←</span>
                <span>Back</span>
              </button>
              <div style="text-align: center;">
                <div style="font-size: 16px; font-weight: 700; color: #333;">My Ladybug Adventure</div>
                <div style="font-size: 11px; color: #888;">🦸 Adventure Story</div>
              </div>
              <button onclick="saveStory()" style="position: absolute; right: 0; background: rgba(0,0,0,0.5); border: none; border-radius: 12px; padding: 8px 12px; font-size: 13px; color: white; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                <span>💾</span>
                <span>Save</span>
              </button>
            </div>
            
            <!-- 故事书内容区 -->
            <div style="flex: 1; background: rgba(255,255,255,0.95); border-radius: 16px; display: flex; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
              <!-- 左侧图片 -->
              <div style="width: 50%; background: linear-gradient(135deg, #fef3c7, #fde68a); display: flex; align-items: center; justify-content: center; position: relative;">
                <span style="font-size: 80px;" id="story-image">🐞</span>
                <!-- 页面装饰 -->
                <div style="position: absolute; bottom: 12px; left: 12px; font-size: 10px; color: rgba(0,0,0,0.3);">Page <span id="story-page-num">1</span></div>
              </div>
              <!-- 右侧文字 -->
              <div style="width: 50%; padding: 20px; display: flex; flex-direction: column; justify-content: center; border-left: 1px solid #eee;">
                <div id="story-text" style="font-size: 14px; line-height: 1.7; color: #333;">
                  Once upon a time, in a sunny garden filled with colorful flowers, there lived a tiny ladybug named Ruby. 🐞
                </div>
              </div>
            </div>
            
            <!-- 底部控制区 -->
            <div style="margin-top: 12px;">
              <!-- 页码指示 -->
              <div style="display: flex; justify-content: center; gap: 6px; margin-bottom: 10px;" id="story-dots">
                <div style="width: 8px; height: 8px; border-radius: 50%; background: #6366F1;"></div>
                <div style="width: 8px; height: 8px; border-radius: 50%; background: #ddd;"></div>
                <div style="width: 8px; height: 8px; border-radius: 50%; background: #ddd;"></div>
                <div style="width: 8px; height: 8px; border-radius: 50%; background: #ddd;"></div>
                <div style="width: 8px; height: 8px; border-radius: 50%; background: #ddd;"></div>
              </div>
              <!-- 三按钮控制栏 -->
              <div style="display: flex; justify-content: center; align-items: center; gap: 12px;">
                <button onclick="storyPrevPage()" id="story-prev-btn" style="width: 100px; background: rgba(255,255,255,0.9); border: none; border-radius: 12px; padding: 12px 16px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); opacity: 0.5;" disabled>
                  <span>←</span>
                  <span>Prev</span>
                </button>
                <button onclick="toggleStoryAudio()" id="story-audio-btn" style="width: 56px; height: 56px; background: linear-gradient(135deg, #F59E0B, #D97706); border: none; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(245,158,11,0.3); transition: all 0.2s;">
                  🔊
                </button>
                <button onclick="storyNextPage()" id="story-next-btn" style="width: 100px; background: linear-gradient(135deg, #6366F1, #8B5CF6); color: white; border: none; border-radius: 12px; padding: 12px 16px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 4px 12px rgba(99,102,241,0.3);">
                  <span>Next</span>
                  <span>→</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Workshop 工坊入口页 ========== -->
        <div id="workshop-page" class="page page-blur-bg">
          <div class="workshop-container">
            <button class="workshop-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 风格卡片 - 可横向滑动,一页3张 -->
            <div class="style-cards-container">
              <div class="style-card" onclick="selectStyle('Ghibli', '🏔️')">
                <div class="style-preview style-ghibli">🏔️</div>
                <div class="style-info">
                  <div class="style-name">Ghibli</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Pixel Art', '👾')">
                <div class="style-preview style-pixel">👾</div>
                <div class="style-info">
                  <div class="style-name">Pixel Art</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Watercolor', '🎨')">
                <div class="style-preview style-watercolor">🎨</div>
                <div class="style-info">
                  <div class="style-name">Watercolor</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
              <div class="style-card" onclick="selectStyle('Cartoon', '🎬')">
                <div class="style-preview style-cartoon">🎬</div>
                <div class="style-info">
                  <div class="style-name">Cartoon</div>
                  <button class="style-try-btn">Try This →</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Photo Effect 风格选择页 ========== -->
        <div id="photo-effect-page" class="page page-blur-bg">
          <div class="effect-container">
            <button class="effect-back-btn" onclick="navigateTo('photo-preview-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 已选照片缩略图 -->
            <div class="effect-selected-photo">
              <div class="effect-photo-thumb">
                <img src="https://picsum.photos/100/100?random=3" alt="Selected">
              </div>
              <span class="effect-photo-label">Your Photo</span>
            </div>

            <!-- 风格选择 - 可滑动,一页3张 -->
            <div class="effect-cards-scroll">
              <div class="effect-card selected" onclick="selectEffectCard(this, 'Ghibli', '🏔️')">
                <div class="effect-card-preview style-ghibli">🏔️</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Ghibli</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Pixel Art', '👾')">
                <div class="effect-card-preview style-pixel">👾</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Pixel Art</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Watercolor', '🎨')">
                <div class="effect-card-preview style-watercolor">🎨</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Watercolor</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Cartoon', '🎬')">
                <div class="effect-card-preview style-cartoon">🎬</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Cartoon</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
              <div class="effect-card" onclick="selectEffectCard(this, 'Sketch', '✏️')">
                <div class="effect-card-preview" style="background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);">✏️</div>
                <div class="effect-card-info">
                  <div class="effect-card-name">Sketch</div>
                  <button class="effect-try-btn">Try This →</button>
                </div>
              </div>
            </div>

            <!-- 底部AIGC条款 -->
            <div class="effect-footer">
              <label class="aigc-agreement">
                <input type="checkbox" checked id="effect-agree-checkbox">
                <span>I agree to AI creation terms</span>
              </label>
            </div>
          </div>
        </div>

        <!-- ========== Workshop Photo 选图页 ========== -->
        <div id="workshop-photo-page" class="page page-blur-bg">
          <div class="photo-select-container">
            <button class="photo-select-back-btn" onclick="navigateTo('workshop-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 已选风格 -->
            <div class="selected-style-banner">
              <div class="style-badge" id="workshop-style-badge">
                <span id="workshop-style-icon">🏔️</span>
                <span id="workshop-style-name">Ghibli</span>
              </div>
              <span class="style-badge-hint">Choose a photo to transform</span>
            </div>

            <!-- 照片网格 -->
            <div class="photo-select-grid">
              <div class="photo-select-item take-new" onclick="navigateTo('camera-page')">
                <span>📸</span>
                <span class="take-new-label">Take New</span>
              </div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🌻</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🦎</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🪨</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🍂</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🐛</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🦋</div>
              <div class="photo-select-item" onclick="selectPhotoItem(this)">🌺</div>
            </div>

            <!-- 底部 -->
            <div class="photo-select-footer">
              <label class="aigc-agreement">
                <input type="checkbox" checked id="workshop-agree-checkbox" onchange="updateCreateBtn()">
                <span>I agree to AI creation terms</span>
              </label>
              <button class="create-btn" id="workshop-create-btn" disabled onclick="startWorkshopCreation()">✨ Start Creating</button>
            </div>
          </div>
        </div>

        <!-- ========== AIGC Result 生成结果页 ========== -->
        <div id="aigc-result-page" class="page">
          <div class="aigc-result-container">
            <!-- 返回按钮 -->
            <button class="aigc-result-back-btn" onclick="navigateTo('workshop-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 全屏图片展示 -->
            <div class="aigc-result-image-container">
              <img id="aigc-result-img" class="aigc-result-fullimg" src="https://picsum.photos/800/600?random=1" alt="Generated">
              <img id="aigc-original-img" class="aigc-original-fullimg" src="https://picsum.photos/800/600?random=2" alt="Original">
            </div>

            <!-- 风格标签 -->
            <div class="aigc-result-style-tag" id="aigc-result-style-tag">
              <span>🏔️</span>
              <span>Ghibli Style</span>
            </div>

            <!-- 底部操作栏 -->
            <div class="aigc-result-actions-bar">
              <button class="aigc-action-btn compare" onmousedown="showOriginal()" onmouseup="hideOriginal()" ontouchstart="showOriginal()" ontouchend="hideOriginal()">
                <span>🔄</span>
                <span>Compare</span>
              </button>
              <button class="aigc-action-btn save" onclick="saveAigcToGallery()">
                <span>💾</span>
                <span>Save</span>
              </button>
              <button class="aigc-action-btn share" onclick="showShareModal()">
                <span>📤</span>
                <span>Share</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ========== Backpack 背包页 ========== -->
        <div id="backpack-page" class="page page-blur-bg">
          <div class="backpack-container">
            <button class="backpack-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- Tab栏 -->
            <div class="backpack-tabs">
              <button class="backpack-tab active" onclick="switchBackpackTab('album', this)">📷 Album</button>
              <button class="backpack-tab" onclick="switchBackpackTab('guide', this)">🦋 Guide</button>
              <button class="backpack-tab" onclick="switchBackpackTab('badges', this)">🏅 Badges</button>
              <button class="backpack-tab" onclick="switchBackpackTab('stories', this)">📖 Stories</button>
            </div>

            <!-- 内容区 -->
            <div class="backpack-content">
              <!-- 相册 -->
              <div id="album-content">
                <!-- 筛选器 -->
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                  <button class="album-filter active" onclick="filterAlbum('all', this)">All</button>
                  <button class="album-filter" onclick="filterAlbum('photos', this)">📷 Photos</button>
                  <button class="album-filter" onclick="filterAlbum('artworks', this)">🎨 Artworks</button>
                </div>
                <div class="album-grid">
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🌻</div>
                  <div class="album-item artwork" onclick="navigateTo('photo-preview-page')" style="position: relative;">🌻<div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🏔️</div></div>
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🦎</div>
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🪨</div>
                  <div class="album-item artwork" onclick="navigateTo('photo-preview-page')" style="position: relative;">🦋<div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">👾</div></div>
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🍂</div>
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🐛</div>
                  <div class="album-item artwork" onclick="navigateTo('photo-preview-page')" style="position: relative;">🐞<div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🎨</div></div>
                  <div class="album-item photo" onclick="navigateTo('photo-preview-page')">🦋</div>
                </div>
              </div>

              <!-- 故事 -->
              <div id="stories-content" style="display: none;">
                <div class="stories-grid">
                  <div class="story-card" onclick="navigateTo('story-page')">
                    <div class="story-card-cover" style="background: linear-gradient(135deg, #fef3c7, #fde68a);">🐞</div>
                    <div class="story-card-info">
                      <div class="story-card-title">My Ladybug Adventure</div>
                      <div class="story-card-meta">🦸 Adventure · Dec 20</div>
                    </div>
                  </div>
                  <div class="story-card" onclick="navigateTo('story-page')">
                    <div class="story-card-cover" style="background: linear-gradient(135deg, #dbeafe, #bfdbfe);">🦋</div>
                    <div class="story-card-info">
                      <div class="story-card-title">Butterfly Dreams</div>
                      <div class="story-card-meta">😴 Bedtime · Dec 18</div>
                    </div>
                  </div>
                  <div class="story-card" onclick="navigateTo('story-page')">
                    <div class="story-card-cover" style="background: linear-gradient(135deg, #d1fae5, #a7f3d0);">🐸</div>
                    <div class="story-card-info">
                      <div class="story-card-title">The Silly Frog</div>
                      <div class="story-card-meta">😂 Funny · Dec 15</div>
                    </div>
                  </div>
                  <div class="story-card" onclick="navigateTo('story-page')">
                    <div class="story-card-cover" style="background: linear-gradient(135deg, #fce7f3, #fbcfe8);">🌸</div>
                    <div class="story-card-info">
                      <div class="story-card-title">Cherry Blossom Magic</div>
                      <div class="story-card-meta">🦸 Adventure · Dec 12</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 图鉴分类 -->
              <div class="guide-grid" id="guide-content" style="display: none;">
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🌸</div>
                  <div class="guide-name">Flowers</div>
                  <div class="guide-count">5 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🦋</div>
                  <div class="guide-name">Insects</div>
                  <div class="guide-count">3 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🪨</div>
                  <div class="guide-name">Rocks</div>
                  <div class="guide-count">2 types</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🍂</div>
                  <div class="guide-name">Leaves</div>
                  <div class="guide-count">4 types</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🐿️</div>
                  <div class="guide-name">Animals</div>
                  <div class="guide-count">1 species</div>
                </div>
                <div class="guide-item" onclick="navigateTo('species-list-page')">
                  <div class="guide-icon">🍄</div>
                  <div class="guide-name">Mushrooms</div>
                  <div class="guide-count">2 types</div>
                </div>
              </div>

              <!-- 徽章 -->
              <div class="badge-grid" id="badges-content" style="display: none;">
                <div class="badge-item">
                  <div class="badge-icon">⭐</div>
                  <div class="badge-name">First Discovery</div>
                </div>
                <div class="badge-item">
                  <div class="badge-icon">🏆</div>
                  <div class="badge-name">Explorer</div>
                </div>
                <div class="badge-item">
                  <div class="badge-icon">🎯</div>
                  <div class="badge-name">Sharp Eye</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">🔬</div>
                  <div class="badge-name">Scientist</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">🎨</div>
                  <div class="badge-name">Artist</div>
                </div>
                <div class="badge-item locked">
                  <div class="badge-icon">📚</div>
                  <div class="badge-name">Collector</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Species List 图鉴列表页 ========== -->
        <div id="species-list-page" class="page page-blur-bg">
          <div class="species-list-container">
            <button class="species-list-back-btn" onclick="navigateTo('backpack-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 头部 -->
            <div class="species-list-header">
              <div class="species-list-icon">🌸</div>
              <div>
                <div class="species-list-title">Flowers</div>
                <div class="species-list-count">5 species discovered</div>
              </div>
            </div>

            <!-- 物种网格 -->
            <div class="species-grid">
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌸</div>
                <div class="species-card-info">
                  <div class="species-card-name">Cherry Blossom</div>
                  <div class="species-card-date">May 15</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌻</div>
                <div class="species-card-info">
                  <div class="species-card-name">Sunflower</div>
                  <div class="species-card-date">May 20</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌺</div>
                <div class="species-card-info">
                  <div class="species-card-name">Hibiscus</div>
                  <div class="species-card-date">May 22</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌷</div>
                <div class="species-card-info">
                  <div class="species-card-name">Tulip</div>
                  <div class="species-card-date">May 25</div>
                </div>
              </div>
              <div class="species-card" onclick="navigateTo('species-detail-page')">
                <div class="species-card-img">🌼</div>
                <div class="species-card-info">
                  <div class="species-card-name">Daisy</div>
                  <div class="species-card-date">May 28</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Species Detail 图鉴详情页 ========== -->
        <div id="species-detail-page" class="page page-blur-bg">
          <div class="species-detail-container">
            <button class="species-detail-back-btn" onclick="navigateTo('species-list-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 左侧照片 -->
            <div class="species-detail-photo">
              <div class="species-photo-frame">
                <div class="species-photo-tape"></div>
                <img src="https://images.unsplash.com/photo-1522383225653-ed111181a951?w=300&h=225&fit=crop" alt="Cherry Blossom">
              </div>
            </div>

            <!-- 右侧信息 -->
            <div class="species-detail-info">
              <div class="species-info-card">
                <div class="species-info-header">
                  <div class="species-info-icon">🌸</div>
                  <div>
                    <div class="species-info-name">Cherry Blossom</div>
                    <div class="species-info-latin">Prunus serrulata</div>
                  </div>
                </div>
                <div class="species-fun-facts">
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🌍</div>
                    <div class="fun-fact-text">Cherry blossoms come from Japan, where they're called "Sakura"!</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">⏰</div>
                    <div class="fun-fact-text">Each flower only blooms for about 2 weeks!</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🍃</div>
                    <div class="fun-fact-text">The petals are edible! Japanese people make treats with them.</div>
                  </div>
                  <div class="fun-fact">
                    <div class="fun-fact-icon">🐝</div>
                    <div class="fun-fact-text">Bees love them because they're full of sweet nectar!</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Explorer 探险家中心页 ========== -->
        <div id="explorer-page" class="page page-blur-bg">
          <div class="explorer-container">
            <!-- 返回按钮 -->
            <button class="explorer-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <!-- 通知铃铛 - 固定入口 -->
            <button class="explorer-notification-btn" onclick="navigateTo('notifications-page')">
              <span>🔔</span>
              <div class="notification-dot" id="explorer-notification-dot"></div>
            </button>

            <!-- 探险家身份卡 -->
            <div class="explorer-identity-card">
              <div class="explorer-profile">
                <div class="explorer-avatar-large">
                  <div class="avatar-frame gold">
                    <span>🧒</span>
                  </div>
                  <div class="avatar-streak">🔥 7</div>
                </div>
                <div class="explorer-info">
                  <div class="explorer-title">Nature Detective</div>
                  <div class="explorer-name">Little Explorer</div>
                  <div class="explorer-level-info">
                    <span class="level-text">Level 5</span>
                    <span class="level-xp">1,280 / 1,800 XP</span>
                  </div>
                  <div class="xp-progress-bar">
                    <div class="xp-progress-fill" style="width: 71%;"></div>
                  </div>
                </div>
              </div>

              <!-- 今日XP获得 -->
              <div class="today-xp" onclick="showTodayXPDetail()">
                <span class="today-xp-label">Today</span>
                <span class="today-xp-value">+85 XP</span>
              </div>
            </div>

            <!-- 统计数据 -->
            <div class="explorer-stats">
              <div class="stat-item">
                <span class="stat-icon">📸</span>
                <span class="stat-value">128</span>
                <span class="stat-label">Photos</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">🦋</span>
                <span class="stat-value">23</span>
                <span class="stat-label">Species</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">🏆</span>
                <span class="stat-value">8</span>
                <span class="stat-label">Badges</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">✅</span>
                <span class="stat-value">15</span>
                <span class="stat-label">Tasks</span>
              </div>
            </div>

            <!-- 徽章展示 -->
            <div class="explorer-badges-section">
              <div class="section-header">
                <span class="section-title">🏅 Recent Badges</span>
                <button class="see-all-btn" onclick="navigateTo('backpack-page')">See All →</button>
              </div>
              <div class="badges-showcase">
                <div class="badge-item earned new">
                  <span class="badge-icon">🌸</span>
                  <span class="badge-name">Flower Expert</span>
                  <span class="badge-rarity rare">Rare</span>
                </div>
                <div class="badge-item earned">
                  <span class="badge-icon">📸</span>
                  <span class="badge-name">100 Photos</span>
                  <span class="badge-rarity common">Common</span>
                </div>
                <div class="badge-item earned">
                  <span class="badge-icon">🔥</span>
                  <span class="badge-name">7 Day Streak</span>
                  <span class="badge-rarity epic">Epic</span>
                </div>
                <div class="badge-item locked">
                  <span class="badge-icon">🦋</span>
                  <span class="badge-name">Bug Master</span>
                  <span class="badge-progress">12/20</span>
                </div>
              </div>
            </div>

            <!-- 下一个目标 -->
            <div class="next-goal-section">
              <div class="next-goal-card" onclick="navigateTo('level-guide-page')">
                <div class="goal-icon">🎯</div>
                <div class="goal-info">
                  <div class="goal-title">Next Goal: Level 6</div>
                  <div class="goal-desc">520 XP to unlock 🦊 Forest Fox AI</div>
                </div>
                <div class="goal-arrow">→</div>
              </div>
              
              <!-- 分享我的成就 -->
              <button class="explorer-share-card-btn" onclick="event.stopPropagation(); showShareModal('explorer')">
                <span>📤</span>
                <span>Share My Journey</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ========== Today XP Detail Sheet ========== -->
        <div class="xp-detail-overlay" id="xp-detail-overlay" onclick="hideTodayXPDetail()">
          <div class="xp-detail-sheet" onclick="event.stopPropagation()">
            <div class="xp-detail-header">
              <div class="xp-detail-title">
                <span>✨</span>
                <span>Today's XP</span>
              </div>
              <button class="xp-detail-close" onclick="hideTodayXPDetail()">✕</button>
            </div>
            <div class="xp-detail-content">
              <div class="xp-detail-list">
                <div class="xp-detail-item">
                  <div class="xp-detail-item-icon photo">📸</div>
                  <div class="xp-detail-item-info">
                    <div class="xp-detail-item-action">Took 3 photos</div>
                    <div class="xp-detail-item-desc">2 XP each</div>
                  </div>
                  <div class="xp-detail-item-value">+6 XP</div>
                </div>
                <div class="xp-detail-item">
                  <div class="xp-detail-item-icon species">🦋</div>
                  <div class="xp-detail-item-info">
                    <div class="xp-detail-item-action">Found 2 new species</div>
                    <div class="xp-detail-item-desc">Butterfly, Dragonfly</div>
                  </div>
                  <div class="xp-detail-item-value">+30 XP</div>
                </div>
                <div class="xp-detail-item">
                  <div class="xp-detail-item-icon task">⭐</div>
                  <div class="xp-detail-item-info">
                    <div class="xp-detail-item-action">Completed 2 tasks</div>
                    <div class="xp-detail-item-desc">Find a flower, Spot insect</div>
                  </div>
                  <div class="xp-detail-item-value">+35 XP</div>
                </div>
                <div class="xp-detail-item">
                  <div class="xp-detail-item-icon streak">🔥</div>
                  <div class="xp-detail-item-info">
                    <div class="xp-detail-item-action">Daily streak bonus</div>
                    <div class="xp-detail-item-desc">7 days in a row!</div>
                  </div>
                  <div class="xp-detail-item-value">+10 XP</div>
                </div>
                <div class="xp-detail-item">
                  <div class="xp-detail-item-icon art">🎨</div>
                  <div class="xp-detail-item-info">
                    <div class="xp-detail-item-action">Created 1 artwork</div>
                    <div class="xp-detail-item-desc">Ghibli style</div>
                  </div>
                  <div class="xp-detail-item-value">+4 XP</div>
                </div>
              </div>
              
              <div class="xp-detail-total">
                <span class="xp-detail-total-label">Total Today</span>
                <span class="xp-detail-total-value">+85 XP</span>
              </div>
              
              <div class="xp-detail-tip">
                <span class="xp-detail-tip-icon">💡</span>
                <span class="xp-detail-tip-text">Keep exploring! You're 520 XP away from Level 6!</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Level Guide 升级指南页 ========== -->
        <div id="level-guide-page" class="page page-blur-bg">
          <div class="level-guide-container">
            <!-- 返回按钮 -->
            <button class="level-guide-back-btn" onclick="navigateTo('explorer-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <div class="level-guide-title">🗺️ Level Guide</div>

            <!-- 等级进度线 -->
            <div class="level-timeline">
              <div class="timeline-track">
                <div class="timeline-progress" style="width: 44%;"></div>
              </div>
              <div class="timeline-nodes">
                <div class="timeline-node completed"><span class="node-level">1</span></div>
                <div class="timeline-node completed"><span class="node-level">2</span></div>
                <div class="timeline-node completed"><span class="node-level">3</span></div>
                <div class="timeline-node completed"><span class="node-level">4</span></div>
                <div class="timeline-node current">
                  <span class="node-level">5</span>
                  <span class="node-you">YOU</span>
                </div>
                <div class="timeline-node"><span class="node-level">6</span></div>
                <div class="timeline-node"><span class="node-level">7</span></div>
                <div class="timeline-node"><span class="node-level">8</span></div>
                <div class="timeline-node"><span class="node-level">9</span></div>
                <div class="timeline-node legendary-node"><span class="node-level">👑</span></div>
              </div>
            </div>

            <!-- 等级列表 -->
            <div class="level-list">
              <div class="level-card completed">
                <div class="level-header">
                  <span class="level-num">Lv.1</span>
                  <span class="level-name">Junior Explorer</span>
                  <span class="level-status">✓</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag feature">📷 Camera</span>
                    <span class="unlock-tag feature">🔍 AI Recognition</span>
                    <span class="unlock-tag feature">📖 Field Guide</span>
                  </div>
                </div>
              </div>

              <div class="level-card completed">
                <div class="level-header">
                  <span class="level-num">Lv.2</span>
                  <span class="level-name">Curious Kid</span>
                  <span class="level-status">✓</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag frame">🖼️ Bronze Frame</span>
                    <span class="unlock-tag ai">🤖 Robot Buddy</span>
                  </div>
                </div>
              </div>

              <div class="level-card completed">
                <div class="level-header">
                  <span class="level-num">Lv.3</span>
                  <span class="level-name">Observer</span>
                  <span class="level-status">✓</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag ai">🧙 Wise Sprite</span>
                    <span class="unlock-tag style">🎨 Cartoon Style</span>
                    <span class="unlock-tag title">🏷️ "Nature Lover"</span>
                  </div>
                </div>
              </div>

              <div class="level-card completed">
                <div class="level-header">
                  <span class="level-num">Lv.4</span>
                  <span class="level-name">Apprentice</span>
                  <span class="level-status">✓</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag style">💧 Watercolor</span>
                    <span class="unlock-tag style">🖍️ Crayon</span>
                    <span class="unlock-tag feature">🗺️ Map Tasks</span>
                  </div>
                </div>
              </div>

              <div class="level-card current">
                <div class="level-header">
                  <span class="level-num">Lv.5</span>
                  <span class="level-name">Nature Detective</span>
                  <span class="level-status current-badge">NOW</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag frame">🖼️ Silver Frame</span>
                    <span class="unlock-tag title">🏷️ Title Display</span>
                    <span class="unlock-tag ai">🦉 Wise Owl</span>
                    <span class="unlock-tag feature">📊 Weekly Report</span>
                  </div>
                </div>
                <div class="level-progress-info">
                  <span>1,280 / 1,800 XP</span>
                  <div class="mini-progress"><div class="mini-fill" style="width:71%"></div></div>
                </div>
              </div>

              <div class="level-card next">
                <div class="level-header">
                  <span class="level-num">Lv.6</span>
                  <span class="level-name">Nature Scout</span>
                  <span class="level-status next-badge">NEXT</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag ai highlight">🦊 Forest Fox</span>
                    <span class="unlock-tag style highlight">🖌️ Oil Paint</span>
                    <span class="unlock-tag style">✏️ Sketch</span>
                    <span class="unlock-tag sticker">⭐ Star Stickers</span>
                  </div>
                </div>
                <div class="level-xp-need">🎯 520 XP to unlock</div>
              </div>

              <div class="level-card locked">
                <div class="level-header">
                  <span class="level-num">Lv.7</span>
                  <span class="level-name">Collector</span>
                  <span class="level-status">🔒</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag style">👾 Pixel Art</span>
                    <span class="unlock-tag ai">🐸 Frog Ranger</span>
                    <span class="unlock-tag feature">🔬 Pro Identify</span>
                    <span class="unlock-tag title">🏷️ "Field Expert"</span>
                  </div>
                </div>
              </div>

              <div class="level-card locked">
                <div class="level-header">
                  <span class="level-num">Lv.8</span>
                  <span class="level-name">Expert</span>
                  <span class="level-status">🔒</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag frame">🖼️ Gold Frame</span>
                    <span class="unlock-tag sticker">🌈 Rainbow Pack</span>
                    <span class="unlock-tag style">🏔️ Ghibli</span>
                    <span class="unlock-tag ai">🦋 Butterfly Guide</span>
                    <span class="unlock-tag feature">🎵 Nature Sounds</span>
                  </div>
                </div>
              </div>

              <div class="level-card locked">
                <div class="level-header">
                  <span class="level-num">Lv.9</span>
                  <span class="level-name">Scholar</span>
                  <span class="level-status">🔒</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag feature">📖 Expert Knowledge</span>
                    <span class="unlock-tag ai">🧪 Dr. Science</span>
                    <span class="unlock-tag style">🌌 Galaxy</span>
                    <span class="unlock-tag title">🏷️ "Nature Scholar"</span>
                  </div>
                </div>
              </div>

              <div class="level-card locked legendary">
                <div class="level-header">
                  <span class="level-num">Lv.10</span>
                  <span class="level-name">Legendary Explorer</span>
                  <span class="level-status">👑</span>
                </div>
                <div class="level-unlocks">
                  <div class="unlock-category">
                    <span class="unlock-tag frame legendary">🌈 Rainbow Frame</span>
                    <span class="unlock-tag title legendary">👑 "Legend"</span>
                    <span class="unlock-tag ai legendary">🐉 Dragon Sage</span>
                    <span class="unlock-tag style legendary">✨ Holographic</span>
                    <span class="unlock-tag feature legendary">🎁 Mystery Box</span>
                    <span class="unlock-tag feature legendary">🔓 All Unlocked</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- XP获取指南 -->
            <div class="xp-guide-section">
              <div class="xp-guide-title">💡 How to earn XP</div>
              <div class="xp-guide-list">
                <div class="xp-item">
                  <span class="xp-action">📸 Take a photo</span>
                  <span class="xp-value">+2 XP</span>
                </div>
                <div class="xp-item">
                  <span class="xp-action">🦋 Discover new species</span>
                  <span class="xp-value">+15 XP</span>
                </div>
                <div class="xp-item">
                  <span class="xp-action">⭐ Complete daily task</span>
                  <span class="xp-value">+10~35 XP</span>
                </div>
                <div class="xp-item">
                  <span class="xp-action">🎨 Create artwork</span>
                  <span class="xp-value">+10 XP</span>
                </div>
                <div class="xp-item">
                  <span class="xp-action">🔥 Daily streak bonus</span>
                  <span class="xp-value">+10 XP</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Notifications 通知列表页 ========== -->
        <div id="notifications-page" class="page page-blur-bg">
          <div class="notifications-container">
            <button class="notifications-back-btn" onclick="goBackFromNotifications()">
              <span>←</span>
              <span>Back</span>
            </button>

            <div class="notifications-header">
              <span>🔔</span>
              <span>Notifications</span>
            </div>

            <div class="notifications-list">
              <!-- 今天 -->
              <div class="notifications-date-group">
                <div class="notifications-date">TODAY</div>
                
                <div class="notification-item unread" onclick="expandNotification(this)">
                  <div class="notification-icon parent">💌</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">Mom</span>
                      <span class="notification-time">10:30</span>
                    </div>
                    <div class="notification-preview">Great job today! I saw your butterfly discovery 🎉</div>
                    <div class="notification-full">Great job today! I saw your butterfly discovery and I'm so proud of you! Keep exploring and learning new things. Love you! 🎉❤️</div>
                  </div>
                </div>

                <div class="notification-item unread" onclick="handleNotificationClick('map-page')">
                  <div class="notification-icon quest">🗺️</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">New Quest</span>
                      <span class="notification-time">09:15</span>
                    </div>
                    <div class="notification-preview">Find 3 different types of leaves</div>
                  </div>
                  <span class="notification-arrow">›</span>
                </div>
              </div>

              <!-- 昨天 -->
              <div class="notifications-date-group">
                <div class="notifications-date">YESTERDAY</div>
                
                <div class="notification-item" onclick="handleNotificationClick('backpack-page')">
                  <div class="notification-icon badge">🏆</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">Badge Unlocked!</span>
                      <span class="notification-time">16:42</span>
                    </div>
                    <div class="notification-preview">You earned "Flower Expert" 🌸</div>
                  </div>
                  <span class="notification-arrow">›</span>
                </div>

                <div class="notification-item" onclick="expandNotification(this)">
                  <div class="notification-icon parent">💌</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">Dad</span>
                      <span class="notification-time">12:20</span>
                    </div>
                    <div class="notification-preview">Can't wait to explore the park together this weekend!</div>
                    <div class="notification-full">Can't wait to explore the park together this weekend! Maybe we can find some interesting insects. What do you think? 🐛🔍</div>
                  </div>
                </div>
              </div>

              <!-- æ›´æ—© -->
              <div class="notifications-date-group">
                <div class="notifications-date">THIS WEEK</div>
                
                <div class="notification-item" onclick="handleNotificationClick('explorer-page')">
                  <div class="notification-icon level">⭐</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">Level Up!</span>
                      <span class="notification-time">Mon</span>
                    </div>
                    <div class="notification-preview">Congratulations! You reached Level 5</div>
                  </div>
                  <span class="notification-arrow">›</span>
                </div>

                <div class="notification-item">
                  <div class="notification-icon system">📢</div>
                  <div class="notification-content">
                    <div class="notification-header">
                      <span class="notification-sender">AI Explorer</span>
                      <span class="notification-time">Sun</span>
                    </div>
                    <div class="notification-preview">New feature: Night exploration mode is here!</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Settings 设置页 ========== -->
        <div id="settings-page" class="page page-blur-bg">
          <div class="settings-container">
            <button class="settings-back-btn" onclick="navigateTo('home-page')">
              <span>←</span>
              <span>Back</span>
            </button>

            <div class="settings-list">
              <!-- 网络组 -->
              <div class="settings-group">
                <div class="settings-group-title">Network</div>
                <div class="settings-group-card">
                  <div class="settings-item" onclick="navigateTo('wifi-page')">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">📶</div>
                      <div>
                        <div class="settings-label">Wi-Fi</div>
                        <div class="settings-value" id="current-wifi">HUAWEI-Iris</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon green">📡</div>
                      <div class="settings-label">Mobile Data</div>
                    </div>
                    <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
                  </div>
                </div>
              </div>

              <!-- 显示组 -->
              <div class="settings-group">
                <div class="settings-group-title">Display</div>
                <div class="settings-group-card">
                  <div class="settings-item expandable" onclick="toggleSettingsExpand(this)">
                    <div class="settings-item-left">
                      <div class="settings-icon yellow">🔆</div>
                      <div class="settings-label">Brightness</div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-expand-content">
                    <div class="brightness-slider-full">
                      <span>🌑</span>
                      <div class="slider-track-full">
                        <div class="slider-fill" style="width: 70%;"></div>
                        <div class="slider-thumb" style="left: 70%;"></div>
                      </div>
                      <span>☀️</span>
                    </div>
                  </div>
                  <div class="settings-item" onclick="showSettingsSheet('screen-timeout')">
                    <div class="settings-item-left">
                      <div class="settings-icon purple">⏱️</div>
                      <div>
                        <div class="settings-label">Screen Timeout</div>
                        <div class="settings-value" id="current-timeout">5 minutes</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                </div>
              </div>

              <!-- 声音组 -->
              <div class="settings-group">
                <div class="settings-group-title">Sound</div>
                <div class="settings-group-card">
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">🔊</div>
                      <div class="settings-label">Volume</div>
                    </div>
                    <div class="settings-slider">
                      <div class="slider-track">
                        <div class="slider-fill" style="width: 50%;"></div>
                      </div>
                      <span class="slider-value">50%</span>
                    </div>
                  </div>
                  <div class="settings-item">
                    <div class="settings-item-left">
                      <div class="settings-icon orange">🎵</div>
                      <div class="settings-label">Sound Effects</div>
                    </div>
                    <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
                  </div>
                </div>
              </div>

              <!-- AI组 -->
              <div class="settings-group">
                <div class="settings-group-title">AI Assistant</div>
                <div class="settings-group-card">
                  <div class="settings-item" onclick="showSettingsSheet('ai-voice')">
                    <div class="settings-item-left">
                      <div class="settings-icon purple">🤖</div>
                      <div>
                        <div class="settings-label">AI Voice</div>
                        <div class="settings-value" id="current-ai-voice">Robot</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item" onclick="showSettingsSheet('language')">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">🌐</div>
                      <div>
                        <div class="settings-label">Language</div>
                        <div class="settings-value" id="current-language">English</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                </div>
              </div>

              <!-- 设备组 -->
              <div class="settings-group">
                <div class="settings-group-title">Device</div>
                <div class="settings-group-card">
                  <div class="settings-item expandable" onclick="toggleSettingsExpand(this)">
                    <div class="settings-item-left">
                      <div class="settings-icon orange">💾</div>
                      <div>
                        <div class="settings-label">Storage</div>
                        <div class="settings-value">12.3 GB / 32 GB</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-expand-content">
                    <div class="storage-detail">
                      <div class="storage-bar">
                        <div class="storage-segment photos" style="width: 45%;"></div>
                        <div class="storage-segment aigc" style="width: 25%;"></div>
                        <div class="storage-segment system" style="width: 10%;"></div>
                      </div>
                      <div class="storage-legend">
                        <div class="legend-item"><span class="legend-dot photos"></span>Photos (5.5 GB)</div>
                        <div class="legend-item"><span class="legend-dot aigc"></span>Artworks (3.1 GB)</div>
                        <div class="legend-item"><span class="legend-dot system"></span>System (1.2 GB)</div>
                        <div class="legend-item"><span class="legend-dot free"></span>Free (22.2 GB)</div>
                      </div>
                    </div>
                  </div>

                  <div class="settings-item expandable" onclick="toggleSettingsExpand(this)">
                    <div class="settings-item-left">
                      <div class="settings-icon green">🔋</div>
                      <div>
                        <div class="settings-label">Battery</div>
                        <div class="settings-value">87%</div>
                      </div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-expand-content">
                    <div class="battery-detail">
                      <div class="battery-status">
                        <span class="battery-icon">🔋</span>
                        <span class="battery-percent">87%</span>
                        <span class="battery-health">• Healthy</span>
                      </div>
                      <div class="battery-info">Estimated 4h 30min remaining</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 关于组 -->
              <div class="settings-group">
                <div class="settings-group-title">About</div>
                <div class="settings-group-card">
                  <div class="settings-item" onclick="navigateTo('about-device-page')">
                    <div class="settings-item-left">
                      <div class="settings-icon gray">ℹ️</div>
                      <div class="settings-label">About Device</div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                  <div class="settings-item" onclick="navigateTo('system-update-page')">
                    <div class="settings-item-left">
                      <div class="settings-icon blue">🔄</div>
                      <div class="settings-label">System Update</div>
                    </div>
                    <span class="settings-chevron">›</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Wi-Fi设置页 ========== -->
        <div id="wifi-page" class="page page-blur-bg">
          <div class="wifi-container">
            <button class="wifi-back-btn" onclick="navigateTo('settings-page')">
              <span>←</span>
              <span>Back</span>
            </button>
            
            <div class="wifi-header">
              <span>📶</span>
              <span>Wi-Fi</span>
            </div>

            <div class="wifi-content">
              <!-- Wi-Fi开关 -->
              <div class="wifi-toggle-card">
                <div class="wifi-toggle-left">
                  <span class="wifi-toggle-label">Wi-Fi</span>
                </div>
                <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
              </div>

              <!-- 当前连接 -->
              <div class="wifi-section">
                <div class="wifi-section-title">Current Network</div>
                <div class="wifi-network-card connected">
                  <div class="wifi-network-info">
                    <span class="wifi-network-name">HUAWEI-Iris</span>
                    <span class="wifi-network-status">Connected</span>
                  </div>
                  <div class="wifi-network-icons">
                    <span class="wifi-lock">🔒</span>
                    <span class="wifi-signal full">📶</span>
                  </div>
                </div>
              </div>

              <!-- 可用网络 -->
              <div class="wifi-section">
                <div class="wifi-section-title">Available Networks</div>
                <div class="wifi-network-list">
                  <div class="wifi-network-card" onclick="showWifiPasswordModal('s_WiFi5')">
                    <div class="wifi-network-info">
                      <span class="wifi-network-name">s_WiFi5</span>
                    </div>
                    <div class="wifi-network-icons">
                      <span class="wifi-lock">🔒</span>
                      <span class="wifi-signal full">📶</span>
                    </div>
                  </div>
                  <div class="wifi-network-card" onclick="showWifiPasswordModal('HUAWEI-3B1406')">
                    <div class="wifi-network-info">
                      <span class="wifi-network-name">HUAWEI-3B1406</span>
                    </div>
                    <div class="wifi-network-icons">
                      <span class="wifi-lock">🔒</span>
                      <span class="wifi-signal medium">📶</span>
                    </div>
                  </div>
                  <div class="wifi-network-card" onclick="showWifiPasswordModal('31406_WiFi5')">
                    <div class="wifi-network-info">
                      <span class="wifi-network-name">31406_WiFi5</span>
                    </div>
                    <div class="wifi-network-icons">
                      <span class="wifi-lock">🔒</span>
                      <span class="wifi-signal weak">📶</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== Wi-Fi密码输入弹窗 ========== -->
        <div class="wifi-password-overlay" id="wifi-password-overlay" onclick="hideWifiPasswordModal()">
          <div class="wifi-password-modal" onclick="event.stopPropagation()">
            <div class="wifi-password-header">
              <span class="wifi-password-title" id="wifi-password-title">Connect to s_WiFi5</span>
              <button class="wifi-password-close" onclick="hideWifiPasswordModal()">✕</button>
            </div>
            <div class="wifi-password-content">
              <div class="wifi-password-input-group">
                <label>Password</label>
                <input type="password" class="wifi-password-input" placeholder="Enter password">
              </div>
              <button class="wifi-connect-btn" onclick="hideWifiPasswordModal()">Connect</button>
            </div>
          </div>
        </div>

        <!-- ========== About Device页 ========== -->
        <div id="about-device-page" class="page page-blur-bg">
          <div class="about-device-container">
            <button class="about-device-back-btn" onclick="navigateTo('settings-page')">
              <span>←</span>
              <span>Back</span>
            </button>
            
            <div class="about-device-header">
              <span>ℹ️</span>
              <span>About Device</span>
            </div>

            <div class="about-device-content">
              <div class="about-device-card">
                <div class="about-device-row">
                  <span class="about-device-label">Name</span>
                  <span class="about-device-value">AI Explorer</span>
                </div>
                <div class="about-device-row">
                  <span class="about-device-label">Model</span>
                  <span class="about-device-value">AE-S1</span>
                </div>
                <div class="about-device-row">
                  <span class="about-device-label">Version</span>
                  <span class="about-device-value">2.0.4_251020141930</span>
                </div>
                <div class="about-device-row">
                  <span class="about-device-label">SN</span>
                  <span class="about-device-value">SL01AC6B50244229477</span>
                </div>
                <div class="about-device-row">
                  <span class="about-device-label">Storage</span>
                  <span class="about-device-value">12.3GB (32GB)</span>
                </div>
                <div class="about-device-row">
                  <span class="about-device-label">IMEI</span>
                  <span class="about-device-value">865436077652634</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== System Update页 ========== -->
        <div id="system-update-page" class="page page-blur-bg">
          <div class="system-update-container">
            <button class="system-update-back-btn" onclick="navigateTo('settings-page')">
              <span>←</span>
              <span>Back</span>
            </button>
            
            <div class="system-update-header">
              <span>🔄</span>
              <span>System Update</span>
            </div>

            <div class="system-update-content">
              <!-- 默认状态：已是最新 -->
              <div class="update-state" id="update-state-current">
                <div class="system-update-icon">🌐</div>
                <div class="system-update-status">Your system is up to date</div>
                <div class="system-update-version">Current version: 2.0.4</div>
              </div>

              <!-- 检查中状态 -->
              <div class="update-state" id="update-state-checking" style="display: none;">
                <div class="update-spinner">
                  <div class="spinner-ring"></div>
                  <div class="spinner-icon">🔍</div>
                </div>
                <div class="system-update-status">Checking for updates...</div>
                <div class="system-update-version">Please wait</div>
              </div>

              <!-- 有更新可用状态 -->
              <div class="update-state" id="update-state-available" style="display: none;">
                <div class="update-available-icon">🎉</div>
                <div class="system-update-status">New version available!</div>
                <div class="system-update-version">Version 2.1.0</div>
                <div class="update-changelog">
                  <div class="changelog-title">What's new:</div>
                  <div class="changelog-item">• Improved AI recognition</div>
                  <div class="changelog-item">• New exploration badges</div>
                  <div class="changelog-item">• Bug fixes & performance</div>
                </div>
              </div>

              <button class="system-update-btn" id="system-update-btn" onclick="handleUpdateAction()">Check for Updates</button>
            </div>
          </div>
        </div>

        <!-- ========== Settings底部弹窗 ========== -->
        <div class="settings-sheet-overlay" id="settings-sheet-overlay" onclick="hideSettingsSheet()">
          <div class="settings-sheet" onclick="event.stopPropagation()">
            <div class="settings-sheet-header">
              <span class="settings-sheet-title" id="settings-sheet-title">AI Voice</span>
              <button class="settings-sheet-close" onclick="hideSettingsSheet()">✕</button>
            </div>
            
            <div class="settings-sheet-content" id="settings-sheet-content">
              <!-- AI Voice选项 -->
              <div class="settings-sheet-options" id="ai-voice-options">
                <div class="sheet-option selected" onclick="selectOption('ai-voice', 'Robot', this)">
                  <span class="option-icon">🤖</span>
                  <div class="option-info">
                    <div class="option-name">Robot</div>
                    <div class="option-desc">Friendly & curious</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('ai-voice', 'Fox', this)">
                  <span class="option-icon">🦊</span>
                  <div class="option-info">
                    <div class="option-name">Forest Fox</div>
                    <div class="option-desc">Playful & adventurous</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('ai-voice', 'Owl', this)">
                  <span class="option-icon">🦉</span>
                  <div class="option-info">
                    <div class="option-name">Wise Owl</div>
                    <div class="option-desc">Calm & knowledgeable</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option locked">
                  <span class="option-icon">🧙</span>
                  <div class="option-info">
                    <div class="option-name">Wizard</div>
                    <div class="option-desc">Magical & mysterious</div>
                  </div>
                  <span class="option-lock">🔒 Lv.7</span>
                </div>
              </div>

              <!-- Language选项 -->
              <div class="settings-sheet-options" id="language-options" style="display:none;">
                <div class="sheet-option selected" onclick="selectOption('language', 'English', this)">
                  <span class="option-icon">🇺🇸</span>
                  <div class="option-info">
                    <div class="option-name">English</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('language', 'Español', this)">
                  <span class="option-icon">🇪🇸</span>
                  <div class="option-info">
                    <div class="option-name">Español</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('language', 'Français', this)">
                  <span class="option-icon">🇫🇷</span>
                  <div class="option-info">
                    <div class="option-name">Français</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('language', '中文', this)">
                  <span class="option-icon">🇨🇳</span>
                  <div class="option-info">
                    <div class="option-name">中文</div>
                  </div>
                  <span class="option-check">✓</span>
                </div>
              </div>

              <!-- Screen Timeout选项 -->
              <div class="settings-sheet-options" id="screen-timeout-options" style="display:none;">
                <div class="sheet-option" onclick="selectOption('screen-timeout', '1 minute', this)">
                  <div class="option-info"><div class="option-name">1 minute</div></div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('screen-timeout', '3 minutes', this)">
                  <div class="option-info"><div class="option-name">3 minutes</div></div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option selected" onclick="selectOption('screen-timeout', '5 minutes', this)">
                  <div class="option-info"><div class="option-name">5 minutes</div></div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('screen-timeout', '10 minutes', this)">
                  <div class="option-info"><div class="option-name">10 minutes</div></div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('screen-timeout', '15 minutes', this)">
                  <div class="option-info"><div class="option-name">15 minutes</div></div>
                  <span class="option-check">✓</span>
                </div>
                <div class="sheet-option" onclick="selectOption('screen-timeout', '20 minutes', this)">
                  <div class="option-info"><div class="option-name">20 minutes</div></div>
                  <span class="option-check">✓</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== AI 菜单浮层 ========== -->
        <div class="ai-overlay" id="ai-overlay">
          <div class="ai-left-section">
            <div class="ai-title-group">
              <div class="ai-icon">✨</div>
              <span class="ai-title">AI Assistant</span>
            </div>
            <div class="ai-context-badge" id="ai-context-badge">🏠 Home</div>
          </div>
          <div class="ai-menu-grid" id="ai-menu-grid">
            <div class="ai-menu-item" onclick="handleAIAction('dailyQuest')">
              <div class="ai-menu-icon purple">🎯</div>
              <div class="ai-menu-label">Daily Quest</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('learnSomething')">
              <div class="ai-menu-icon blue">📖</div>
              <div class="ai-menu-label">Learn</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('myProgress')">
              <div class="ai-menu-icon yellow">🏆</div>
              <div class="ai-menu-label">Progress</div>
            </div>
            <div class="ai-menu-item" onclick="handleAIAction('help')">
              <div class="ai-menu-icon green">❓</div>
              <div class="ai-menu-label">Help</div>
            </div>
          </div>
          <button class="ai-close" onclick="hideAI()">✕</button>
        </div>

        <!-- ========== 全局AIGC生成弹窗 ========== -->
        <div class="aigc-modal-overlay" id="aigc-modal-overlay">
          <div class="aigc-modal" onclick="event.stopPropagation()">
            <div class="aigc-modal-title">✨ Creating Magic Art</div>
            
            <!-- 生成中 -->
            <div class="aigc-generating" id="aigc-generating">
              <div class="aigc-spinner">🎨</div>
              <div class="aigc-progress-text">Transforming your photo...</div>
              <div class="aigc-progress-bar">
                <div class="aigc-progress-fill" id="aigc-progress" style="width: 30%;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== 全局分享弹窗 ========== -->
        <div class="share-modal-overlay" id="share-modal-overlay">
          <div class="share-modal">
            <div class="share-modal-header">
              <span class="share-modal-title">📤 Share to...</span>
              <button class="share-modal-close" onclick="hideShareModal()">✕</button>
            </div>
            
            <div class="share-options">
              <div class="share-option" onclick="shareToFamily()">
                <div class="share-option-icon family">👨‍👩‍👧</div>
                <div class="share-option-info">
                  <div class="share-option-name">Family Circle</div>
                  <div class="share-option-desc">Send to parent's app</div>
                </div>
                <span class="share-option-arrow">→</span>
              </div>
              
              <div class="share-option" onclick="showQRShare()">
                <div class="share-option-icon qr">🔗</div>
                <div class="share-option-info">
                  <div class="share-option-name">QR Code</div>
                  <div class="share-option-desc">Share with anyone (7 days)</div>
                </div>
                <span class="share-option-arrow">→</span>
              </div>
            </div>

            <div class="share-privacy-note">
              <span>🔒</span>
              <span>Faces auto-blurred · Location removed</span>
            </div>
          </div>
        </div>

        <!-- ========== QR分享卡片弹窗 ========== -->
        <div class="qr-share-overlay" id="qr-share-overlay">
          <div class="qr-share-card">
            <button class="qr-share-close" onclick="hideQRShare()">✕</button>
            
            <!-- 分享卡片预览 -->
            <div class="qr-share-preview">
              <div class="qr-card-image">
                <img src="https://picsum.photos/200/150?random=20" alt="Shared">
                <div class="qr-card-badge">🎨 Ghibli Style</div>
              </div>
              
              <div class="qr-card-info">
                <div class="qr-card-title">🦋 Monarch Butterfly</div>
                <div class="qr-card-explorer">
                  <span class="qr-explorer-avatar">🧒</span>
                  <span class="qr-explorer-name">Little Explorer</span>
                  <span class="qr-explorer-level">Lv.5</span>
                </div>
                <div class="qr-card-date">Dec 17, 2024</div>
              </div>

              <div class="qr-code-section">
                <div class="qr-code-placeholder">
                  <div class="qr-code-grid">
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                  </div>
                </div>
                <div class="qr-code-hint">Scan to view & save</div>
                <div class="qr-code-expire">⏱️ Expires in 7 days</div>
              </div>

              <div class="qr-card-footer">
                <div class="qr-card-brand">
                  <span>🔭</span>
                  <span>AI Explorer</span>
                </div>
                <div class="qr-card-tagline">The AI camera for young explorers</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== 探险家卡片分享弹窗 ========== -->
        <div class="qr-share-overlay" id="explorer-share-overlay">
          <div class="qr-share-card explorer-card">
            <button class="explorer-card-close" onclick="hideExplorerShare()">✕</button>
            
            <!-- 探险家卡片预览 -->
            <div class="explorer-share-preview">
              <div class="explorer-card-header">
                <span>🏆</span>
                <span>Explorer Card</span>
              </div>
              
              <div class="explorer-card-avatar">
                <div class="card-avatar-frame">
                  <span>🧒</span>
                </div>
                <div class="card-streak-badge">🔥 7</div>
              </div>

              <div class="explorer-card-identity">
                <div class="card-title-badge">Nature Detective</div>
                <div class="card-name">Little Explorer</div>
                <div class="card-level">⭐ Level 5 ⭐</div>
              </div>

              <div class="explorer-card-stats">
                <div class="card-stat">
                  <span class="card-stat-value">128</span>
                  <span class="card-stat-label">Photos</span>
                </div>
                <div class="card-stat">
                  <span class="card-stat-value">23</span>
                  <span class="card-stat-label">Species</span>
                </div>
                <div class="card-stat">
                  <span class="card-stat-value">8</span>
                  <span class="card-stat-label">Badges</span>
                </div>
              </div>

              <div class="explorer-card-badges">
                <span>🌸</span>
                <span>📸</span>
                <span>🔥</span>
                <span>🦋</span>
                <span>⭐</span>
              </div>

              <div class="qr-code-section">
                <div class="qr-code-placeholder">
                  <div class="qr-code-grid">
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                  </div>
                </div>
                <div class="qr-code-hint">Scan to view my journey</div>
                <div class="qr-code-expire">⏱️ Expires in 7 days</div>
              </div>

              <div class="qr-card-footer">
                <div class="qr-card-brand">
                  <span>🔭</span>
                  <span>AI Explorer</span>
                </div>
                <div class="qr-card-tagline">The AI camera for young explorers</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== 分享成功提示 ========== -->
        <div class="share-success-toast" id="share-success-toast">
          <span>✅</span>
          <span>Sent to Family Circle!</span>
        </div>

        <!-- ========== XP飘字 ========== -->
        <div class="xp-float" id="xp-float">+15 XP ✨</div>

        <!-- ========== 升级弹窗 ========== -->
        <div class="levelup-modal-overlay" id="levelup-modal">
          <div class="levelup-modal">
            <div class="levelup-stars">⭐ ✨ ⭐</div>
            <div class="levelup-title">LEVEL UP!</div>
            <div class="levelup-levels">Level 5 → Level 6</div>
            
            <div class="levelup-unlocks">
              <div class="levelup-unlocks-title">New Unlocks</div>
              <div class="levelup-unlock-item">
                <span>🦊</span>
                <span>Forest Fox AI</span>
              </div>
              <div class="levelup-unlock-item">
                <span>🎨</span>
                <span>Oil Paint Style</span>
              </div>
            </div>

            <button class="levelup-btn" onclick="hideLevelUpModal()">Awesome!</button>
          </div>
        </div>

        <!-- ========== 徽章解锁弹窗 ========== -->
        <div class="badge-modal-overlay" id="badge-modal">
          <div class="badge-modal">
            <div class="badge-confetti">✨ 🎉 ⭐ 🎊 ✨ 🎉 ⭐ 🎊 ✨</div>
            
            <div class="badge-icon-large">🌸</div>
            
            <div class="badge-unlock-title">BADGE UNLOCKED!</div>
            <div class="badge-name-row">
              <span class="badge-name">Flower Expert</span>
              <span class="badge-rarity rare">⭐ RARE</span>
            </div>
            <div class="badge-description">"Discovered 10 different flowers"</div>

            <button class="badge-btn continue" onclick="triggerBadgeClose()">Awesome!</button>
          </div>
        </div>

        <!-- ========== PTT 浮层 ========== -->
        <div class="ptt-overlay" id="ptt-overlay">
          <div class="ptt-header">
            <div class="ptt-status">
              <div class="ptt-status-dot" id="ptt-status-dot"></div>
              <span class="ptt-status-text" id="ptt-status-text">Listening...</span>
            </div>
            <button class="ptt-close" onclick="hidePTT()">✕</button>
          </div>
          
          <!-- 录音状态 -->
          <div class="ptt-content" id="ptt-recording-section">
            <div class="ptt-character-section">
              <div class="ptt-character" id="ptt-character">🤖</div>
              <div class="ptt-character-switch">
                <button class="ptt-char-btn active" onclick="switchCharacter('🤖', this)">🤖</button>
                <button class="ptt-char-btn" onclick="switchCharacter('🧙', this)">🧙</button>
                <button class="ptt-char-btn" onclick="switchCharacter('🦊', this)">🦊</button>
              </div>
            </div>
            <div class="ptt-voice-section">
              <div class="ptt-waveform">
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
                <div class="ptt-wave-bar"></div>
              </div>
              <div class="ptt-transcript" id="ptt-transcript">What kind of bug is this?</div>
            </div>
          </div>

          <!-- 回复状态 -->
          <div class="ptt-response-section" id="ptt-response-section">
            <div class="ptt-user-msg">
              <div class="ptt-msg-label">You asked:</div>
              <div class="ptt-msg-text" id="ptt-user-text">What kind of bug is this?</div>
            </div>
            <div class="ptt-ai-msg">
              <div class="ptt-ai-avatar" id="ptt-ai-avatar">🤖</div>
              <div class="ptt-ai-content">
                <div class="ptt-ai-text" id="ptt-ai-text">That's a ladybug! They're tiny beetles with spots. They eat aphids and help gardens grow! 🐞</div>
              </div>
            </div>
            <div class="ptt-actions">
              <button class="ptt-action-btn ptt-ask-more" onclick="pttAskMore()">🎤 Ask More</button>
              <button class="ptt-action-btn ptt-continue-chat" onclick="pttContinueChat()">💬 Continue</button>
            </div>
          </div>

          <div class="ptt-hint" id="ptt-hint">Release to send • Hold PTT to continue</div>
        </div>

        <!-- ========== 二级卡片浮层 ========== -->
        <div class="ai-card-overlay" id="ai-card-overlay" onclick="hideAICard()">
          <div class="ai-card" id="ai-card" onclick="event.stopPropagation()">
            <!-- 卡片内容动态填充 -->
          </div>
        </div>

        <!-- ========== 音量指示器 ========== -->
        <div class="volume-indicator" id="volume-indicator">
          <div class="volume-icon" id="volume-icon">🔊</div>
          <div class="volume-bar-container">
            <div class="volume-bar" id="volume-bar" style="width: 70%"></div>
          </div>
          <div class="volume-text" id="volume-text">70%</div>
        </div>

        <!-- ========== 息屏遮罩 ========== -->
        <div class="screen-off-overlay" id="screen-off-overlay"></div>

      </div>
    </div>

    <!-- 右侧按键区 -->
    <div class="button-panel">
      <div class="button-group">
        <button class="device-button btn-shutter" onclick="pressShutter()">📷</button>
        <div class="button-label">Shutter</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-ptt" onclick="togglePTT()">🎤</button>
        <div class="button-label">PTT</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-ai" onclick="toggleAI()">✨</button>
        <div class="button-label">AI</div>
      </div>
      
      <div class="button-divider"></div>
      
      <div class="button-group">
        <button class="device-button btn-vol-up" onclick="adjustVolume(1)">🔊</button>
        <div class="button-label">Vol+</div>
      </div>
      <div class="button-group">
        <button class="device-button btn-vol-down" onclick="adjustVolume(-1)">🔉</button>
        <div class="button-label">Vol-</div>
      </div>
      
      <div class="button-divider"></div>
      
      <div class="button-group">
        <button class="device-button btn-power" onclick="togglePower()">⏻</button>
        <div class="button-label">Power</div>
      </div>
    </div>
    </div> <!-- device-area end -->
  </div>

  <script>
    // ============ 音量控制 ============
    let currentVolume = 70;
    let volumeTimeout = null;
    let isScreenOff = false;

    function adjustVolume(delta) {
      // 如果息屏状态,先唤醒
      if (isScreenOff) {
        togglePower();
        return;
      }

      currentVolume = Math.max(0, Math.min(100, currentVolume + delta * 10));
      
      const indicator = document.getElementById('volume-indicator');
      const bar = document.getElementById('volume-bar');
      const text = document.getElementById('volume-text');
      const icon = document.getElementById('volume-icon');
      
      bar.style.width = currentVolume + '%';
      text.textContent = currentVolume + '%';
      
      // 更新图标
      if (currentVolume === 0) {
        icon.textContent = '🔇';
      } else if (currentVolume < 30) {
        icon.textContent = '🔈';
      } else if (currentVolume < 70) {
        icon.textContent = '🔉';
      } else {
        icon.textContent = '🔊';
      }
      
      // 显示指示器
      indicator.classList.add('show');
      
      // 清除之前的定时器
      if (volumeTimeout) {
        clearTimeout(volumeTimeout);
      }
      
      // 1.5秒后隐藏
      volumeTimeout = setTimeout(() => {
        indicator.classList.remove('show');
      }, 1500);
    }

    // ============ 电源控制 ============
    function togglePower() {
      const overlay = document.getElementById('screen-off-overlay');
      isScreenOff = !isScreenOff;
      
      if (isScreenOff) {
        overlay.classList.add('active');
      } else {
        overlay.classList.remove('active');
      }
    }

    // ============ 相机功能 ============
    let flashOn = false;
    let gridOn = false;
    let zoomLevel = 1;

    function toggleFlash() {
      flashOn = !flashOn;
      const btn = document.getElementById('flash-btn');
      btn.classList.toggle('active', flashOn);
    }

    function toggleGrid() {
      gridOn = !gridOn;
      const btn = document.getElementById('grid-btn');
      btn.classList.toggle('active', gridOn);
    }

    function toggleZoom() {
      zoomLevel = zoomLevel === 1 ? 2 : (zoomLevel === 2 ? 3 : 1);
      document.getElementById('zoom-label').textContent = zoomLevel + '×';
    }

    function takePhoto() {
      // 闪光效果
      const flash = document.getElementById('camera-flash');
      flash.classList.add('active');
      setTimeout(() => {
        flash.classList.remove('active');
        // 跳转到预览页(暂时跳回首页)
        navigateTo('photo-preview-page');
      }, 150);
    }

    function openGallery() {
      navigateTo('backpack-page');
    }

    // ============ 快门硬件按钮 ============
    function pressShutter() {
      // 如果息屏状态,先唤醒
      if (isScreenOff) {
        togglePower();
        return;
      }

      // 如果在相机页面,触发拍照
      if (currentPage === 'camera-page') {
        takePhoto();
      } else {
        // 其他页面跳转到相机
        navigateTo('camera-page');
      }
    }

    function deletePhoto() {
      if (confirm('Delete this photo?')) {
        navigateTo('camera-page');
      }
    }

    function savePhoto() {
      alert('Photo saved to Backpack! 📸');
    }

    // ============ 地图功能 ============
    const taskData = {
      flower: {
        icon: '🌸',
        color: 'linear-gradient(135deg, #FF6B6B 0%, #E74C3C 100%)',
        title: 'Find a Flower',
        desc: 'Look around for any beautiful flowers! Take a photo when you find one. Can you spot different colors? 🌈'
      },
      butterfly: {
        icon: '🦋',
        color: 'linear-gradient(135deg, #FFD700 0%, #F59E0B 100%)',
        title: 'Spot a Butterfly',
        desc: 'Butterflies love sunny spots and flowers. Move slowly and quietly to get a good photo! 🌻'
      },
      rock: {
        icon: '🪨',
        color: 'linear-gradient(135deg, #4ADE80 0%, #22C55E 100%)',
        title: 'Cool Rock Hunt',
        desc: 'Find an interesting rock with unique colors or patterns. What makes it special? 🔍'
      },
      leaf: {
        icon: '🍂',
        color: 'linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%)',
        title: 'Collect Leaves',
        desc: 'Find leaves of different shapes and sizes. How many different trees can you identify? 🌳'
      }
    };

    function showTaskModal(taskType) {
      const task = taskData[taskType];
      if (!task) return;
      
      document.getElementById('task-modal-icon').style.background = task.color;
      document.getElementById('task-modal-icon').textContent = task.icon;
      document.getElementById('task-modal-title').textContent = task.title;
      document.getElementById('task-modal-desc').textContent = task.desc;
      document.getElementById('task-modal-overlay').classList.add('show');
    }

    function hideTaskModal() {
      document.getElementById('task-modal-overlay').classList.remove('show');
    }

    function acceptTask() {
      hideTaskModal();
      navigateTo('camera-page');
    }

    // ============ 工坊功能 ============
    let selectedStyle = { name: 'Ghibli', icon: '🏔️' };
    let selectedPhoto = null;

    function selectStyle(name, icon) {
      selectedStyle = { name, icon };
      document.getElementById('workshop-style-icon').textContent = icon;
      document.getElementById('workshop-style-name').textContent = name;
      navigateTo('workshop-photo-page');
    }

    function selectEffectCard(card, name, icon) {
      document.querySelectorAll('.effect-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      selectedStyle = { name, icon };
      // 更新结果页风格标签
      document.getElementById('aigc-result-style-tag').innerHTML = `<span>${icon}</span><span>${name} Style</span>`;
      // 显示生成弹窗
      showAigcModal('effect');
    }

    function selectPhotoItem(item) {
      document.querySelectorAll('.photo-select-item').forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');
      selectedPhoto = item;
      updateCreateBtn();
    }

    function updateCreateBtn() {
      const checkbox = document.getElementById('workshop-agree-checkbox');
      const btn = document.getElementById('workshop-create-btn');
      btn.disabled = !(selectedPhoto && checkbox.checked);
    }

    function startWorkshopCreation() {
      showAigcModal('workshop');
    }

    function showAigcModal(source) {
      const overlay = document.getElementById('aigc-modal-overlay');
      const generating = document.getElementById('aigc-generating');
      const progressBar = document.getElementById('aigc-progress');
      
      if (!overlay || !generating || !progressBar) {
        console.error('AIGC modal elements not found');
        return;
      }
      
      overlay.classList.add('show');
      generating.style.display = 'block';
      progressBar.style.width = '0%';
      
      // 模拟进度
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            hideAigcModal();
            // 跳转到结果页
            navigateTo('aigc-result-page');
          }, 300);
        }
        progressBar.style.width = progress + '%';
      }, 400);
    }

    function hideAigcModal() {
      const overlay = document.getElementById('aigc-modal-overlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
    }

    function saveAigcResult() {
      hideAigcModal();
      alert('Artwork saved to Backpack! 🎨');
      navigateTo('backpack-page');
    }

    // AIGC结果页函数 - 只切换图片可见性,不影响其他元素
    function showOriginal() {
      const resultImg = document.getElementById('aigc-result-img');
      const originalImg = document.getElementById('aigc-original-img');
      if (resultImg) resultImg.style.opacity = '0';
      if (originalImg) originalImg.style.opacity = '1';
    }
    
    function hideOriginal() {
      const resultImg = document.getElementById('aigc-result-img');
      const originalImg = document.getElementById('aigc-original-img');
      if (resultImg) resultImg.style.opacity = '1';
      if (originalImg) originalImg.style.opacity = '0';
    }
    
    function saveAigcToGallery() {
      alert('Artwork saved to Backpack! 🎨');
      // 停留在当前页面,等待用户主动操作
    }

    // ============ 分享功能 ============
    let currentShareType = 'photo'; // 'photo' | 'explorer'

    function showShareModal(type = 'photo') {
      currentShareType = type;
      document.getElementById('share-modal-overlay').classList.add('show');
    }

    function hideShareModal() {
      document.getElementById('share-modal-overlay').classList.remove('show');
    }

    function shareToFamily() {
      hideShareModal();
      // 显示成功提示
      const toast = document.getElementById('share-success-toast');
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    function showQRShare() {
      hideShareModal();
      if (currentShareType === 'explorer') {
        document.getElementById('explorer-share-overlay').classList.add('show');
      } else {
        document.getElementById('qr-share-overlay').classList.add('show');
      }
    }

    function hideQRShare() {
      document.getElementById('qr-share-overlay').classList.remove('show');
    }

    function hideExplorerShare() {
      document.getElementById('explorer-share-overlay').classList.remove('show');
    }

    // ============ 通知功能 ============
    let previousPage = 'home-page';

    function goBackFromNotifications() {
      navigateTo(previousPage);
    }

    function expandNotification(el) {
      el.classList.toggle('expanded');
      el.classList.remove('unread');
      updateNotificationDots();
    }

    function handleNotificationClick(targetPage) {
      navigateTo(targetPage);
      event.target.closest('.notification-item').classList.remove('unread');
      updateNotificationDots();
    }

    function updateNotificationDots() {
      const hasUnread = document.querySelectorAll('.notification-item.unread').length > 0;
      const homeBell = document.getElementById('home-notification-bell');
      const explorerDot = document.getElementById('explorer-notification-dot');
      
      if (homeBell) {
        homeBell.style.display = hasUnread ? 'flex' : 'none';
      }
      if (explorerDot) {
        explorerDot.style.display = hasUnread ? 'block' : 'none';
      }
    }

    // ============ XP飘字和弹窗 ============
    function showXPFloat(amount) {
      const el = document.getElementById('xp-float');
      el.textContent = `+${amount} XP ✨`;
      el.classList.remove('show');
      void el.offsetWidth; // 强制重绘
      el.classList.add('show');
      
      setTimeout(() => {
        el.classList.remove('show');
      }, 1500);
    }

    function showLevelUpModal() {
      document.getElementById('levelup-modal').classList.add('show');
    }

    function hideLevelUpModal() {
      document.getElementById('levelup-modal').classList.remove('show');
    }

    function showBadgeModal() {
      document.getElementById('badge-modal').classList.add('show');
    }

    function hideBadgeModal() {
      document.getElementById('badge-modal').classList.remove('show');
    }

    // 演示:依次触发反馈队列(XP → 徽章 → 升级)
    // 空状态预览切换
    function toggleEmptyState() {
      const toggle = document.getElementById('empty-state-toggle');
      const isEnabled = toggle && toggle.checked;
      // 显示提示
      const toast = document.createElement('div');
      toast.style.cssText = 'position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 20px; font-size: 14px; z-index: 9999;';
      toast.textContent = isEnabled ? '📭 空状态预览已开启' : '📬 空状态预览已关闭';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 1500);
    }

    function demoRewardSequence() {
      showLevelUpAfterBadge = true;
      
      // 1. XP飘字
      showXPFloat(15);
      
      // 2. 1.5秒后显示徽章弹窗
      setTimeout(() => {
        showBadgeModal();
      }, 1600);
      
      // 徽章弹窗关闭后显示升级弹窗(通过triggerBadgeClose触发)
    }

    // 徽章弹窗关闭后的回调
    let showLevelUpAfterBadge = false;
    
    function triggerBadgeClose() {
      hideBadgeModal();
      if (showLevelUpAfterBadge) {
        setTimeout(() => {
          showLevelUpModal();
          showLevelUpAfterBadge = false;
        }, 300);
      }
    }

    // ============ Settings功能 ============
    function toggleSettingsExpand(el) {
      const content = el.nextElementSibling;
      const isExpanded = el.classList.contains('expanded');
      
      // 关闭其他展开项
      document.querySelectorAll('.settings-item.expanded').forEach(item => {
        item.classList.remove('expanded');
        item.nextElementSibling.classList.remove('show');
      });
      
      if (!isExpanded) {
        el.classList.add('expanded');
        content.classList.add('show');
      }
    }

    function showSettingsSheet(type) {
      document.getElementById('ai-voice-options').style.display = type === 'ai-voice' ? 'flex' : 'none';
      document.getElementById('language-options').style.display = type === 'language' ? 'flex' : 'none';
      document.getElementById('screen-timeout-options').style.display = type === 'screen-timeout' ? 'flex' : 'none';
      
      const titles = {
        'ai-voice': 'AI Voice',
        'language': 'Language',
        'screen-timeout': 'Screen Timeout'
      };
      document.getElementById('settings-sheet-title').textContent = titles[type] || type;
      document.getElementById('settings-sheet-overlay').classList.add('show');
    }

    function hideSettingsSheet() {
      document.getElementById('settings-sheet-overlay').classList.remove('show');
    }

    // ============ Wi-Fi Password Modal ============
    function showWifiPasswordModal(networkName) {
      document.getElementById('wifi-password-title').textContent = 'Connect to ' + networkName;
      document.getElementById('wifi-password-overlay').classList.add('show');
    }

    function hideWifiPasswordModal() {
      document.getElementById('wifi-password-overlay').classList.remove('show');
    }

    // ============ System Update ============
    let updateState = 'current'; // current, checking, available
    
    function handleUpdateAction() {
      const btn = document.getElementById('system-update-btn');
      
      if (updateState === 'current') {
        // 开始检查更新
        updateState = 'checking';
        btn.textContent = 'Checking...';
        btn.disabled = true;
        
        // 显示检查状态
        document.getElementById('update-state-current').style.display = 'none';
        document.getElementById('update-state-checking').style.display = 'flex';
        document.getElementById('update-state-available').style.display = 'none';
        
        // 模拟检查过程
        setTimeout(() => {
          // 显示有更新可用
          updateState = 'available';
          document.getElementById('update-state-checking').style.display = 'none';
          document.getElementById('update-state-available').style.display = 'flex';
          
          btn.textContent = 'Update Now';
          btn.disabled = false;
          btn.classList.add('update-now');
        }, 2500);
        
      } else if (updateState === 'available') {
        // 开始更新
        btn.textContent = 'Updating...';
        btn.disabled = true;
        
        // 模拟更新过程
        setTimeout(() => {
          // 更新完成，回到最新状态
          updateState = 'current';
          document.getElementById('update-state-available').style.display = 'none';
          document.getElementById('update-state-current').style.display = 'flex';
          
          // 更新版本号
          document.querySelector('#update-state-current .system-update-version').textContent = 'Current version: 2.1.0';
          
          btn.textContent = 'Check for Updates';
          btn.disabled = false;
          btn.classList.remove('update-now');
        }, 3000);
      }
    }

    function resetUpdateState() {
      updateState = 'current';
      document.getElementById('update-state-current').style.display = 'flex';
      document.getElementById('update-state-checking').style.display = 'none';
      document.getElementById('update-state-available').style.display = 'none';
      
      const btn = document.getElementById('system-update-btn');
      btn.textContent = 'Check for Updates';
      btn.disabled = false;
      btn.classList.remove('update-now');
    }

    // ============ Today XP Detail ============
    function showTodayXPDetail() {
      document.getElementById('xp-detail-overlay').classList.add('show');
    }
    
    function hideTodayXPDetail() {
      document.getElementById('xp-detail-overlay').classList.remove('show');
    }

    function selectOption(type, value, el) {
      if (el.classList.contains('locked')) return;
      
      // 更新选中状态
      el.parentElement.querySelectorAll('.sheet-option').forEach(opt => opt.classList.remove('selected'));
      el.classList.add('selected');
      
      // 更新显示值
      if (type === 'ai-voice') {
        document.getElementById('current-ai-voice').textContent = value;
      } else if (type === 'language') {
        document.getElementById('current-language').textContent = value;
      } else if (type === 'screen-timeout') {
        document.getElementById('current-timeout').textContent = value;
      }
      
      // 关闭弹窗
      setTimeout(hideSettingsSheet, 300);
    }

    // ============ 背包Tab切换 ============
    function switchBackpackTab(tab, btn) {
      // 更新Tab按钮状态
      document.querySelectorAll('.backpack-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      
      // 切换内容
      document.getElementById('album-content').style.display = tab === 'album' ? 'block' : 'none';
      document.getElementById('stories-content').style.display = tab === 'stories' ? 'block' : 'none';
      document.getElementById('guide-content').style.display = tab === 'guide' ? 'grid' : 'none';
      document.getElementById('badges-content').style.display = tab === 'badges' ? 'grid' : 'none';
    }
    
    function filterAlbum(type, btn) {
      // 更新筛选按钮状态
      document.querySelectorAll('.album-filter').forEach(f => f.classList.remove('active'));
      if (btn) btn.classList.add('active');
      
      // 筛选内容
      const items = document.querySelectorAll('.album-grid .album-item');
      items.forEach(item => {
        if (type === 'all') {
          item.classList.remove('hidden');
        } else if (type === 'photos') {
          item.classList.toggle('hidden', !item.classList.contains('photo'));
        } else if (type === 'artworks') {
          item.classList.toggle('hidden', !item.classList.contains('artwork'));
        }
      });
    }
    
    function viewAllCreations() {
      hideAICard();
      hideAI();
      navigateTo('backpack-page');
      // 延迟执行筛选，确保页面已渲染
      setTimeout(() => {
        // 先确保在 Album tab
        const albumTab = document.querySelector('.backpack-tab');
        if (albumTab) switchBackpackTab('album', albumTab);
        // 选中 Artworks 筛选器
        setTimeout(() => {
          const filters = document.querySelectorAll('.album-filter');
          filters.forEach(f => f.classList.remove('active'));
          if (filters[2]) filters[2].classList.add('active');
          filterAlbum('artworks', filters[2]);
        }, 50);
      }, 100);
    }
    
    function viewAllBadges() {
      hideAICard();
      hideAI();
      navigateTo('backpack-page');
      // 延迟切换到 Badges tab
      setTimeout(() => {
        const tabs = document.querySelectorAll('.backpack-tab');
        if (tabs[2]) switchBackpackTab('badges', tabs[2]);
      }, 100);
    }

    // ============ 旋转木马状态 ============
    let currentIndex = 1; // 默认中间是 Camera (index 1)
    const totalCards = 6;
    const positions = ['pos-far-left', 'pos-left', 'pos-center', 'pos-right', 'pos-far-right'];
    
    // 初始化旋转木马
    function initCarousel() {
      updateCarouselPositions();
    }
    
    // 更新卡片位置
    function updateCarouselPositions() {
      const cards = document.querySelectorAll('#carousel .card');
      cards.forEach((card, index) => {
        // 移除所有位置类
        positions.forEach(pos => card.classList.remove(pos));
        card.classList.remove('pos-hidden');
        
        // 计算相对位置 (-2, -1, 0, 1, 2)
        let relativePos = index - currentIndex;
        
        // 处理循环 - 找最短路径
        if (relativePos > totalCards / 2) relativePos -= totalCards;
        if (relativePos < -totalCards / 2) relativePos += totalCards;
        
        // 添加对应位置类
        if (relativePos >= -2 && relativePos <= 2) {
          const posIndex = relativePos + 2; // 转换为 0-4
          card.classList.add(positions[posIndex]);
        } else {
          // 超出显示范围的卡片隐藏
          card.classList.add('pos-hidden');
        }
      });
    }
    
    // 旋转木马
    function rotateCarousel(direction) {
      currentIndex = (currentIndex + direction + totalCards) % totalCards;
      updateCarouselPositions();
    }
    
    // 卡片点击
    function handleCardClick(cardIndex) {
      // 计算相对位置
      let relativePos = cardIndex - currentIndex;
      if (relativePos > 2) relativePos -= totalCards;
      if (relativePos < -2) relativePos += totalCards;
      
      if (relativePos === 0) {
        // 中心卡片 - 进入页面
        const cards = document.querySelectorAll('#carousel .card');
        const pageId = cards[cardIndex].dataset.page;
        navigateTo(pageId);
      } else {
        // 非中心卡片 - 旋转
        rotateCarousel(relativePos);
      }
    }
    
    // 键盘控制
    document.addEventListener('keydown', (e) => {
      if (currentPage !== 'home-page') return;
      if (e.key === 'ArrowLeft') {
        rotateCarousel(-1);
      } else if (e.key === 'ArrowRight') {
        rotateCarousel(1);
      } else if (e.key === 'Enter') {
        const cards = document.querySelectorAll('#carousel .card');
        const pageId = cards[currentIndex].dataset.page;
        navigateTo(pageId);
      }
    });

    // ============ 页面状态 ============
    let currentPage = 'home-page';
    let currentAICharacter = '🤖';

    // 页面导航
    function navigateTo(pageId) {
      // 记录进入通知页前的页面
      if (pageId === 'notifications-page' && currentPage !== 'notifications-page') {
        previousPage = currentPage;
      }

      // 更新页面列表高亮
      document.querySelectorAll('.page-list-item').forEach(item => {
        item.classList.remove('active');
        // 精确匹配页面ID
        const onclickStr = item.getAttribute('onclick') || '';
        const match = onclickStr.match(/navigateTo\('([^']+)'\)/);
        if (match && match[1] === pageId) {
          item.classList.add('active');
        }
      });

      // 切换页面(目前只有首页,其他页面待添加)
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
      } else {
        // 如果页面不存在,显示首页并提示
        document.getElementById('home-page').classList.add('active');
        console.log('Page not yet implemented:', pageId);
      }
      
      currentPage = pageId;
      hideAI();
      hidePTT();
      
      // 进入story-page时重置页码，离开时停止朗读
      if (pageId === 'story-page') {
        currentStoryPage = 0;
        updateStoryPage();
      } else {
        // 离开story-page时停止朗读
        if (typeof stopStoryAudio === 'function') {
          stopStoryAudio();
        }
      }
      
      // 控制状态栏显示:只有首页显示状态栏
      const statusBar = document.querySelector('.status-bar');
      if (statusBar) {
        statusBar.style.display = (pageId === 'home-page') ? 'flex' : 'none';
      }
    }

    // AI 菜单
    function toggleAI() {
      const overlay = document.getElementById('ai-overlay');
      if (overlay.classList.contains('show')) {
        hideAI();
      } else {
        hidePTT();
        overlay.classList.add('show');
        updateAIMenu();
      }
    }

    function hideAI() {
      document.getElementById('ai-overlay').classList.remove('show');
    }

    // AI菜单配置 - 按v5版本
    const pageConfigs = {
      'home-page': {
        context: null,
        menu: [
          { icon: '🎯', label: 'Daily Quest', color: 'purple', action: 'dailyQuest' },
          { icon: '📖', label: 'Learn Something', color: 'blue', action: 'learnSomething' },
          { icon: '🏆', label: 'My Progress', color: 'yellow', action: 'myProgress' },
          { icon: '❓', label: 'Help', color: 'green', action: 'help' }
        ]
      },
      'camera-page': {
        context: { icon: '📷', label: 'Camera Mode' },
        menu: [
          { icon: '🔍', label: 'Identify This', color: 'purple', action: 'identifyThis' },
          { icon: '💡', label: 'Photo Tips', color: 'blue', action: 'photoTips' },
          { icon: '🎨', label: 'Add Effect', color: 'pink', action: 'addEffect' }
        ]
      },
      'photo-preview-page': {
        context: { icon: '🖼️', label: 'Photo Preview' },
        menu: [
          { icon: '🔍', label: 'What is This?', color: 'purple', action: 'whatIsThis' },
          { icon: '💬', label: 'Talk About It', color: 'blue', action: 'talkAboutIt' },
          { icon: '✨', label: 'Magic Art', color: 'pink', action: 'magicArt' },
          { icon: '📖', label: 'Tell Story', color: 'green', action: 'tellStory' }
        ]
      },
      'chat-page': {
        context: { icon: '💬', label: 'Photo Chat' },
        menu: [
          { icon: '🔄', label: 'New Topic', color: 'purple', action: 'newTopic' },
          { icon: '📖', label: 'Tell Story', color: 'blue', action: 'tellStory' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'general-chat-page': {
        context: { icon: '💬', label: 'Chat' },
        menu: [
          { icon: '🔄', label: 'New Topic', color: 'purple', action: 'newTopic' },
          { icon: '💡', label: 'Explore Ideas', color: 'blue', action: 'exploreIdeas' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'map-page': {
        context: { icon: '🗺️', label: 'Explorer Map' },
        menu: [
          { icon: '🧭', label: 'Guide Me', color: 'cyan', action: 'guideMe' },
          { icon: '💡', label: 'Explore Tips', color: 'blue', action: 'exploreTips' },
          { icon: '🏅', label: 'Rewards', color: 'yellow', action: 'rewards' }
        ]
      },
      'workshop-page': {
        context: { icon: '🎨', label: 'Workshop' },
        menu: [
          { icon: '✨', label: 'Surprise Me', color: 'purple', action: 'surpriseMe' },
          { icon: '🖼️', label: 'My Creations', color: 'pink', action: 'myCreations' },
          { icon: '💡', label: 'Get Ideas', color: 'yellow', action: 'getIdeas' }
        ]
      },
      'backpack-page': {
        context: { icon: '🎒', label: 'Backpack' },
        menu: [
          { icon: '⭐', label: 'Highlights', color: 'purple', action: 'highlights' },
          { icon: '📊', label: 'Stats', color: 'blue', action: 'stats' },
          { icon: '🎯', label: 'Next Goal', color: 'green', action: 'nextGoal' }
        ]
      },
      'species-list-page': {
        context: { icon: '📖', label: 'Field Guide' },
        menu: [
          { icon: '🎲', label: 'Random Challenge', color: 'purple', action: 'randomChallenge' },
          { icon: '💡', label: 'Fun Fact', color: 'blue', action: 'funFact' },
          { icon: '🎯', label: 'Quiz Challenge', color: 'orange', action: 'quizChallenge' }
        ]
      },
      'species-detail-page': {
        context: { icon: '🦋', label: 'Species Detail' },
        menu: [
          { icon: '💡', label: 'More Facts', color: 'purple', action: 'moreFacts' },
          { icon: '🔗', label: 'Related', color: 'blue', action: 'related' },
          { icon: '🎯', label: 'Quiz Me', color: 'orange', action: 'quizMe' }
        ]
      },
      'photo-effect-page': {
        context: { icon: '✨', label: 'Choose Style' },
        menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
        isGeneric: true
      },
      'workshop-photo-page': {
        context: { icon: '📷', label: 'Select Photo' },
        menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
        isGeneric: true
      }
    };

    // 默认配置
    const defaultConfig = {
      context: { icon: '✨', label: 'AI Assistant' },
      menu: [{ icon: '🎤', label: 'Ask AI', color: 'purple', action: 'askAI' }],
      isGeneric: true
    };

    function updateAIMenu() {
      const config = pageConfigs[currentPage] || defaultConfig;
      const contextBadge = document.getElementById('ai-context-badge');
      const menuGrid = document.getElementById('ai-menu-grid');
      
      // 更新上下文徽章
      if (config.context) {
        contextBadge.innerHTML = `<span>${config.context.icon}</span><span>${config.context.label}</span>`;
        contextBadge.style.display = 'inline-flex';
      } else {
        contextBadge.style.display = 'none';
      }
      
      // 通用助手显示不同UI
      if (config.isGeneric) {
        menuGrid.innerHTML = `
          <div class="ai-generic-row">
            <div class="ai-generic-avatar">🤖</div>
            <div class="ai-generic-text">"Need help?"</div>
            <button class="ai-generic-btn" onclick="handleAIAction('askAI')">
              🎤 Voice Chat
            </button>
          </div>
        `;
      } else {
        // 更新菜单项
        menuGrid.innerHTML = config.menu.map(item => `
          <div class="ai-menu-item" onclick="handleAIAction('${item.action}')">
            <div class="ai-menu-icon ${item.color}">${item.icon}</div>
            <div class="ai-menu-label">${item.label}</div>
          </div>
        `).join('');
      }
    }

    // Quiz Challenge 交互
    let quizScore = 0;
    let quizQuestion = 1;
    
    function selectQuizAnswer(element, isCorrect) {
      // 禁用所有选项
      const options = element.parentElement.querySelectorAll('.quiz-option');
      options.forEach(opt => opt.classList.add('disabled'));
      
      // 标记正确/错误
      if (isCorrect) {
        element.classList.add('correct');
        element.innerHTML += ' ✓';
        quizScore++;
      } else {
        element.classList.add('wrong');
        // 找到正确答案并标记
        options.forEach(opt => {
          if (opt.onclick && opt.onclick.toString().includes('true')) {
            opt.classList.add('correct');
          }
        });
      }
      
      // 显示反馈
      const feedback = document.getElementById('quiz-feedback');
      if (feedback) {
        feedback.style.display = 'block';
        feedback.innerHTML = isCorrect 
          ? '<div style="background: #D1FAE5; color: #059669; padding: 10px; border-radius: 10px; text-align: center; font-weight: 600;">✅ Correct! +2 XP</div>'
          : '<div style="background: #FEE2E2; color: #DC2626; padding: 10px; border-radius: 10px; text-align: center; font-weight: 600;">❌ Not quite! The answer is B</div>';
      }
      
      // 显示下一题按钮
      const footer = document.getElementById('quiz-footer');
      if (footer) {
        footer.style.display = 'flex';
        if (quizQuestion >= 3) {
          footer.innerHTML = `<button class="ai-card-btn primary" onclick="showQuizResult()">See Results 🏆</button>`;
        }
      }
    }
    
    function nextQuizQuestion() {
      quizQuestion++;
      // 简化版：显示下一题（实际应从题库随机）
      const cardBody = document.querySelector('.ai-card-overlay .ai-card-body');
      if (cardBody) {
        const questions = [
          { q: 'What do butterflies taste with?', a: 'B', opts: ['A) Their tongue', 'B) Their feet', 'C) Their wings'] },
          { q: 'How many hearts does an octopus have?', a: 'C', opts: ['A) One', 'B) Two', 'C) Three'] }
        ];
        const qData = questions[quizQuestion - 2] || questions[0];
        cardBody.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <span style="font-size: 12px; color: #888;">Question ${quizQuestion} of 3</span>
            <span style="font-size: 12px; color: #F59E0B; font-weight: 600;">🏆 Score: ${quizScore * 2} XP</span>
          </div>
          <div style="font-size: 15px; font-weight: 600; color: #333; margin-bottom: 14px;">${qData.q}</div>
          <div class="quiz-option" onclick="selectQuizAnswer(this, ${qData.a === 'A'})">${qData.opts[0]}</div>
          <div class="quiz-option" onclick="selectQuizAnswer(this, ${qData.a === 'B'})">${qData.opts[1]}</div>
          <div class="quiz-option" onclick="selectQuizAnswer(this, ${qData.a === 'C'})">${qData.opts[2]}</div>
          <div id="quiz-feedback" style="margin-top: 12px; display: none;"></div>
        `;
      }
      document.getElementById('quiz-footer').style.display = 'none';
    }
    
    function showQuizResult() {
      const overlay = document.querySelector('.ai-card-overlay');
      if (overlay) {
        overlay.innerHTML = `
          <div class="ai-card">
            <div class="ai-card-header">
              <div class="ai-card-title"><span class="ai-card-title-icon">🏆</span>Quiz Complete!</div>
              <button class="ai-card-close" onclick="hideAICard(); quizScore=0; quizQuestion=1;">✕</button>
            </div>
            <div class="ai-card-body" style="text-align: center; padding: 20px 0;">
              <div style="font-size: 64px; margin-bottom: 16px;">${quizScore === 3 ? '🎉' : quizScore >= 2 ? '👏' : '💪'}</div>
              <div style="font-size: 24px; font-weight: 700; color: #333; margin-bottom: 8px;">${quizScore}/3 Correct!</div>
              <div style="font-size: 18px; color: #F59E0B; font-weight: 600; margin-bottom: 16px;">+${quizScore * 2} XP earned</div>
              <div style="font-size: 14px; color: #888;">${quizScore === 3 ? 'Perfect score! You\'re amazing!' : quizScore >= 2 ? 'Great job! Keep learning!' : 'Good try! Practice makes perfect!'}</div>
            </div>
            <div class="ai-card-footer">
              <button class="ai-card-btn secondary" onclick="hideAICard(); quizScore=0; quizQuestion=1;">Done</button>
              <button class="ai-card-btn primary" onclick="quizScore=0; quizQuestion=1; showAICard('quizChallenge');">Try Again 🔄</button>
            </div>
          </div>
        `;
      }
    }

    // Story Page 交互
    const storyPages = [
      { image: '🐞', text: 'Once upon a time, in a sunny garden filled with colorful flowers, there lived a tiny ladybug named Ruby. 🐞' },
      { image: '🌻', text: 'Ruby had the brightest red shell with exactly seven spots - one for each day of the week! She loved to explore the garden.' },
      { image: '✨', text: 'One morning, Ruby discovered something amazing - a magical dewdrop that sparkled like a diamond! ✨' },
      { image: '🦋', text: '"What a wonderful treasure!" Ruby exclaimed. She decided to share it with all her friends in the garden.' },
      { image: '🌈', text: 'And from that day on, Ruby became known as the kindest ladybug in the whole garden. The End! 🌻' }
    ];
    let currentStoryPage = 0;
    
    function updateStoryPage() {
      const page = storyPages[currentStoryPage];
      document.getElementById('story-image').textContent = page.image;
      document.getElementById('story-text').textContent = page.text;
      document.getElementById('story-page-num').textContent = currentStoryPage + 1;
      
      // 更新dots
      const dots = document.getElementById('story-dots').children;
      for (let i = 0; i < dots.length; i++) {
        dots[i].style.background = i === currentStoryPage ? '#6366F1' : '#ddd';
      }
      
      // 更新按钮状态
      const prevBtn = document.getElementById('story-prev-btn');
      const nextBtn = document.getElementById('story-next-btn');
      
      prevBtn.disabled = currentStoryPage === 0;
      prevBtn.style.opacity = currentStoryPage === 0 ? '0.5' : '1';
      
      if (currentStoryPage === storyPages.length - 1) {
        nextBtn.innerHTML = '<span>Done</span><span>✓</span>';
        nextBtn.onclick = function() { saveStory(); navigateTo('backpack-page'); };
      } else {
        nextBtn.innerHTML = '<span>Next</span><span>→</span>';
        nextBtn.onclick = storyNextPage;
      }
    }
    
    function storyPrevPage() {
      if (currentStoryPage > 0) {
        stopStoryAudio();
        currentStoryPage--;
        updateStoryPage();
      }
    }
    
    function storyNextPage() {
      if (currentStoryPage < storyPages.length - 1) {
        stopStoryAudio();
        currentStoryPage++;
        updateStoryPage();
      }
    }
    
    function stopStoryAudio() {
      if (isStoryPlaying) {
        window.speechSynthesis.cancel();
        isStoryPlaying = false;
        const btn = document.getElementById('story-audio-btn');
        if (btn) {
          btn.textContent = '🔊';
          btn.style.background = 'linear-gradient(135deg, #F59E0B, #D97706)';
        }
      }
    }
    
    function saveStory() {
      // 显示保存成功提示
      const toast = document.createElement('div');
      toast.style.cssText = 'position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 20px; font-size: 14px; z-index: 9999;';
      toast.textContent = '✅ Story saved to Backpack!';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }
    
    let isStoryPlaying = false;
    let storyUtterance = null;
    
    function toggleStoryAudio() {
      const btn = document.getElementById('story-audio-btn');
      
      if (isStoryPlaying) {
        // 停止朗读
        window.speechSynthesis.cancel();
        isStoryPlaying = false;
        btn.textContent = '🔊';
        btn.style.background = 'linear-gradient(135deg, #F59E0B, #D97706)';
      } else {
        // 开始朗读当前页
        const text = storyPages[currentStoryPage].text;
        storyUtterance = new SpeechSynthesisUtterance(text);
        storyUtterance.lang = 'en-US';
        storyUtterance.rate = 0.9;
        
        storyUtterance.onend = function() {
          isStoryPlaying = false;
          btn.textContent = '🔊';
          btn.style.background = 'linear-gradient(135deg, #F59E0B, #D97706)';
        };
        
        window.speechSynthesis.speak(storyUtterance);
        isStoryPlaying = true;
        btn.textContent = '⏸️';
        btn.style.background = 'linear-gradient(135deg, #EF4444, #DC2626)';
      }
    }

    function handleAIAction(action) {
      // 跳转类action
      switch(action) {
        case 'talkAboutIt':
          hideAI();
          navigateTo('chat-page');
          return;
        case 'magicArt':
          hideAI();
          navigateTo('photo-effect-page');
          return;
        case 'askAI':
          hideAI();
          togglePTT();
          return;
      }
      // 其他action显示卡片
      showAICard(action);
    }
    
    function hideAICard() {
      document.getElementById('ai-card-overlay').classList.remove('show');
      // 重置Quiz状态
      quizScore = 0;
      quizQuestion = 1;
    }
    
    function showAICard(action) {
      const cardContent = getCardContent(action);
      if (!cardContent) {
        alert('AI Action: ' + action);
        return;
      }
      document.getElementById('ai-card').innerHTML = cardContent;
      document.getElementById('ai-card-overlay').classList.add('show');
    }
    
    function getCardContent(action) {
      const cards = {
        'dailyQuest': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Today's Quests</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="task-list-item">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #FEE2E2, #FECACA);">🌸</div>
              <div class="task-list-content">
                <div class="task-list-title">Find a Flower</div>
                <div class="task-list-desc">Look for colorful blooms</div>
              </div>
              <button class="task-list-action" onclick="hideAICard(); hideAI(); navigateTo('map-page');">Go →</button>
            </div>
            <div class="task-list-item">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">🦋</div>
              <div class="task-list-content">
                <div class="task-list-title">Spot a Butterfly</div>
                <div class="task-list-desc">They love sunny spots</div>
              </div>
              <button class="task-list-action" onclick="hideAICard(); hideAI(); navigateTo('map-page');">Go →</button>
            </div>
            <div class="task-list-item completed">
              <div class="task-list-icon" style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0);">🪨</div>
              <div class="task-list-content">
                <div class="task-list-title">Cool Rock Hunt</div>
                <div class="task-list-desc">Completed!</div>
              </div>
              <span class="task-list-done">✓</span>
            </div>
          </div>
          <div class="ai-card-footer">
            <span style="flex:1; font-size:13px; color:#888;">🎉 2/3 completed</span>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('map-page');">See Map →</button>
          </div>
        `,
        
        'dailyQuestEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Today's Quests</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">☀️</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">No quests yet today!</div>
            <div style="font-size: 14px; color: #888; margin-bottom: 16px;">New quests arrive at 8:00 AM every morning</div>
            <div style="background: #f0f9ff; border-radius: 12px; padding: 14px;">
              <div style="font-size: 12px; font-weight: 600; color: #0369a1; margin-bottom: 4px;">💡 While you wait:</div>
              <div style="font-size: 13px; color: #555;">Try free exploration! 📷</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Start Exploring 📷</button>
          </div>
        `,
        
        'learnSomething': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📖</span>Did You Know?</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="fact-card">
              <div class="fact-icon">🐞</div>
              <div class="fact-species">Ladybug</div>
              <div class="fact-text">Ladybugs can eat 5,000 bugs in their lifetime!</div>
              <div class="fact-analogy">🍕 That's like you eating 50 pizzas every day for a year!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard()">🔄 Another</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Tell More</button>
          </div>
        `,
        
        'learnSomethingEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📖</span>Did You Know?</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">🔍</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">Take your first photo to unlock fun facts!</div>
            <div style="font-size: 14px; color: #888;">Every discovery comes with cool things to learn 🌟</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Open Camera 📷</button>
          </div>
        `,
        
        'myProgress': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🏆</span>My Explorer Journey</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="progress-section">
              <div class="progress-avatar">🧒</div>
              <div class="progress-level">Junior Explorer</div>
              <div class="progress-bar-container"><div class="progress-bar-fill" style="width: 60%;"></div></div>
              <div class="progress-text">3/5 to Intermediate Explorer</div>
            </div>
            <div class="stats-row">
              <div class="stat-item"><div class="stat-number">42</div><div class="stat-label">📷 photos</div></div>
              <div class="stat-item"><div class="stat-number">12</div><div class="stat-label">🦋 species</div></div>
              <div class="stat-item"><div class="stat-number">8</div><div class="stat-label">🎯 quests</div></div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="viewAllBadges()">View All Badges →</button>
          </div>
        `,
        
        'help': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">❓</span>Help Center</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="help-list-item"><div class="help-list-icon">🎬</div><div class="help-list-content"><div class="help-list-title">Quick Tour</div><div class="help-list-desc">Learn the basics (30s)</div></div></div>
            <div class="help-list-item"><div class="help-list-icon">🎤</div><div class="help-list-content"><div class="help-list-title">Voice Commands</div><div class="help-list-desc">Talk to your Explorer</div></div></div>
            <div class="help-list-item"><div class="help-list-icon">📷</div><div class="help-list-content"><div class="help-list-title">Photo Tips</div><div class="help-list-desc">Take amazing shots</div></div></div>
            <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0;">
              <div style="font-size: 13px; color: #888; margin-bottom: 10px;">💬 Or ask me anything!</div>
              <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); togglePTT();">🎤 Start Voice Chat</button>
            </div>
          </div>
        `,
        
        'identifyThis': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔍</span>I Found Something!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="identify-result">
              <div class="identify-thumb">🐞</div>
              <div class="identify-name">Ladybug</div>
              <div class="identify-scientific">Coccinellidae</div>
              <div class="identify-desc">A tiny beetle with spots! They eat pesky garden bugs and are super helpful. 🌱</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard(); hideAI(); takePhoto();">📷 Save Photo</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Learn More</button>
          </div>
        `,
        
        'photoTips': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Photo Tips</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status good">☀️</div><div class="tip-content"><div class="tip-title">Light Check</div><div class="tip-desc">Good lighting! Nice job!</div></div></div>
            <div class="tip-item"><div class="tip-status improve">🎯</div><div class="tip-content"><div class="tip-title">Get Closer</div><div class="tip-desc">Move in to fill the frame</div></div></div>
            <div class="tip-item"><div class="tip-status good">📐</div><div class="tip-content"><div class="tip-title">Hold Steady</div><div class="tip-desc">Nice and steady!</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard()">Got It! 👍</button>
          </div>
        `,
        
        'addEffect': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎨</span>Effects</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="effect-grid">
              <div class="effect-item active"><div class="effect-item-icon">⚪</div><div class="effect-item-name">None</div></div>
              <div class="effect-item"><div class="effect-item-icon">✨</div><div class="effect-item-name">Dreamy</div></div>
              <div class="effect-item"><div class="effect-item-icon">🌅</div><div class="effect-item-name">Warm</div></div>
              <div class="effect-item"><div class="effect-item-icon">❄️</div><div class="effect-item-name">Cool</div></div>
              <div class="effect-item"><div class="effect-item-icon">📷</div><div class="effect-item-name">Vintage</div></div>
              <div class="effect-item"><div class="effect-item-icon">🎨</div><div class="effect-item-name">Pop!</div></div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard()">Apply</button>
          </div>
        `,
        
        'whatIsThis': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔍</span>I Found It!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="identify-result">
              <div class="identify-name">🐞 Ladybug</div>
              <div class="identify-scientific">Coccinellidae</div>
              <div class="identify-desc">A helpful garden beetle with spots! 🌱</div>
              <div class="identify-badge">📖 Added to your Field Guide!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Ask More</button>
            <button class="ai-card-btn primary" onclick="hideAICard()">Got It! 👍</button>
          </div>
        `,
        
        'learnMore': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📚</span>Fun Facts</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status" style="background: #E0E7FF;">🔢</div><div class="tip-content"><div class="tip-title">Spots aren't their age!</div><div class="tip-desc">Different species have different numbers.</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #FEE2E2;">🛡️</div><div class="tip-content"><div class="tip-title">Spots warn predators!</div><div class="tip-desc">"Stay away, I taste bad!"</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #D1FAE5;">❄️</div><div class="tip-content"><div class="tip-title">They hibernate together!</div><div class="tip-desc">Thousands cuddle up in winter.</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 More Facts</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Discuss</button>
          </div>
        `,
        
        'newTopic': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔄</span>New Topic</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; color: #555; margin-bottom: 12px;">What should we talk about?</div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🔍</div><div class="topic-text">Something else in the photo</div></div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🌍</div><div class="topic-text">Where this creature lives</div></div>
            <div class="topic-item" onclick="hideAICard(); hideAI();"><div class="topic-icon">🎲</div><div class="topic-text">Surprise me!</div></div>
          </div>
        `,
        
        'tellStory': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📖</span>Create a Story</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; color: #555; margin-bottom: 12px;">Let's make a story about your discovery!</div>
            <div class="story-option" onclick="hideAICard(); hideAI(); navigateTo('story-page');"><div class="story-option-icon adventure">🦸</div><div class="story-option-content"><div class="story-option-title">Adventure Story</div><div class="story-option-desc">An exciting journey!</div></div></div>
            <div class="story-option" onclick="hideAICard(); hideAI(); navigateTo('story-page');"><div class="story-option-icon bedtime">😴</div><div class="story-option-content"><div class="story-option-title">Bedtime Story</div><div class="story-option-desc">Calm and cozy</div></div></div>
            <div class="story-option" onclick="hideAICard(); hideAI(); navigateTo('story-page');"><div class="story-option-icon funny">😂</div><div class="story-option-content"><div class="story-option-title">Funny Story</div><div class="story-option-desc">Silly and giggly!</div></div></div>
          </div>
        `,
        
        'exploreIdeas': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Explore Ideas</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 13px; color: #555; margin-bottom: 12px;">What would you like to chat about?</div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <div style="display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #e0f2fe, #bae6fd); border-radius: 12px; padding: 12px; cursor: pointer;" onclick="hideAICard(); hideAI();">
                <span style="font-size: 24px;">🌤️</span>
                <div>
                  <div style="font-size: 13px; font-weight: 600; color: #0369a1;">Weather Wonders</div>
                  <div style="font-size: 11px; color: #0284c7;">Why is the sky blue?</div>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; padding: 12px; cursor: pointer;" onclick="hideAICard(); hideAI();">
                <span style="font-size: 24px;">🐜</span>
                <div>
                  <div style="font-size: 13px; font-weight: 600; color: #92400e;">Tiny Creatures</div>
                  <div style="font-size: 11px; color: #b45309;">How do ants find food?</div>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-radius: 12px; padding: 12px; cursor: pointer;" onclick="hideAICard(); hideAI();">
                <span style="font-size: 24px;">🌱</span>
                <div>
                  <div style="font-size: 13px; font-weight: 600; color: #166534;">Plant Secrets</div>
                  <div style="font-size: 11px; color: #15803d;">How do seeds grow?</div>
                </div>
              </div>
            </div>
            <div style="text-align: center; margin-top: 12px; font-size: 12px; color: #888;">💬 Or just ask me anything!</div>
          </div>
        `,
        
        'quizChallenge': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Quiz Challenge</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <span style="font-size: 12px; color: #888;">Question 1 of 3</span>
              <span style="font-size: 12px; color: #F59E0B; font-weight: 600;">🏆 +2 XP each</span>
            </div>
            <div style="font-size: 15px; font-weight: 600; color: #333; margin-bottom: 14px;">How many spots does a ladybug usually have?</div>
            <div class="quiz-option" onclick="selectQuizAnswer(this, false)">A) Exactly 7 spots</div>
            <div class="quiz-option" onclick="selectQuizAnswer(this, true)">B) It varies by species</div>
            <div class="quiz-option" onclick="selectQuizAnswer(this, false)">C) Always 10 spots</div>
            <div id="quiz-feedback" style="margin-top: 12px; display: none;"></div>
          </div>
          <div class="ai-card-footer" id="quiz-footer" style="display: none;">
            <button class="ai-card-btn primary" onclick="nextQuizQuestion()">Next Question →</button>
          </div>
        `,
        
        'exploreTips': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Explore Tips</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="text-align: center; margin-bottom: 16px;">
              <div style="font-size: 32px; margin-bottom: 8px;">🌤️</div>
              <div style="font-size: 15px; font-weight: 600; color: #333;">It's sunny today!</div>
            </div>
            <div style="font-size: 13px; color: #555; margin-bottom: 10px;">Perfect for:</div>
            <div class="tip-item"><div class="tip-status" style="background: #FEF3C7;">🦋</div><div class="tip-content"><div class="tip-title">Spotting butterflies</div><div class="tip-desc">They love warm sunny days!</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #FEE2E2;">🌸</div><div class="tip-content"><div class="tip-title">Finding blooming flowers</div><div class="tip-desc">Colors pop in good light</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #E0E7FF;">🪨</div><div class="tip-content"><div class="tip-title">Checking out rocks</div><div class="tip-desc">Shadows show cool patterns</div></div></div>
            <div style="background: #f0f9ff; border-radius: 12px; padding: 12px; margin-top: 12px;">
              <div style="font-size: 12px; color: #0369a1;">⏰ <strong>Best time:</strong> 10am - 2pm</div>
              <div style="font-size: 12px; color: #0369a1; margin-top: 4px;">💡 <strong>Tip:</strong> Look near flowers for insects!</div>
            </div>
          </div>
        `,
        
        'rewards': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🏅</span>Quest Rewards</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <!-- 今日任务奖励列表 -->
            <div style="font-size: 11px; color: #888; margin-bottom: 8px;">Today's Quests (2/3 done)</div>
            <div style="display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px;">
              <div style="display: flex; align-items: center; gap: 8px; background: #f0fdf4; border-radius: 10px; padding: 8px 10px;">
                <span style="font-size: 16px;">🌸</span>
                <div style="flex: 1; font-size: 12px; color: #333;">Find a Flower</div>
                <span style="font-size: 11px; color: #22c55e; font-weight: 600;">+10 XP ✓</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; background: #f0fdf4; border-radius: 10px; padding: 8px 10px;">
                <span style="font-size: 16px;">🦋</span>
                <div style="flex: 1; font-size: 12px; color: #333;">Spot an Insect</div>
                <span style="font-size: 11px; color: #22c55e; font-weight: 600;">+15 XP ✓</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; background: #fef3c7; border-radius: 10px; padding: 8px 10px;">
                <span style="font-size: 16px;">🪨</span>
                <div style="flex: 1; font-size: 12px; color: #333;">Discover a Rock</div>
                <span style="font-size: 11px; color: #F59E0B; font-weight: 600;">+20 XP</span>
              </div>
            </div>
            
            <!-- 全部完成奖励 -->
            <div style="background: linear-gradient(135deg, #EEF2FF, #E0E7FF); border-radius: 10px; padding: 10px; margin-bottom: 10px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 20px;">🎁</span>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 600; color: #4338CA;">Complete All Bonus</div>
                  <div style="font-size: 11px; color: #6366F1;">+25 XP extra reward!</div>
                </div>
              </div>
            </div>
            
            <!-- 可解锁徽章 -->
            <div style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 10px; padding: 10px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 20px;">🏆</span>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 600; color: #92400E;">Badge Progress</div>
                  <div style="font-size: 11px; color: #B45309;">2 more days → "Explorer" badge!</div>
                </div>
              </div>
            </div>
          </div>
        `,
        
        'guideMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🧭</span>Explorer Guide</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="guide-speech"><div class="guide-avatar">🦊</div><div class="guide-text">"Great timing! This one looks perfect for now!"</div></div>
            <div style="background: #f9f9f9; border-radius: 14px; padding: 14px; margin-top: 12px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 24px;">🌸</span>
                <div>
                  <div style="font-size: 15px; font-weight: 600; color: #333;">Find a Flower</div>
                  <div style="font-size: 12px; color: #888;">Look for colorful blooms nearby</div>
                </div>
              </div>
              <div style="display: flex; gap: 12px; font-size: 12px; color: #666;">
                <span>☀️ Weather: Perfect</span>
                <span>⭐ +10 XP</span>
              </div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Another</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('map-page');">Let's Go! 🚀</button>
          </div>
        `,
        
        'guideMeEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🧭</span>Explorer Guide</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">🎉</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">All quests completed!</div>
            <div style="font-size: 14px; color: #888; margin-bottom: 4px;">Amazing work today!</div>
            <div style="font-size: 13px; color: #666;">New quests arrive tomorrow at 8:00 AM ☀️</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="showAICard('exploreTips');">Check Explore Tips 💡</button>
          </div>
        `,
        
        'surpriseMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">✨</span>Surprise Combo!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="surprise-combo"><div class="surprise-photo">🌻</div><div class="surprise-plus">+</div><div class="surprise-style">🏔️ Ghibli</div></div>
            <div class="surprise-hint">🎲 Random picks just for you!</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Shuffle</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); showAigcModal();">✨ Create!</button>
          </div>
        `,
        
        'myCreations': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🖼️</span>My Creations</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🐞
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🏔️</div>
              </div>
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🦋
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">👾</div>
              </div>
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #fce7f3, #fbcfe8); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🌻
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🎨</div>
              </div>
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #d1fae5, #a7f3d0); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🍄
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🏔️</div>
              </div>
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #e0e7ff, #c7d2fe); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🐸
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">👾</div>
              </div>
              <div style="aspect-ratio: 1; background: linear-gradient(135deg, #fef9c3, #fef08a); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative;">
                🌸
                <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px 4px; font-size: 8px; color: white;">🎨</div>
              </div>
            </div>
            <div style="text-align: center; font-size: 12px; color: #888;">12 creations total</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="viewAllCreations()">View All →</button>
          </div>
        `,
        
        'myCreationsEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🖼️</span>My Creations</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 16px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">✨</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">No creations yet!</div>
            <div style="font-size: 14px; color: #888; margin-bottom: 16px;">Turn your photos into amazing AI art 🎨</div>
            <div style="display: flex; justify-content: center; gap: 12px;">
              <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #bfdbfe, #93c5fd); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">🏔️</div>
              <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #c7d2fe, #a5b4fc); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">👾</div>
              <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #fbcfe8, #f9a8d4); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">🎨</div>
            </div>
            <div style="font-size: 11px; color: #888; margin-top: 8px;">Ghibli · Pixel · Oil Paint</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('workshop-page');">Create First Art ✨</button>
          </div>
        `,
        
        'getIdeas': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Creation Ideas</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="guide-speech"><div class="guide-avatar">🎨</div><div class="guide-text">"Try turning your bug photos into pixel art! 👾"</div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Another Idea</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('photo-effect-page');">Try This! ✨</button>
          </div>
        `,
        
        'highlights': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">⭐</span>This Week's Highlights</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="margin-bottom: 10px;">
              <div style="font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px;">🏆 Biggest Discovery</div>
              <div style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 10px; padding: 10px; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">🦋</span>
                <div>
                  <div style="font-size: 13px; font-weight: 600; color: #92400E;">Monarch Butterfly</div>
                  <div style="font-size: 10px; color: #B45309;">First rare find! ⭐⭐⭐</div>
                </div>
              </div>
            </div>
            <div style="margin-bottom: 10px;">
              <div style="font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px;">📸 Best Shot</div>
              <div style="background: #f0f9ff; border-radius: 10px; padding: 10px; display: flex; align-items: center; gap: 10px;">
                <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">🐞</div>
                <div style="font-size: 12px; color: #0369a1;">Used in 3 AI creations!</div>
              </div>
            </div>
            <div>
              <div style="font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px;">🔥 Streak Record</div>
              <div style="background: #fef2f2; border-radius: 10px; padding: 10px; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">🔥</span>
                <div>
                  <div style="font-size: 13px; font-weight: 600; color: #991B1B;">7 days in a row!</div>
                  <div style="font-size: 10px; color: #B91C1C;">Your longest streak! 🎉</div>
                </div>
              </div>
            </div>
          </div>
          <div class="ai-card-footer" style="background: #f9f9f9; border-radius: 0 0 16px 16px; padding: 10px 14px;">
            <span style="font-size: 12px; color: #888;">This Week: 12📷 3🦋 2✨ 5🎯</span>
          </div>
        `,
        
        'highlightsEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">⭐</span>This Week's Highlights</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 16px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">🌱</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">Your week is just starting!</div>
            <div style="font-size: 14px; color: #888; margin-bottom: 16px;">Go explore and create some highlights ✨</div>
            <div style="background: #f0f9ff; border-radius: 12px; padding: 14px; text-align: left;">
              <div style="font-size: 12px; font-weight: 600; color: #0369a1; margin-bottom: 8px;">💡 Ideas to try:</div>
              <div style="font-size: 13px; color: #555; line-height: 1.8;">
                • Take 3 photos<br>
                • Discover a new species<br>
                • Create AI art
              </div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Let's Go! 🚀</button>
          </div>
        `,
        
        'stats': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">📊</span>My Explorer Stats</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="stats-row">
              <div class="stat-item"><div class="stat-number">156</div><div class="stat-label">📷 photos</div></div>
              <div class="stat-item"><div class="stat-number">28</div><div class="stat-label">🦋 species</div></div>
              <div class="stat-item"><div class="stat-number">42</div><div class="stat-label">🎯 quests</div></div>
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span style="font-size: 12px; color: #555;">🏅 Badges: 8/15</span>
                <span style="font-size: 11px; color: #888;">53%</span>
              </div>
              <div style="background: #e5e7eb; border-radius: 8px; height: 6px; overflow: hidden;">
                <div style="background: linear-gradient(90deg, #F59E0B, #FBBF24); width: 53%; height: 100%; border-radius: 8px;"></div>
              </div>
              <div style="font-size: 10px; color: #888; margin-top: 3px;">Next: 🔬 Scientist (2 more!)</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
              <div><span style="font-size: 12px; color: #555;">✨ Creations:</span> <span style="font-weight: 600;">24</span></div>
              <div style="font-size: 11px; color: #888;">🎨 Ghibli</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px;">
              <div><span style="font-size: 12px; color: #555;">🔥 Streak:</span> <span style="font-weight: 600;">7 days</span></div>
              <div style="font-size: 11px; color: #888;">📅 Best: 12</div>
            </div>
            <div style="background: #f0fdf4; border-radius: 10px; padding: 10px; margin-top: 10px; text-align: center;">
              <div style="font-size: 11px; color: #166534;">🚀 Explorer since Mar 2024 · 127 days!</div>
            </div>
          </div>
        `,
        
        'nextGoal': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Next Goal</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 12px; color: #888; margin-bottom: 10px;">Based on your progress...</div>
            
            <!-- 推荐目标卡片 -->
            <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; padding: 14px; margin-bottom: 12px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.6); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">🔬</div>
                <div>
                  <div style="font-size: 14px; font-weight: 700; color: #92400E;">Scientist Badge</div>
                  <div style="font-size: 11px; color: #B45309;">Discover 2 more insects</div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span style="font-size: 11px; color: #92400E;">Progress: 8/10</span>
                <span style="font-size: 11px; color: #B45309;">80%</span>
              </div>
              <div style="background: rgba(255,255,255,0.5); border-radius: 6px; height: 6px; overflow: hidden;">
                <div style="background: #F59E0B; width: 80%; height: 100%; border-radius: 6px;"></div>
              </div>
            </div>
            
            <!-- 提示 -->
            <div style="background: #f0f9ff; border-radius: 10px; padding: 10px; display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 16px;">💡</span>
              <div style="font-size: 12px; color: #0369a1;">Tip: Look under rocks and leaves for insects!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary" onclick="hideAICard();">Got it 👍</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Let's Hunt! 📷</button>
          </div>
        `,
        
        'randomChallenge': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎲</span>Random Challenge</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="text-align: center; margin-bottom: 16px;">
              <div style="font-size: 48px; margin-bottom: 8px;">🐞</div>
              <div style="font-size: 15px; font-weight: 600; color: #333;">You found Ladybug before!</div>
            </div>
            <div style="background: #f9f9f9; border-radius: 12px; padding: 14px; margin-bottom: 12px;">
              <div style="font-size: 14px; color: #555; font-weight: 600; margin-bottom: 6px;">🎯 Challenge:</div>
              <div style="font-size: 13px; color: #666;">Can you find another one today and compare the spots?</div>
            </div>
            <div style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 12px; padding: 12px; text-align: center;">
              <div style="font-size: 13px; font-weight: 600; color: #92400E;">🎯 Reward: +10 XP if you do!</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Different One</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Accept 🎯</button>
          </div>
        `,
        
        'randomChallengeEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎲</span>Random Challenge</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body" style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 12px;">🔍</div>
            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 6px;">Discover something first!</div>
            <div style="font-size: 14px; color: #888;">Take a photo and identify it to unlock challenges 🎯</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Start Exploring 📷</button>
          </div>
        `,
        
        'funFact': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>Fun Fact</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="fact-card">
              <div class="fact-icon">🌻</div>
              <div class="fact-text">Sunflowers always face the sun! ☀️</div>
            </div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn secondary">🔄 Another</button>
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Ask More</button>
          </div>
        `,
        
        'moreFacts': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">💡</span>More Facts</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div class="tip-item"><div class="tip-status" style="background: #FEE2E2;">🎨</div><div class="tip-content"><div class="tip-title">Many colors!</div><div class="tip-desc">Not just red - yellow, orange too!</div></div></div>
            <div class="tip-item"><div class="tip-status" style="background: #D1FAE5;">🍽️</div><div class="tip-content"><div class="tip-title">50 aphids a day</div><div class="tip-desc">That's like 50 hamburgers!</div></div></div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('chat-page');">💬 Discuss</button>
          </div>
        `,
        
        'related': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔗</span>Related Species</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 13px; color: #888; margin-bottom: 10px;">Other Insects you've found:</div>
            <div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 16px;">
              <div style="text-align: center;">
                <div style="width: 50px; height: 50px; background: #f0f9f0; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 4px;">🦋</div>
                <div style="font-size: 10px; color: #555;">Butterfly</div>
              </div>
              <div style="text-align: center;">
                <div style="width: 50px; height: 50px; background: #fef9f0; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 4px;">🐝</div>
                <div style="font-size: 10px; color: #555;">Bee</div>
              </div>
              <div style="text-align: center;">
                <div style="width: 50px; height: 50px; background: #f0f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 4px;">🦗</div>
                <div style="font-size: 10px; color: #555;">Cricket</div>
              </div>
            </div>
            <div style="font-size: 13px; color: #888; margin-bottom: 8px;">Other Insects to discover:</div>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              <span style="background: #f5f5f5; padding: 4px 10px; border-radius: 12px; font-size: 12px; color: #888;">🐜 Ant</span>
              <span style="background: #f5f5f5; padding: 4px 10px; border-radius: 12px; font-size: 12px; color: #888;">🪲 Beetle</span>
              <span style="background: #f5f5f5; padding: 4px 10px; border-radius: 12px; font-size: 12px; color: #888;">🦟 Mosquito</span>
            </div>
          </div>
        `,
        
        'relatedEmpty': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🔗</span>Related Species</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; color: #555; margin-bottom: 16px;">You only found 🐞 so far!</div>
            <div style="background: #f0f9ff; border-radius: 12px; padding: 14px; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: #0369a1; margin-bottom: 8px;">💡 More Insects to discover:</div>
              <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <span style="font-size: 20px;">🦋</span>
                <span style="font-size: 20px;">🐝</span>
                <span style="font-size: 20px;">🦗</span>
                <span style="font-size: 20px;">🐜</span>
                <span style="font-size: 20px;">🪲</span>
                <span style="font-size: 20px;">🦟</span>
              </div>
            </div>
            <div style="font-size: 13px; color: #888; text-align: center;">Keep exploring to find more!</div>
          </div>
          <div class="ai-card-footer">
            <button class="ai-card-btn primary" onclick="hideAICard(); hideAI(); navigateTo('camera-page');">Hunt for Insects 🔍</button>
          </div>
        `,
        
        'quizMe': `
          <div class="ai-card-header">
            <div class="ai-card-title"><span class="ai-card-title-icon">🎯</span>Quiz Time!</div>
            <button class="ai-card-close" onclick="hideAICard()">✕</button>
          </div>
          <div class="ai-card-body">
            <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px;">How many legs does a ladybug have?</div>
            <div class="quiz-option">A) 4 legs</div>
            <div class="quiz-option correct">B) 6 legs ✓</div>
            <div class="quiz-option">C) 8 legs</div>
          </div>
        `
      };
      
      // 如果开启了空状态预览，优先返回空状态版本
      const emptyToggle = document.getElementById('empty-state-toggle');
      if (emptyToggle && emptyToggle.checked) {
        const emptyAction = action + 'Empty';
        if (cards[emptyAction]) {
          return cards[emptyAction];
        }
      }
      return cards[action] || null;
    }

    // PTT 浮层
    // 聊天页内置录音功能
    let chatRecordingTimer = null;
    
    function startChatRecording(type) {
      const btn = type === 'chat' ? document.getElementById('chat-speak-btn') : document.getElementById('general-chat-speak-btn');
      if (btn) {
        btn.classList.add('recording');
        const textEl = btn.querySelector('.chat-speak-text');
        if (textEl) textEl.textContent = 'Listening...';
      }
    }
    
    function stopChatRecording(type) {
      const btn = type === 'chat' ? document.getElementById('chat-speak-btn') : document.getElementById('general-chat-speak-btn');
      if (btn) {
        btn.classList.remove('recording');
        const textEl = btn.querySelector('.chat-speak-text');
        if (textEl) textEl.textContent = 'Hold to Speak';
        // 模拟发送消息
        simulateChatResponse(type);
      }
    }
    
    function simulateChatResponse(type) {
      // 这里可以添加消息到聊天列表的逻辑
      console.log('Chat recording finished for:', type);
    }

    function togglePTT() {
      // 如果在聊天页面,触发页面内录音而不是全局浮层
      if (currentPage === 'chat-page') {
        const btn = document.getElementById('chat-speak-btn');
        if (btn && !btn.classList.contains('recording')) {
          startChatRecording('chat');
          setTimeout(() => stopChatRecording('chat'), 2000);
        }
        return;
      }
      if (currentPage === 'general-chat-page') {
        const btn = document.getElementById('general-chat-speak-btn');
        if (btn && !btn.classList.contains('recording')) {
          startChatRecording('general');
          setTimeout(() => stopChatRecording('general'), 2000);
        }
        return;
      }
      
      const overlay = document.getElementById('ptt-overlay');
      if (overlay.classList.contains('show')) {
        hidePTT();
      } else {
        hideAI();
        overlay.classList.add('show');
        resetPTTToRecording();
        simulateVoiceRecognition();
      }
    }

    function hidePTT() {
      document.getElementById('ptt-overlay').classList.remove('show');
      resetPTTToRecording();
    }

    function resetPTTToRecording() {
      document.getElementById('ptt-recording-section').style.display = 'flex';
      document.getElementById('ptt-response-section').style.display = 'none';
      document.getElementById('ptt-hint').style.display = 'block';
      document.getElementById('ptt-status-dot').className = 'ptt-status-dot';
      document.getElementById('ptt-status-text').textContent = 'Listening...';
    }

    function switchCharacter(emoji, btn) {
      document.querySelectorAll('.ptt-char-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('ptt-character').textContent = emoji;
      currentAICharacter = emoji;
    }

    function simulateVoiceRecognition() {
      const phrases = [
        "What kind of bug is this?",
        "Tell me about this flower",
        "Is this rock special?",
        "Why is the sky blue?"
      ];
      const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
      const transcript = document.getElementById('ptt-transcript');
      transcript.textContent = '';
      
      let i = 0;
      const interval = setInterval(() => {
        if (i < randomPhrase.length) {
          transcript.textContent += randomPhrase[i];
          i++;
        } else {
          clearInterval(interval);
          setTimeout(() => showPTTResponse(randomPhrase), 500);
        }
      }, 50);
    }

    function showPTTResponse(userQuestion) {
      document.getElementById('ptt-status-dot').className = 'ptt-status-dot thinking';
      document.getElementById('ptt-status-text').textContent = 'Thinking...';
      
      setTimeout(() => {
        document.getElementById('ptt-status-dot').className = 'ptt-status-dot done';
        document.getElementById('ptt-status-text').textContent = 'AI Answered';
        document.getElementById('ptt-user-text').textContent = userQuestion;
        
        const responses = {
          "What kind of bug is this?": "That's a ladybug! They're tiny beetles with spots. They eat aphids and help gardens grow! 🐞",
          "Tell me about this flower": "This looks like a sunflower! They can grow really tall and always face the sun. Bees love them! 🌻",
          "Is this rock special?": "Wow, great find! This could be granite - see those sparkly bits? That's mica! 🪨✨",
          "Why is the sky blue?": "The sky looks blue because sunlight bounces off tiny bits of air! It's called scattering. Cool, right? ☀️💙"
        };
        
        document.getElementById('ptt-ai-text').textContent = responses[userQuestion] || "That's interesting! Tell me more.";
        document.getElementById('ptt-ai-avatar').textContent = currentAICharacter;
        
        document.getElementById('ptt-recording-section').style.display = 'none';
        document.getElementById('ptt-response-section').style.display = 'flex';
        document.getElementById('ptt-hint').style.display = 'none';
      }, 800);
    }

    function pttAskMore() {
      resetPTTToRecording();
      simulateVoiceRecognition();
    }

    function pttContinueChat() {
      hidePTT();
      navigateTo('general-chat-page');
    }


    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      initCarousel();
      updateNotificationDots();
    });

    // 演示功能 - 在控制台可用
    window.demoXP = () => showXPFloat(15);
    window.demoLevelUp = () => showLevelUpModal();
    window.demoBadge = () => showBadgeModal();
    window.demoSequence = () => demoRewardSequence();
  </script>

</body>
</html>
